import{r as p,I as O,_ as U,j as e,s as h,f as V,Q as K,B as v}from"./app-BGhGKeDm.js";import{A as Q}from"./AdminLayout-BXXLLj0W.js";import q from"./DocumentUploadModal-BMhYQJr0.js";import J from"./DocumentListModal-DJcHZjxV.js";import{R as X,u as Y}from"./useHTMLToPDF-DkpT73MY.js";import{C as F}from"./index-qpGzGUeV.js";import{I as Z}from"./index-BEgchehC.js";import{R as ee}from"./SearchOutlined-BcwQGR4p.js";import{S as te}from"./index-CU9uPcdA.js";import{C as W}from"./Collapse-DIZlwDjJ.js";import{F as se}from"./Table-ehbuzmH8.js";import{S as $}from"./index-DyBnwjTx.js";import{R as ne}from"./FilePdfOutlined-txQDQ4Er.js";import{R as re}from"./UploadOutlined-BrsEtL8G.js";import{T as E}from"./index-D79_8oXq.js";import{R as le}from"./ClockCircleOutlined-BC1I0oaT.js";import{R as P}from"./CheckCircleOutlined-da0VkG9-.js";import{T as oe}from"./index-B6xJCuJM.js";import{P as ie}from"./index-CNlNgOjI.js";import"./UserOutlined-DWxAHtSB.js";import"./index-B1PYG0UW.js";import"./index-BlrWONL6.js";import"./EllipsisOutlined-BvZqw2BO.js";import"./PurePanel-BI8-qUZa.js";import"./index-DyTQAcgu.js";import"./row-Ec-3Wmhs.js";import"./index-Rko1zjtQ.js";import"./index-CU-dLm8k.js";import"./DeleteOutlined-B1rwMVkI.js";import"./DownloadOutlined-CQ9V033d.js";import"./EyeOutlined-DxjRXQL_.js";import"./progress-BgNPOd5E.js";import"./CheckOutlined-CzLtFOuT.js";import"./index-DcGL0UUQ.js";import"./getAllowClear-Um0uvhCc.js";import"./useVariants-CfoUH3-7.js";import"./useIcons-7uZy_G_6.js";import"./DownOutlined-B_G3bdVf.js";import"./FileImageOutlined-CyKwYhHP.js";import"./addEventListener-BNEjuEGT.js";import"./index-C6wmpG5D.js";import"./useBubbleLock-CB_NPaJL.js";import"./index-BmcFQij9.js";import"./Pagination-eFxiWqog.js";import"./FileOutlined-fgq6oFF6.js";import"./FolderOutlined-DyKl-WgS.js";import"./Input-DQj-54rS.js";import"./EditOutlined-Cmt36UP2.js";var ce={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"},ae=function(m,a){return p.createElement(O,U({},m,{ref:a,icon:ce}))},de=p.forwardRef(ae),pe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M342 88H120c-17.7 0-32 14.3-32 32v224c0 8.8 7.2 16 16 16h48c8.8 0 16-7.2 16-16V168h174c8.8 0 16-7.2 16-16v-48c0-8.8-7.2-16-16-16zm578 576h-48c-8.8 0-16 7.2-16 16v176H682c-8.8 0-16 7.2-16 16v48c0 8.8 7.2 16 16 16h222c17.7 0 32-14.3 32-32V680c0-8.8-7.2-16-16-16zM342 856H168V680c0-8.8-7.2-16-16-16h-48c-8.8 0-16 7.2-16 16v224c0 17.7 14.3 32 32 32h222c8.8 0 16-7.2 16-16v-48c0-8.8-7.2-16-16-16zM904 88H682c-8.8 0-16 7.2-16 16v48c0 8.8 7.2 16 16 16h174v176c0 8.8 7.2 16 16 16h48c8.8 0 16-7.2 16-16V120c0-17.7-14.3-32-32-32z"}}]},name:"expand",theme:"outlined"},he=function(m,a){return p.createElement(O,U({},m,{ref:a,icon:pe}))},xe=p.forwardRef(he);const me=({data:l,exportedBy:m})=>{var I,k,y,j,T,S,w,N,g,A,_,L,R;const[a,C]=p.useState({}),[u,o]=p.useState(!1),x=p.useRef(null),B=()=>{if(!x.current)return;const d=x.current.querySelectorAll("[data-section]"),s=1056,n={};d.forEach(i=>{const c=i.getAttribute("data-section"),D=i.offsetHeight,H=i.offsetTop%s;if(H+D>s){const G=s-H;n[c]=G}}),C(n)};p.useEffect(()=>{x.current&&(x.current.calculatePageBreaks=B,x.current.setPageBreaks=C,x.current.pageBreaks=a)},[a]);const f=r=>new Intl.NumberFormat("km-KH",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(r||0),b=r=>new Date(r).toLocaleDateString("km-KH"),t={container:{fontFamily:'"Noto Sans Khmer", "Khmer OS", sans-serif',fontSize:"14px",lineHeight:"1.6",color:"#333",backgroundColor:"#fff",padding:"40px",maxWidth:"210mm",margin:"0 auto"},header:{textAlign:"center",marginBottom:"40px",borderBottom:"3px solid #333",paddingBottom:"20px"},title:{fontSize:"28px",fontWeight:"bold",marginBottom:"10px",color:"#333"},subtitle:{fontSize:"18px",marginBottom:"10px",color:"#666"},exportInfo:{textAlign:"right",fontSize:"12px",color:"#666",marginBottom:"20px"},section:{marginBottom:"30px",pageBreakInside:"avoid",breakInside:"avoid",display:"block",overflow:"visible"},sectionTitle:{fontSize:"20px",fontWeight:"bold",marginBottom:"15px",color:"#333",backgroundColor:"#f8f9fa",padding:"12px",borderLeft:"4px solid #dc3545"},contractInfo:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"15px",marginBottom:"20px"},buyerSellerSection:{marginBottom:"20px",padding:"15px",backgroundColor:"#f8f9fa",borderRadius:"5px",border:"1px solid #dee2e6",pageBreakInside:"avoid",breakInside:"avoid",display:"block",overflow:"visible",minHeight:"fit-content"},subSectionTitle:{fontSize:"16px",fontWeight:"bold",marginBottom:"10px",color:"#2E5984",borderBottom:"1px solid #dee2e6",paddingBottom:"5px"},infoGrid:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",pageBreakInside:"avoid",breakInside:"avoid"},infoItem:{display:"flex",justifyContent:"space-between",padding:"10px",backgroundColor:"#f8f9fa",borderRadius:"4px",border:"1px solid #e9ecef"},infoLabel:{fontWeight:"bold",color:"#495057"},infoValue:{color:"#dc3545",fontWeight:"bold"},table:{width:"100%",borderCollapse:"collapse",marginTop:"15px",pageBreakInside:"avoid",breakInside:"avoid"},tableHeader:{backgroundColor:"#dc3545",color:"white"},tableHeaderCell:{padding:"12px",textAlign:"center",fontWeight:"bold",border:"1px solid #dee2e6"},tableCell:{padding:"10px",textAlign:"center",border:"1px solid #dee2e6"},tableRow:{backgroundColor:"#fff"},tableRowAlt:{backgroundColor:"#f8f9fa"},noData:{textAlign:"center",fontStyle:"italic",color:"#6c757d",padding:"20px"},footer:{textAlign:"center",marginTop:"40px",fontSize:"12px",color:"#6c757d",borderTop:"1px solid #dee2e6",paddingTop:"20px"},keepTogether:{}};return e.jsxs("div",{ref:x,style:t.container,children:[e.jsxs("div",{style:t.header,children:[e.jsx("h1",{style:t.title,children:"របាយការណ៍ឯកសារ"}),e.jsxs("p",{style:t.subtitle,children:["កិច្ចសន្យាលេខ: ",(I=l.contract)==null?void 0:I.contract_id]})]}),e.jsxs("div",{style:t.exportInfo,children:[e.jsxs("div",{children:["នាំចេញដោយ: ",m]}),e.jsxs("div",{children:["កាលបរិច្ឆេទនាំចេញ: ",b(new Date().toISOString())]})]}),e.jsxs("div",{"data-section":"contract-info",style:{...t.section,...t.keepTogether,marginTop:a["contract-info"]?`${a["contract-info"]}px`:t.section.marginTop},children:[e.jsx("h2",{style:t.sectionTitle,children:"📋 ព័ត៌មានសញ្ញា"}),e.jsxs("div",{style:t.contractInfo,children:[e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"លេខសញ្ញា:"}),e.jsx("span",{style:t.infoValue,children:((k=l.contract)==null?void 0:k.id)||((y=l.contract)==null?void 0:y.contract_id)})]}),e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"កាលបរិច្ឆេទសញ្ញា:"}),e.jsx("span",{style:t.infoValue,children:b(((j=l.contract)==null?void 0:j.date)||((T=l.contract)==null?void 0:T.contract_date))})]}),e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"ស្ថានភាព:"}),e.jsx("span",{style:t.infoValue,children:(S=l.contract)==null?void 0:S.status})]}),e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"ចំនួនសរុប:"}),e.jsx("span",{style:t.infoValue,children:f((w=l.contract)==null?void 0:w.total_amount)})]})]})]}),e.jsxs("div",{"data-section":"buyer-info",style:{...t.section,...t.keepTogether,marginTop:a["buyer-info"]?`${a["buyer-info"]}px`:t.section.marginTop},children:[e.jsx("h2",{style:t.sectionTitle,children:"👤 ព័ត៌មានអ្នកទិញ"}),(N=l.contract)!=null&&N.buyers&&l.contract.buyers.length>0?l.contract.buyers.map((r,d)=>{var s,n,i;return e.jsxs("div",{style:t.buyerSellerSection,children:[e.jsxs("h3",{style:t.subSectionTitle,children:["អ្នកទិញ #",d+1]}),e.jsxs("div",{style:t.infoGrid,children:[e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"ឈ្មោះ:"}),e.jsx("span",{style:t.infoValue,children:((s=r.buyer)==null?void 0:s.name)||r.name})]}),e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"ទូរស័ព្ទ:"}),e.jsx("span",{style:t.infoValue,children:((n=r.buyer)==null?void 0:n.phone)||r.phone||"N/A"})]}),e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"អាសយដ្ឋាន:"}),e.jsx("span",{style:t.infoValue,children:((i=r.buyer)==null?void 0:i.address)||r.address||"N/A"})]})]})]},d)}):(g=l.contract)!=null&&g.buyer_name?e.jsxs("div",{style:t.infoGrid,children:[e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"ឈ្មោះ:"}),e.jsx("span",{style:t.infoValue,children:l.contract.buyer_name})]}),e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"ទូរស័ព្ទ:"}),e.jsx("span",{style:t.infoValue,children:l.contract.buyer_phone||"N/A"})]}),e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"អាសយដ្ឋាន:"}),e.jsx("span",{style:t.infoValue,children:l.contract.buyer_address||"N/A"})]})]}):e.jsx("p",{style:t.noData,children:"មិនមានព័ត៌មានអ្នកទិញ"})]}),e.jsxs("div",{"data-section":"seller-info",style:{...t.section,...t.keepTogether,marginTop:a["seller-info"]?`${a["seller-info"]}px`:t.section.marginTop},children:[e.jsx("h2",{style:t.sectionTitle,children:"🏢 ព័ត៌មានអ្នកលក់"}),(A=l.contract)!=null&&A.sellers&&l.contract.sellers.length>0?l.contract.sellers.map((r,d)=>{var s,n,i;return e.jsxs("div",{style:t.buyerSellerSection,children:[e.jsxs("h3",{style:t.subSectionTitle,children:["អ្នកលក់ #",d+1]}),e.jsxs("div",{style:t.infoGrid,children:[e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"ឈ្មោះ:"}),e.jsx("span",{style:t.infoValue,children:((s=r.seller)==null?void 0:s.name)||r.name})]}),e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"ទូរស័ព្ទ:"}),e.jsx("span",{style:t.infoValue,children:((n=r.seller)==null?void 0:n.phone)||r.phone||"N/A"})]}),e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"អាសយដ្ឋាន:"}),e.jsx("span",{style:t.infoValue,children:((i=r.seller)==null?void 0:i.address)||r.address||"N/A"})]})]})]},d)}):(_=l.contract)!=null&&_.seller_name?e.jsxs("div",{style:t.infoGrid,children:[e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"ឈ្មោះ:"}),e.jsx("span",{style:t.infoValue,children:l.contract.seller_name})]}),e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"ទូរស័ព្ទ:"}),e.jsx("span",{style:t.infoValue,children:l.contract.seller_phone||"N/A"})]}),e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"អាសយដ្ឋាន:"}),e.jsx("span",{style:t.infoValue,children:l.contract.seller_address||"N/A"})]})]}):e.jsx("p",{style:t.noData,children:"មិនមានព័ត៌មានអ្នកលក់"})]}),e.jsxs("div",{"data-section":"land-info",style:{...t.section,...t.keepTogether,marginTop:a["land-info"]?`${a["land-info"]}px`:t.section.marginTop},children:[e.jsx("h2",{style:t.sectionTitle,children:"🏞️ ព័ត៌មានដី"}),(L=l.contract)!=null&&L.lands&&l.contract.lands.length>0?l.contract.lands.map((r,d)=>{var s,n,i;return e.jsxs("div",{style:t.buyerSellerSection,children:[e.jsxs("h3",{style:t.subSectionTitle,children:["ដី #",d+1]}),e.jsxs("div",{style:t.infoGrid,children:[e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"លេខក្បាលដី:"}),e.jsx("span",{style:t.infoValue,children:((s=r.land)==null?void 0:s.plot_number)||r.plot_number||"N/A"})]}),e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"ទំហំ:"}),e.jsxs("span",{style:t.infoValue,children:[((n=r.land)==null?void 0:n.size)||r.size||"N/A"," ម²"]})]}),e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"ទីតាំង:"}),e.jsx("span",{style:t.infoValue,children:((i=r.land)==null?void 0:i.location)||r.location||"N/A"})]}),e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"តម្លៃសរុប:"}),e.jsx("span",{style:t.infoValue,children:f(r.total_price)})]})]})]},d)}):(R=l.contract)!=null&&R.land?e.jsxs("div",{style:t.infoGrid,children:[e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"លេខក្បាលដី:"}),e.jsx("span",{style:t.infoValue,children:l.contract.land.plot_number||"N/A"})]}),e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"ទំហំ:"}),e.jsxs("span",{style:t.infoValue,children:[l.contract.land.size||"N/A"," ម²"]})]}),e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"ទីតាំង:"}),e.jsx("span",{style:t.infoValue,children:l.contract.land.location||"N/A"})]})]}):e.jsx("p",{style:t.noData,children:"មិនមានព័ត៌មានដី"})]}),e.jsxs("div",{"data-section":"payment-steps",style:{...t.section,...t.keepTogether,marginTop:a["payment-steps"]?`${a["payment-steps"]}px`:t.section.marginTop},children:[e.jsx("h2",{style:t.sectionTitle,children:"💰 កំណែទឹកការទូទាត់"}),e.jsxs("table",{style:t.table,children:[e.jsx("thead",{style:t.tableHeader,children:e.jsxs("tr",{children:[e.jsx("th",{style:t.tableHeaderCell,children:"ជំហាន #"}),e.jsx("th",{style:t.tableHeaderCell,children:"ចំនួនទឹកប្រាក់"}),e.jsx("th",{style:t.tableHeaderCell,children:"កាលបរិច្ឆេទកំណត់"}),e.jsx("th",{style:t.tableHeaderCell,children:"ស្ថានភាព"})]})}),e.jsx("tbody",{children:l.payment_steps&&l.payment_steps.length>0?l.payment_steps.map((r,d)=>e.jsxs("tr",{style:d%2===0?t.tableRow:t.tableRowAlt,children:[e.jsx("td",{style:t.tableCell,children:r.step_number}),e.jsx("td",{style:t.tableCell,children:f(r.amount)}),e.jsx("td",{style:t.tableCell,children:b(r.due_date)}),e.jsx("td",{style:{...t.tableCell,color:r.status==="paid"?"#28a745":"#dc3545",fontWeight:"bold"},children:r.status==="paid"?"បង់ប្រាក់រួចរាល់":"មិនទាន់បង់ប្រាក់"})]},d)):e.jsx("tr",{children:e.jsx("td",{colSpan:"4",style:t.noData,children:"មិនមានទិន្នន័យការទូទាត់"})})})]})]}),l.contract_documents&&l.contract_documents.length>0&&e.jsxs("div",{style:t.section,children:[e.jsx("h2",{style:t.sectionTitle,children:"📄 ឯកសារកិច្ចសន្យា"}),e.jsxs("table",{style:t.table,children:[e.jsx("thead",{style:t.tableHeader,children:e.jsxs("tr",{children:[e.jsx("th",{style:t.tableHeaderCell,children:"ឈ្មោះឯកសារ"}),e.jsx("th",{style:t.tableHeaderCell,children:"ទំហំឯកសារ"}),e.jsx("th",{style:t.tableHeaderCell,children:"ប្រភេទឯកសារ"}),e.jsx("th",{style:t.tableHeaderCell,children:"កាលបរិច្ឆេទបញ្ចូល"}),e.jsx("th",{style:t.tableHeaderCell,children:"បញ្ចូលដោយ"})]})}),e.jsx("tbody",{children:l.contract_documents.map((r,d)=>e.jsxs("tr",{style:d%2===0?t.tableRow:t.tableRowAlt,children:[e.jsx("td",{style:t.tableCell,children:r.name}),e.jsx("td",{style:t.tableCell,children:formatFileSize(r.file_size)}),e.jsx("td",{style:t.tableCell,children:r.mime_type}),e.jsx("td",{style:t.tableCell,children:b(r.uploaded_at)}),e.jsx("td",{style:t.tableCell,children:r.uploaded_by||"N/A"})]},d))})]})]}),e.jsx("div",{style:t.footer,children:e.jsx("p",{children:"របាយការណ៍នេះត្រូវបានបង្កើតដោយប្រព័ន្ធតាមដានដីកម្ពុជា"})})]})},{Title:dt,Text:M}=oe,{Panel:z}=W;function pt({auth:l}){const[m,a]=p.useState(""),[C,u]=p.useState(!1),[o,x]=p.useState(null),[B,f]=p.useState(!1),[b,t]=p.useState(!1),[I,k]=p.useState(null),[y,j]=p.useState(null),[T,S]=p.useState(!1),{generatePDFFromComponent:w}=Y();p.useEffect(()=>{const n=new URLSearchParams(window.location.search).get("contract_id");n&&(a(n),N(n))},[]);const N=async s=>{var n,i;if(!s.trim()){h.error("សូមបញ្ចូលលេខកិច្ចសន្យា");return}u(!0);try{const c=await V.post("/api/reports/document/search",{contract_id:s.trim()});console.log("Search result:",c.data),x(c.data),c.data&&c.data.contract?(console.log("Found contract in search result:",c.data.contract),j(c.data.contract)):(console.log("No contract found in search result. Structure:",c.data),j(null)),h.success("រកឃើញកិច្ចសន្យា")}catch(c){console.error("បញ្ហាក្នុងការស្វែងរក:",c),h.error(((i=(n=c.response)==null?void 0:n.data)==null?void 0:i.error)||"មិនរកឃើញកិច្ចសន្យា"),x(null)}finally{u(!1)}},g=async()=>{var s,n;if(!m.trim()){h.error("សូមបញ្ចូលលេខកិច្ចសន្យា");return}u(!0);try{const i=await V.post("/api/reports/document/search",{contract_id:m.trim()});console.log("Search result:",i.data),x(i.data),i.data&&i.data.contract?(console.log("Found contract in search result:",i.data.contract),j(i.data.contract)):(console.log("No contract found in search result. Structure:",i.data),j(null)),h.success("រកឃើញកិច្ចសន្យា")}catch(i){console.error("បញ្ហាក្នុងការស្វែងរក:",i),h.error(((n=(s=i.response)==null?void 0:s.data)==null?void 0:n.error)||"មិនរកឃើញកិច្ចសន្យា"),x(null)}finally{u(!1)}},A=async s=>{var n,i;try{u(!0);const c=await V.post(`/api/reports/payment-steps/${s}/mark-as-paid`);h.success("បានកំណត់ថាបានបង់ប្រាក់ហើយ"),g()}catch(c){console.error("បញ្ហាក្នុងការកំណត់ថាបានបង់ប្រាក់:",c),h.error(((i=(n=c.response)==null?void 0:n.data)==null?void 0:i.error)||"មិនអាចកំណត់ថាបានបង់ប្រាក់")}finally{u(!1)}},_=async s=>{if(!o){h.error("សូមស្វែងរកកិច្ចសន្យាជាមុនសិន");return}S(!0);try{if(s==="pdf"){const n=`document_report_${o.contract.contract_id}_${new Date().toISOString().split("T")[0]}.pdf`,i=e.jsx(me,{data:o,exportedBy:l.user.name}),c=await w(i,n);if(!c.success)throw new Error(c.error);h.success("នាំចេញ PDF បានជោគជ័យ")}else if(s==="excel"){const n=await V.post("/api/reports/document/export",{contract_id:o.contract.contract_id,format:"excel"},{responseType:"blob"}),i=window.URL.createObjectURL(new Blob([n.data])),c=document.createElement("a");c.href=i,c.setAttribute("download",`document_report_${o.contract.contract_id}.xlsx`),document.body.appendChild(c),c.click(),document.body.removeChild(c),h.success("នាំចេញ Excel បានជោគជ័យ")}}catch(n){console.error("Export error:",n),h.error(`មានបញ្ហាក្នុងការនាំចេញ: ${n.message}`)}finally{S(!1)}},L=()=>{if(console.log("showUploadModal called, saleContract:",y),console.log("searchResult:",o),!y){if(console.log("No sale contract found, showing error message"),o&&o.contract){console.log("Found contract in searchResult, using it:",o.contract),j(o.contract),f(!0);return}h.error("សូមស្វែងរកកិច្ចសន្យាមុននឹងផ្ទុកឯកសារ");return}console.log("Setting upload modal visible, saleContract ID:",y.id),f(!0)},R=s=>{k(s),t(!0)},r=s=>{switch(s){case"paid":return e.jsxs(E,{color:"green",children:[e.jsx(P,{})," បានបង់ប្រាក់រួចរាល់"]});case"unpaid":default:return e.jsxs(E,{color:"red",children:[e.jsx(le,{})," មិនទាន់បង់ប្រាក់"]})}},d=[{title:"ដំណាក់កាល",dataIndex:"step_number",key:"step_number",width:120,render:s=>`ទី${s}`},{title:"ចំនួនទឹកប្រាក់",dataIndex:"amount",key:"amount",render:s=>`$${parseFloat(s).toLocaleString("en-US",{minimumFractionDigits:2})}`,width:150},{title:"កាលបរិច្ឆេទត្រូវបង់ប្រាក់",dataIndex:"due_date",key:"due_date",render:(s,n)=>new Date(s)<new Date&&n.status==="unpaid"?e.jsx(M,{strong:!0,style:{color:"red"},children:s}):e.jsx(M,{children:s})},{title:"ស្ថានភាព",dataIndex:"status",key:"status",render:s=>r(s)},{title:"សកម្មភាព",key:"actions",render:(s,n)=>e.jsx($,{size:"small",children:n.status!=="paid"&&e.jsx(ie,{title:"តើអ្នកប្រាកដថាចង់កំណត់ថាបានបង់ប្រាក់នេះមែនទេ?",description:"ការសកម្មភាពនេះអាចត្រូវបានប្រព្រឹត្តទៅ",icon:e.jsx(de,{style:{color:"#faad14"}}),okText:"បាទ/ចាស",cancelText:"ទេ",okButtonProps:{style:{backgroundColor:"#1890ff",borderColor:"#1890ff"}},onConfirm:()=>A(n.id),children:e.jsx(v,{type:"primary",icon:e.jsx(P,{}),size:"small",style:{backgroundColor:"#52c41a",borderColor:"#52c41a"},disabled:n.status==="paid"})})})}];return e.jsxs(Q,{user:l.user,header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"របាយការណ៍ឯកសារ"}),children:[e.jsx(K,{title:"របាយការណ៍ឯកសារ"}),e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[e.jsx(F,{title:"ស្វែងរកកិច្ចសន្យា",className:"mb-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Z,{placeholder:"បញ្ចូលលេខកិច្ចសន្យា",value:m,onChange:s=>a(s.target.value),onPressEnter:g,style:{width:"300px"},prefix:e.jsx(ee,{})}),e.jsx(v,{type:"primary",onClick:g,loading:C,className:"ml-2",children:"ស្វែងរក"})]})}),C&&e.jsx("div",{className:"text-center my-8",children:e.jsx(te,{size:"large"})}),o&&e.jsx(e.Fragment,{children:e.jsxs(F,{title:`កិច្ចសន្យា: ${o.contract.contract_id}`,className:"mb-6",extra:e.jsxs($,{children:[e.jsx(v,{type:"primary",danger:!0,icon:e.jsx(ne,{}),onClick:()=>_("pdf"),loading:T,children:"នាំចេញជា PDF"}),e.jsx(v,{type:"primary",style:{backgroundColor:"#52c41a"},icon:e.jsx(X,{}),onClick:()=>_("excel"),children:"នាំចេញជា Excel"}),e.jsx(v,{icon:e.jsx(re,{}),onClick:()=>L(),children:"ផ្ទុកឯកសារ"}),e.jsx(v,{icon:e.jsx(xe,{}),onClick:()=>R(null),children:"មើលឯកសារទាំងអស់"})]}),children:[e.jsxs(W,{defaultActiveKey:["1","2","3"],children:[e.jsx(z,{header:"ព័ត៌មានអ្នកទិញ",children:o.contract.buyers&&o.contract.buyers.length>0?e.jsx(e.Fragment,{children:o.contract.buyers.map((s,n)=>e.jsxs("div",{className:n>0?"mt-4 pt-4 border-t":"",children:[o.contract.buyers.length>1&&e.jsxs("h4",{className:"font-bold mb-2",children:["អ្នកទិញទី ",n+1]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ឈ្មោះ:"})," ",s.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ទូរស័ព្ទ:"})," ",s.phone||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"អាសយដ្ឋាន:"})," ",s.address||"N/A"]})]},s.id))}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"ឈ្មោះ:"})," ",o.contract.buyer_info.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ទូរស័ព្ទ:"})," ",o.contract.buyer_info.phone||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"អាសយដ្ឋាន:"})," ",o.contract.buyer_info.address||"N/A"]})]})},"1"),e.jsx(z,{header:"ព័ត៌មានអ្នកលក់",children:o.contract.sellers&&o.contract.sellers.length>0?e.jsx(e.Fragment,{children:o.contract.sellers.map((s,n)=>e.jsxs("div",{className:n>0?"mt-4 pt-4 border-t":"",children:[o.contract.sellers.length>1&&e.jsxs("h4",{className:"font-bold mb-2",children:["អ្នកលក់ទី ",n+1]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ឈ្មោះ:"})," ",s.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ទូរស័ព្ទ:"})," ",s.phone||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"អាសយដ្ឋាន:"})," ",s.address||"N/A"]})]},s.id))}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"ឈ្មោះ:"})," ",o.contract.seller_info.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ទូរស័ព្ទ:"})," ",o.contract.seller_info.phone||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"អាសយដ្ឋាន:"})," ",o.contract.seller_info.address||"N/A"]})]})},"2"),e.jsx(z,{header:"ព័ត៌មានដី",children:o.contract.lands&&o.contract.lands.length>0?e.jsx(e.Fragment,{children:o.contract.lands.map((s,n)=>e.jsxs("div",{className:n>0?"mt-4 pt-4 border-t":"",children:[o.contract.lands.length>1&&e.jsxs("h4",{className:"font-bold mb-2",children:["ដីទី ",n+1]}),e.jsxs("p",{children:[e.jsx("strong",{children:"លេខក្បែងដី:"})," ",s.plot_number]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ទំហំ:"})," ",s.size]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ទីតាំង:"})," ",s.location]}),e.jsxs("p",{children:[e.jsx("strong",{children:"តម្លៃក្នុងម៉ែត្រការ៉េ:"})," ",s.price_per_meter]}),e.jsxs("p",{children:[e.jsx("strong",{children:"តម្លៃសរុប:"})," ",s.total_price]})]},s.id))}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"លេខក្បែងដី:"})," ",o.contract.land_info.plot_number]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ទំហំ:"})," ",o.contract.land_info.size]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ទីតាំង:"})," ",o.contract.land_info.location]})]})},"3")]}),e.jsx("div",{className:"mt-6",children:e.jsx(se,{columns:d,dataSource:o.payment_steps,rowKey:"id",pagination:!1,size:"middle"})})]})})]})}),e.jsx(q,{visible:B,onCancel:()=>f(!1),saleContract:y,onSuccess:()=>{f(!1),g()}}),e.jsx(J,{visible:b,onCancel:()=>t(!1),paymentStep:I})]})}export{pt as default};
