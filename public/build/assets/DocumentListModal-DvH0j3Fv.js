import{r as i,_ as I,d as u,j as t}from"./app-D0OhDuOP.js";import{s as c}from"./index-VXrvBi_7.js";import{M as y}from"./index-DSx0c0nZ.js";import{S as R}from"./index-Bjcdw0HM.js";import{F as E}from"./Table-CJMywyvl.js";import{E as x}from"./index-BXlDNFm_.js";import{I as $,B as l,T as h}from"./index-XQ9uBlxv.js";import{S as M}from"./index-CpY42lHj.js";import{R as v}from"./DownloadOutlined-BFocYQwA.js";import{P as S}from"./index-BLwNk9Dd.js";import{R as D}from"./DeleteOutlined-C5fTVnAq.js";import{R as F}from"./FilePdfOutlined-BmX1d_m5.js";import{R as B}from"./FileImageOutlined-6X7nxdKY.js";import"./ExclamationCircleFilled-BuCwC-hN.js";import"./CloseOutlined-CSg-7HVH.js";import"./InfoCircleFilled-Csbq1HVY.js";import"./pickAttrs-BMtZpb9Y.js";import"./ActionButton-DPI_9ZHB.js";import"./useClosable-rmjEiMr1.js";import"./extendsObject-78o_rR5W.js";import"./CheckOutlined-C-W3vkf9.js";import"./Skeleton-BB1PfEPR.js";import"./index-BNYa27A7.js";import"./PurePanel-BrlMViLC.js";import"./getAllowClear-7r21EHJH.js";import"./addEventListener-Dvq9iQDE.js";import"./DownOutlined-BKT6hG3e.js";import"./index-CxyNWzZ_.js";import"./useBubbleLock-Dp5g0NxF.js";import"./index-BKPGZTnh.js";import"./EllipsisOutlined-BcUT9_x5.js";import"./index-HowiUfuo.js";import"./Pagination-C28t5-1k.js";import"./FileOutlined-CmtzEeI9.js";import"./FolderOutlined-CsvjmU0T.js";import"./SearchOutlined-DdbS1Qlk.js";import"./Input-DIi4XD1o.js";import"./useVariants-VmmnPvRy.js";import"./useIcons-De8HtjeC.js";var L={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.7L639.4 73.4c-6-6-14.2-9.4-22.7-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.6-9.4-22.6zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494zM402 549c0 5.4 4.4 9.5 9.8 9.5h32.4c5.4 0 9.8-4.2 9.8-9.4 0-28.2 25.8-51.6 58-51.6s58 23.4 58 51.5c0 25.3-21 47.2-49.3 50.9-19.3 2.8-34.5 20.3-34.7 40.1v32c0 5.5 4.5 10 10 10h32c5.5 0 10-4.5 10-10v-12.2c0-6 4-11.5 9.7-13.3 44.6-14.4 75-54 74.3-98.9-.8-55.5-49.2-100.8-108.5-101.6-61.4-.7-111.5 45.6-111.5 103zm78 195a32 32 0 1064 0 32 32 0 10-64 0z"}}]},name:"file-unknown",theme:"outlined"},P=function(s,r){return i.createElement($,I({},s,{ref:r,icon:L}))},T=i.forwardRef(P);function _t({visible:n,onCancel:s,paymentStep:r}){const[m,j]=i.useState([]),[w,a]=i.useState(!1);i.useEffect(()=>{n&&d()},[n,r]);const d=async()=>{a(!0);try{const e=r?`/api/reports/payment-steps/${r.id}/documents`:"/api/reports/contract-documents",o=await u.get(e);j(o.data.documents||[])}catch(e){console.error("បញ្ហាក្នុងការទាញឯកសារ:",e),c.error("មានបញ្ហាក្នុងការផ្ទុកឯកសារ")}finally{a(!1)}},g=e=>{window.open(`/api/reports/contract-documents/${e}/download`,"_blank")},k=async e=>{var o,p;try{a(!0),await u.delete(`/api/reports/contract-documents/${e}`),c.success("លុបឯកសារជោគជ័យ"),d()}catch(f){console.error("បញ្ហាក្នុងការលុបឯកសារ:",f),c.error(((p=(o=f.response)==null?void 0:o.data)==null?void 0:p.error)||"មានបញ្ហាក្នុងការលុបឯកសារ")}finally{a(!1)}},z=e=>e==="application/pdf"?t.jsx(F,{style:{fontSize:"20px",color:"#ff4d4f"}}):e.startsWith("image/")?t.jsx(B,{style:{fontSize:"20px",color:"#1890ff"}}):t.jsx(T,{style:{fontSize:"20px"}}),_=[{title:"ឈ្មោះឯកសារ",dataIndex:"file_name",key:"file_name",render:(e,o)=>t.jsxs("div",{className:"flex items-center",children:[z(o.mime_type),t.jsx("span",{className:"ml-2",children:e})]})},{title:"ទំហំ",dataIndex:"file_size",key:"file_size",render:e=>{const o=e/1024;return o<1024?`${o.toFixed(2)} KB`:`${(o/1024).toFixed(2)} MB`}},{title:"ផ្ទុកនៅពេល",dataIndex:"uploaded_at",key:"uploaded_at",render:e=>new Date(e).toLocaleString()},{title:"សកម្មភាព",key:"actions",render:(e,o)=>t.jsxs(M,{size:"small",children:[t.jsx(h,{title:"ទាញយក",children:t.jsx(l,{icon:t.jsx(v,{}),size:"small",onClick:()=>g(o.id)})}),t.jsx(S,{title:"លុបឯកសារ",description:"តើអ្នកចង់លុបឯកសារនេះមែនទេ?",onConfirm:()=>k(o.id),okText:"យល់ព្រម",cancelText:"មិនយល់ព្រម",okButtonProps:{danger:!0},children:t.jsx(h,{title:"លុប",children:t.jsx(l,{danger:!0,icon:t.jsx(D,{}),size:"small"})})})]})}];return t.jsx(y,{title:r?`ឯកសារសម្រាប់ដំណាក់កាលបង់ប្រាក់ទី${r.step_number}`:"ឯកសារទាំងអស់",open:n,onCancel:s,footer:[t.jsx(l,{onClick:s,children:"បិទ"},"close")],width:800,children:t.jsx(R,{spinning:w,children:m.length>0?t.jsx(E,{columns:_,dataSource:m,rowKey:"id",pagination:!1,size:"middle"}):t.jsx(x,{description:"មិនមានឯកសារទេ",image:x.PRESENTED_IMAGE_SIMPLE})})})}export{_t as default};
