import{r as n,j as t,Q as k,t as g,B as c,h,s as p,a as C}from"./app-Cq9T9vxM.js";import{A as I}from"./AdminLayout-CqQNNgQt.js";import{L as B}from"./LandForm-DXAssxD9.js";import{F as v,B as E}from"./BackImageUpload-v8_ZFOT5.js";import{d as N}from"./dayjs.min-BTLK4jSO.js";import{B as R}from"./Breadcrumb-6m4s_fwQ.js";import{C as F}from"./index-0lybEGve.js";import{T as L}from"./index-B236O7Xl.js";import{S as y}from"./index-DplbXNQy.js";import{R as T,C as j}from"./row-CJ-aj50t.js";import{R as $}from"./ArrowLeftOutlined-y-0HxkNq.js";import{S as w}from"./index-B5_NNnDd.js";import{R as D}from"./ArrowRightOutlined-CR7245gU.js";import{S as z}from"./index-B3veqm8A.js";import"./UserOutlined-BJz0bsFe.js";import"./index-DL0uTJIv.js";import"./index-DPFVXnL-.js";import"./EllipsisOutlined-BDh9HHBq.js";import"./PurePanel-Ce8hDmce.js";import"./InboxOutlined-ZSWvT0kT.js";import"./khmerDate-iNtMyZoL.js";import"./index-UraXu45p.js";import"./index-DHD7yk2W.js";import"./getAllowClear-nqy4kNbo.js";import"./Input-DONKCjvs.js";import"./useVariants-Ea3XEG1D.js";import"./EyeOutlined-CFXJhbVH.js";import"./SearchOutlined-PK94XR1x.js";import"./EditOutlined-BcDUZ6EU.js";import"./index-CKm1mZ_X.js";import"./CalendarOutlined-CimjgQ7W.js";import"./ClockCircleOutlined-CuqZA4f1.js";import"./useIcons-Ds0_kiqE.js";import"./CheckOutlined-_L7buK6x.js";import"./DownOutlined-8JSIA4HI.js";import"./index-DBk7DIQb.js";import"./SaveOutlined-Cyl4fliM.js";import"./index-DmXmgjLE.js";import"./addEventListener-DU-bjus0.js";import"./index-C_oXb-ri.js";import"./DeleteOutlined-j2tGMUPF.js";import"./FileImageOutlined-h47-aNI4.js";import"./index-Ut4Nl-5k.js";import"./DownloadOutlined-C0uSoOge.js";import"./progress-CdXVhW7a.js";import"./index-eUbAuevc.js";import"./index-C_zCuArI.js";import"./UploadOutlined-Dnm-KKHJ.js";const{Title:A,Text:Dt}=L,{Step:Q}=y,{Option:zt}=z;function U({land:r,documents:m}){const[i,d]=n.useState(0),[a,f]=n.useState(null),[l,x]=n.useState(null),[M,u]=n.useState(!1);n.useEffect(()=>{m&&m.length>0&&m.forEach(e=>{const o={uid:e.id,name:e.file_name,fileName:e.file_name,url:`/storage/${e.file_path}`,base64:`/storage/${e.file_path}`,isExisting:!0,id:e.id,isDisplay:e.is_display,mimeType:"image/jpeg"};e.is_display?f(o):x(o)})},[m]);const s=[{title:"រូបខាងមុខ",content:"front-image"},{title:"រូបខាងក្រោយ",content:"back-image"},{title:"បញ្ចូលព័ត៌មាន",content:"land-info"}],S=()=>{if(i===0){if(!a){p.error("សូមផ្ទុកឡើងរូបខាងមុខ");return}}else if(i===1&&!l){p.error("សូមផ្ទុកឡើងរូបខាងក្រោយ");return}d(i+1)},b=()=>{d(i-1)},_=async e=>{u(!0);try{const o={...e,frontImage:a,backImage:l};await C.put(`/api/lands/${r.id}`,o),p.success("ដីត្រូវបានកែប្រែដោយជោគជ័យ"),h.visit(route("data-entry.lands.index"))}catch(o){console.error("Error updating land:",o),p.error("មានបញ្ហាក្នុងការកែប្រែដី")}finally{u(!1)}};return t.jsxs(t.Fragment,{children:[t.jsx(k,{title:"កែប្រែដី"}),t.jsxs("div",{className:"land-edit",children:[t.jsx(R,{items:[{title:t.jsx(g,{href:route("data-entry.index"),children:"ជ្រើសរើសប្រភេទទិន្នន័យ"})},{title:t.jsx(g,{href:route("data-entry.lands.index"),children:"បញ្ជីដី"})},{title:"កែប្រែដី"}],className:"mb-6"}),t.jsxs(F,{children:[t.jsx(A,{level:4,className:"khmer-heading mb-6",children:"កែប្រែដី"}),t.jsx(y,{current:i,className:"mb-8",children:s.map(e=>t.jsx(Q,{title:e.title,icon:e.icon},e.title))}),t.jsxs("div",{className:"steps-content mb-6",children:[s[i].content==="front-image"&&t.jsx(v,{category:"land",frontImage:a,onFrontImageChange:f}),s[i].content==="back-image"&&t.jsx(E,{category:"land",backImage:l,onBackImageChange:x}),s[i].content==="land-info"&&t.jsx(B,{onSubmit:_,files:[a,l].filter(Boolean),frontImage:a,initialValues:{plot_number:r.title_deed_number,location:r.location,date_of_registration:r.date_of_registration?N(r.date_of_registration):null,size:r.size}})]}),t.jsx("div",{className:"steps-action",children:t.jsxs(T,{justify:"space-between",children:[t.jsx(j,{children:i>0&&t.jsx(c,{icon:t.jsx($,{}),onClick:b,children:"ត្រឡប់ក្រោយ"})}),t.jsx(j,{children:t.jsxs(w,{children:[t.jsx(c,{onClick:()=>h.visit(route("data-entry.lands.index")),children:"បោះបង់"}),i<s.length-1&&t.jsx(c,{type:"primary",onClick:S,icon:t.jsx(D,{}),iconPosition:"end",children:i===0?"បន្តទៅរូបខាងក្រោយ":"បន្ទាប់"})]})})]})})]})]})]})}U.layout=r=>t.jsx(I,{title:"កែប្រែដី",children:r});export{U as default};
