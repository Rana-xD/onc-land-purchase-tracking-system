import{r as g,j as e,Q as D,B as m,a as B,s as h,h as y}from"./app-C81v863Z.js";import{A as Y}from"./AdminLayout-4hWCCW4J.js";import{d as _}from"./dayjs.min-C1_8woz9.js";import{F as i}from"./index-C0G5YYq6.js";import{S as b}from"./index-0iedL70p.js";import{R as v}from"./ArrowLeftOutlined-DwSHvv8c.js";import{T as A}from"./index-DVx3a9qR.js";import{C as I,R as k}from"./index-Cq5Cojs-.js";import{R,C as u}from"./row-DVautw-w.js";import{I as C}from"./index-CfwryaAm.js";import{T as $}from"./index-DIyycjnG.js";import{D as w}from"./index-D7zL8AIS.js";import{D as E}from"./index-5Q1J_MEE.js";import{R as F}from"./MinusCircleOutlined-DMF-0Nvc.js";import{R as S}from"./SaveOutlined-DxZ8K-Ob.js";import"./UserOutlined-Cs_VmhTJ.js";import"./index-hGIK_HDO.js";import"./index-BDtS0eMa.js";import"./EllipsisOutlined-Dgx-5LTE.js";import"./PurePanel-B9LZ7YRU.js";import"./InboxOutlined-NtB6O71W.js";import"./EditOutlined-Dt25MYJV.js";import"./getAllowClear-YBVvCZBt.js";import"./useVariants-DiVBn6uh.js";import"./CheckOutlined-BtpNa_G2.js";import"./Input-BSKYPgzP.js";import"./EyeOutlined-B_Q_oTAq.js";import"./SearchOutlined-rZRKH8d_.js";import"./DownOutlined-Bis42zyM.js";import"./CalendarOutlined-BKTt4Cib.js";import"./ClockCircleOutlined-Zf5tEG56.js";import"./useIcons-Bcyu7X2C.js";const{Title:M,Text:ge}=A,{TextArea:q}=C;function ye({commission:o}){const[p]=i.useForm(),[T,f]=g.useState(!1);g.useEffect(()=>{var s;o&&p.setFieldsValue({recipient_name:o.recipient_name,total_amount:o.total_amount,description:o.description,payment_steps:((s=o.payment_steps)==null?void 0:s.map(n=>({amount:n.amount,due_date:_(n.due_date)})))||[{amount:null,due_date:null}]})},[o,p]);const z=async s=>{var n,d,c,l;f(!0);try{const t=s.payment_steps.map(x=>({amount:x.amount,due_date:x.due_date.format("YYYY-MM-DD")})),r={...s,payment_steps:t},a=await B.put(`/commissions/api/post-purchase/${o.id}`,r);a.data.success&&(h.success(a.data.message),y.visit("/commissions/post-purchase"))}catch(t){if((d=(n=t.response)==null?void 0:n.data)!=null&&d.errors){const r=t.response.data.errors;Object.keys(r).forEach(a=>{a==="payment_steps"&&Array.isArray(r[a])?r[a].forEach(x=>{h.error(x)}):p.setFields([{name:a,errors:r[a]}])})}else h.error(((l=(c=t.response)==null?void 0:c.data)==null?void 0:l.message)||"មានបញ្ហាក្នុងការរក្សាទុក")}finally{f(!1)}},j=()=>{y.visit("/commissions/post-purchase")};return e.jsxs(Y,{children:[e.jsx(D,{title:"កែប្រែកម៉ីសិនក្រោយទិញ"}),e.jsxs("div",{style:{padding:"24px"},children:[e.jsx("div",{style:{marginBottom:"24px"},children:e.jsxs(b,{align:"center",children:[e.jsx(m,{icon:e.jsx(v,{}),onClick:j,type:"text"}),e.jsx(M,{level:2,style:{margin:0,textAlign:"center"},children:"កែប្រែកម៉ីសិនក្រោយទិញ"})]})}),e.jsx(I,{children:e.jsxs(i,{form:p,layout:"vertical",onFinish:z,children:[e.jsxs(R,{gutter:24,children:[e.jsx(u,{xs:24,md:12,children:e.jsx(i.Item,{name:"recipient_name",label:"ឈ្មោះអ្នកទទួល",rules:[{required:!0,message:"សូមបញ្ចូលឈ្មោះអ្នកទទួល"}],children:e.jsx(C,{placeholder:"បញ្ចូលឈ្មោះអ្នកទទួល",size:"large"})})}),e.jsx(u,{xs:24,md:12,children:e.jsx(i.Item,{name:"total_amount",label:"ចំនួនសរុប",rules:[{required:!0,message:"សូមបញ្ចូលចំនួនសរុប"},{type:"number",min:.01,message:"ចំនួនទឹកប្រាក់ត្រូវតែធំជាង 0"}],children:e.jsx($,{placeholder:"បញ្ចូលចំនួនសរុប",style:{width:"100%"},size:"large",formatter:s=>`$ ${s}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:s=>s.replace(/\$\s?|(,*)/g,""),precision:2})})})]}),e.jsx(i.Item,{name:"description",label:"ការពិពណ៌នា",children:e.jsx(q,{placeholder:"បញ្ចូលការពិពណ៌នា (ស្រេចចិត្ត)",rows:4,size:"large"})}),e.jsx(w,{children:"ជំហានទូទាត់"}),e.jsx(i.List,{name:"payment_steps",children:(s,{add:n,remove:d})=>e.jsxs(e.Fragment,{children:[s.map(({key:c,name:l,...t})=>e.jsx(I,{size:"small",style:{marginBottom:"16px",backgroundColor:"#fafafa"},title:`ជំហានទី ${l+1}`,extra:s.length>1&&e.jsx(m,{type:"link",danger:!0,icon:e.jsx(F,{}),onClick:()=>d(l),size:"small",children:"លុប"}),children:e.jsxs(R,{gutter:16,children:[e.jsx(u,{xs:24,md:12,children:e.jsx(i.Item,{...t,name:[l,"amount"],label:"ចំនួនទឹកប្រាក់",rules:[{required:!0,message:"សូមបញ្ចូលចំនួនទឹកប្រាក់"},{type:"number",min:.01,message:"ចំនួនទឹកប្រាក់ត្រូវតែធំជាង 0"}],children:e.jsx($,{placeholder:"ចំនួនទឹកប្រាក់",style:{width:"100%"},formatter:r=>`$ ${r}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:r=>r.replace(/\$\s?|(,*)/g,""),precision:2})})}),e.jsx(u,{xs:24,md:12,children:e.jsx(i.Item,{...t,name:[l,"due_date"],label:"កាលបរិច្ឆេទ",rules:[{required:!0,message:"សូមជ្រើសរើសកាលបរិច្ឆេទ"}],children:e.jsx(E,{placeholder:"កាលបរិច្ឆេទ",style:{width:"100%"},format:"DD/MM/YYYY",disabledDate:r=>r&&r<_().endOf("day")})})})]})},c)),e.jsx(m,{type:"dashed",onClick:()=>n(),block:!0,icon:e.jsx(k,{}),size:"large",style:{marginBottom:"24px"},children:"បន្ថែមជំហាន"})]})}),e.jsx("div",{style:{textAlign:"right",paddingTop:"16px",borderTop:"1px solid #f0f0f0"},children:e.jsxs(b,{size:"middle",children:[e.jsx(m,{size:"large",onClick:j,children:"បោះបង់"}),e.jsx(m,{type:"primary",htmlType:"submit",loading:T,icon:e.jsx(S,{}),size:"large",children:"រក្សាទុក"})]})})]})})]})]})}export{ye as default};
