import{r as p,j as e,Q as L,B as v,s as j,a as B}from"./app-zwF1qXmt.js";import{n as f}from"./numberUtils-DuaFS_6b.js";import{A as D,b as A}from"./AdminLayout-7EiKnzDi.js";import{C as b}from"./index-BViq9QJ5.js";import{S as K}from"./index-DaBWAD6m.js";import{T as M}from"./index-Bur7rjdX.js";import{B as O}from"./index-BTMXsAZS.js";import{I as Q}from"./index-DnWjr1E0.js";import{R as G}from"./SearchOutlined-ckskIcIF.js";import{F as Z}from"./Table-BOxY9eJ4.js";import{T as w}from"./index-B7OOAzhx.js";import{D as q}from"./index-BoPAxKdL.js";import{R as H}from"./UserOutlined-_tsZ_L2L.js";import{R as J}from"./EnvironmentOutlined-DfrbTZ4R.js";import{R as N}from"./DollarOutlined-CW2DtJ3s.js";import{R as U}from"./FileOutlined-Cr8DQwSN.js";import"./index-BwOrOVI4.js";import"./index-B73L-RiE.js";import"./EllipsisOutlined-BgCch_Wi.js";import"./PurePanel-BlgAcrce.js";import"./index-Dcqx-5CC.js";import"./InboxOutlined-C6Tl-Jce.js";import"./useVariants-DJWLAYkM.js";import"./CheckOutlined-CWbPYj3k.js";import"./progress-xMLXHtD_.js";import"./EditOutlined-DAqDAxHf.js";import"./getAllowClear-DSmRZVga.js";import"./Input-BkgYjX8b.js";import"./EyeOutlined-DlB_godP.js";import"./addEventListener-VTVT0Xmn.js";import"./index-CseKHSuS.js";import"./useIcons-DF0NetuM.js";import"./DownOutlined-CAWJwJ4J.js";import"./index-DZvpsH_A.js";import"./useBubbleLock-Be9_HeRQ.js";import"./index-c65RzQeC.js";import"./Pagination-a66s3alc.js";import"./index-lwJ32dcB.js";import"./FolderOutlined-D2Qk_bz3.js";const{Title:S,Text:R}=M;function Fe({document:l,lands:_,selectedLands:d}){const[I,g]=p.useState(!1),[a,h]=p.useState([]),[i,m]=p.useState({}),[T,y]=p.useState(0),[u,$]=p.useState("");p.useEffect(()=>{if(d){const t=Object.keys(d).map(s=>parseInt(s));h(t);const r={};let o=0;t.forEach(s=>{const n=d[s];r[s]={price_per_m2:n.price_per_m2,total_price:n.total_price},o+=parseFloat(n.total_price)}),m(r),y(o)}},[d]),p.useEffect(()=>{let t=0;Object.values(i).forEach(r=>{r.total_price&&(t+=parseFloat(r.total_price))}),y(t)},[i]);const P=(t,r)=>{const o=_.find(n=>n.id===t);if(!o)return;const s=r*parseFloat(o.size);m({...i,[t]:{price_per_m2:r,total_price:s}})},z=(t,r)=>{m({...i,[t]:{price_per_m2:null,total_price:r}})},C=_.filter(t=>{if(!u)return!0;const r=f(u),o=f(t.plot_number),s=f(t.location),n=f(t.size);return o.includes(r)||s.includes(r)||n.includes(r)}),k=[{title:"ជ្រើសរើស",dataIndex:"id",key:"selection",render:t=>e.jsx("input",{type:"checkbox",checked:a.includes(t),onChange:r=>{if(r.target.checked)h([...a,t]),i[t]||m({...i,[t]:{price_per_m2:null,total_price:0}});else{h(a.filter(s=>s!==t));const o={...i};delete o[t],m(o)}}})},{title:"លេខក្បាលដី",dataIndex:"plot_number",key:"plot_number"},{title:"ទំហំ",dataIndex:"size",key:"size",render:t=>`${t} m²`},{title:"ទីតាំង",dataIndex:"location",key:"location"}],E=async()=>{if(a.length===0){j.error("សូមជ្រើសរើសយ៉ាងហោចណាស់មួយ");return}if(a.some(r=>!i[r]||!i[r].total_price)){j.error("សូមបញ្ចូលតម្លៃសម្រាប់ដីទាំងអស់");return}g(!0);try{const r=a.map(s=>({land_id:s,price_per_m2:i[s].price_per_m2,total_price:i[s].total_price})),o=l.document_type==="deposit_contract"?"deposit-contracts":"sale-contracts";await B.post(`/api/${o}/${l.id}/select-lands`,{lands:r}),l.document_type==="deposit_contract"?window.location.href=route("deposit-contracts.deposit-config",{id:l.id}):window.location.href=route("sale-contracts.payment-steps",{id:l.id})}catch(r){console.error("Error selecting lands:",r),j.error("មានបញ្ហាក្នុងការជ្រើសរើសដី")}finally{g(!1)}},F=2,x=[{title:"ជ្រើសរើសអ្នកទិញ",icon:e.jsx(H,{})},{title:"ជ្រើសរើសអ្នកលក់",icon:e.jsx(A,{})},{title:"ជ្រើសរើសដី និងកំណត់តម្លៃ",icon:e.jsx(J,{})}];return l.document_type==="deposit_contract"?x.push({title:"កំណត់ការកក់ប្រាក់",icon:e.jsx(N,{})}):x.push({title:"ដំណាក់កាលបង់ប្រាក់",icon:e.jsx(N,{})}),x.push({title:"បង្កើតកិច្ចសន្យា",icon:e.jsx(U,{})}),e.jsxs(D,{children:[e.jsx(L,{title:"ជ្រើសរើសដី និងកំណត់តម្លៃ"}),e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsx(b,{className:"mb-6",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsx(K,{current:F,items:x,responsive:!0,className:"site-navigation-steps",size:"small"})})}),e.jsxs(b,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx(S,{level:3,children:"ជ្រើសរើសដី និងកំណត់តម្លៃ"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(R,{className:"mr-2",children:"បានជ្រើសរើស"}),e.jsx(O,{count:a.length,showZero:!0,style:{marginTop:"0"}})]})]}),e.jsx("div",{className:"mb-4",children:e.jsx(Q,{placeholder:"ស្វែងរកតាមលេខក្បាលដី ទំហំ ឬទីតាំង",prefix:e.jsx(G,{}),value:u,onChange:t=>$(t.target.value),style:{width:"100%"}})}),e.jsx(Z,{rowKey:"id",columns:k,dataSource:C,pagination:{pageSize:10},rowClassName:t=>a.includes(t.id)?"bg-blue-50":"",expandable:{expandedRowRender:t=>{var r,o,s,n;return a.includes(t.id)?e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-2",children:"តម្លៃក្នុង 1m² (Price per m²):"}),e.jsx("div",{children:e.jsx(w,{style:{width:"100%"},min:0,precision:2,prefix:"$",value:(r=i[t.id])==null?void 0:r.price_per_m2,onChange:c=>P(t.id,c),placeholder:"បញ្ចូលតម្លៃក្នុង 1m²",formatter:c=>c?`${c}`:""})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-2",children:"ឬ តម្លៃសរុប (Total Price):"}),e.jsx("div",{children:e.jsx(w,{style:{width:"100%"},min:0,precision:2,prefix:"$",value:(o=i[t.id])==null?void 0:o.total_price,onChange:c=>z(t.id,c),placeholder:"បញ្ចូលតម្លៃសរុប",formatter:c=>c?`${c}`:""})})]})]}),((s=i[t.id])==null?void 0:s.total_price)>0&&e.jsx("div",{className:"mt-4 text-right",children:e.jsxs(R,{strong:!0,children:["តម្លៃសរុប: $",parseFloat((n=i[t.id])==null?void 0:n.total_price).toLocaleString()]})})]}):null},expandedRowKeys:a}}),e.jsx(q,{}),e.jsx("div",{className:"text-right mb-6",children:e.jsxs(S,{level:4,children:["តម្លៃដីសរុប: $",T.toLocaleString()]})}),e.jsxs("div",{className:"flex justify-between mt-6",children:[e.jsx(v,{href:route(l.document_type==="deposit_contract"?"deposit-contracts.select-sellers":"sale-contracts.select-sellers",{id:l.id}),children:"ត្រឡប់"}),e.jsx(v,{type:"primary",onClick:E,loading:I,disabled:a.length===0,children:"បន្ត"})]})]})]})]})}export{Fe as default};
