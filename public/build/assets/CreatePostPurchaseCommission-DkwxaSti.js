import{r as D,j as e,Q as F,B as m,s as c,a as A,h as y}from"./app-mk9C7I_N.js";import{A as B}from"./AdminLayout-CSpn-5iP.js";import{d as S}from"./dayjs.min-DI9V4UpH.js";import{F as a}from"./index-ByQ52J4c.js";import{S as b}from"./index-pKRxIKW4.js";import{R as Y}from"./ArrowLeftOutlined-cOBH5Dj-.js";import{T as k}from"./index-DDFZ7dy0.js";import{C as $,R as w}from"./index-DZTYDYFc.js";import{R as _,C as x}from"./row-CPFUowx7.js";import{I as C}from"./index-BiMKBPmP.js";import{T as I}from"./index-CuozxnK8.js";import{D as M}from"./index-DDZo9mtM.js";import{D as v}from"./index-BrAkZjxA.js";import{R as q}from"./MinusCircleOutlined-DdDkuKGk.js";import{R as E}from"./SaveOutlined-odoOer7R.js";import"./UserOutlined-Do6ZzMFA.js";import"./index-D66KGu5D.js";import"./index-phC_QXgK.js";import"./EllipsisOutlined-DwAdn_jY.js";import"./PurePanel-Bwrv9FGC.js";import"./InboxOutlined-CDGQXwno.js";import"./EditOutlined-CkdCVUZ6.js";import"./getAllowClear-BGHWSs2V.js";import"./useVariants-BUy45nvZ.js";import"./CheckOutlined-CeCjh9xi.js";import"./Input-DUxd1TpC.js";import"./EyeOutlined-CQ17cMyg.js";import"./SearchOutlined-jGh7iI3q.js";import"./DownOutlined-CUiMnNSy.js";import"./CalendarOutlined-DHG6L8yA.js";import"./ClockCircleOutlined-DNAvTwIZ.js";import"./useIcons-CunuZG3Y.js";const{Title:P,Text:be}=k,{TextArea:L}=C;function $e(){const[f]=a.useForm(),[R,h]=D.useState(!1),T=async r=>{var n,l,p,o;h(!0);try{const t=parseFloat(r.total_amount),s=r.payment_steps.reduce((d,z)=>d+parseFloat(z.amount||0),0);if(Math.abs(t-s)>.01){c.error(`ចំនួនសរុបនៃជំហានទូទាត់ ($${s.toFixed(2)}) មិនត្រូវនឹងចំនួនសរុប ($${t.toFixed(2)}) ទេ។ សូមពិនិត្យម្តងទៀត។`),h(!1);return}const i=r.payment_steps.map(d=>({amount:d.amount,due_date:d.due_date.format("YYYY-MM-DD")})),u={...r,payment_steps:i},g=await A.post("/commissions/api/post-purchase",u);g.data.success&&(c.success(g.data.message),y.visit("/commissions/post-purchase"))}catch(t){if((l=(n=t.response)==null?void 0:n.data)!=null&&l.errors){const s=t.response.data.errors;Object.keys(s).forEach(i=>{i==="payment_steps"&&Array.isArray(s[i])?s[i].forEach(u=>{c.error(u)}):f.setFields([{name:i,errors:s[i]}])})}else c.error(((o=(p=t.response)==null?void 0:p.data)==null?void 0:o.message)||"មានបញ្ហាក្នុងការរក្សាទុក")}finally{h(!1)}},j=()=>{y.visit("/commissions/post-purchase")};return e.jsxs(B,{children:[e.jsx(F,{title:"បន្ថែមកុំស្យុងក្រោយទិញ"}),e.jsxs("div",{style:{padding:"24px"},children:[e.jsx("div",{style:{marginBottom:"24px"},children:e.jsxs(b,{align:"center",children:[e.jsx(m,{icon:e.jsx(Y,{}),onClick:j,type:"text"}),e.jsx(P,{level:2,style:{margin:0,textAlign:"center"},children:"បន្ថែមកុំស្យុងក្រោយទិញ"})]})}),e.jsx($,{children:e.jsxs(a,{form:f,layout:"vertical",onFinish:T,initialValues:{payment_steps:[{amount:null,due_date:null}]},children:[e.jsxs(_,{gutter:24,children:[e.jsx(x,{xs:24,md:12,children:e.jsx(a.Item,{name:"recipient_name",label:"ឈ្មោះអ្នកទទួល",rules:[{required:!0,message:"សូមបញ្ចូលឈ្មោះអ្នកទទួល"}],children:e.jsx(C,{placeholder:"បញ្ចូលឈ្មោះអ្នកទទួល",size:"large"})})}),e.jsx(x,{xs:24,md:12,children:e.jsx(a.Item,{name:"total_amount",label:"ចំនួនសរុប",rules:[{required:!0,message:"សូមបញ្ចូលចំនួនសរុប"},{type:"number",min:.01,message:"ចំនួនទឹកប្រាក់ត្រូវតែធំជាង 0"}],children:e.jsx(I,{placeholder:"បញ្ចូលចំនួនសរុប",style:{width:"100%"},size:"large",formatter:r=>`$ ${r}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:r=>r.replace(/\$\s?|(,*)/g,""),precision:2})})})]}),e.jsx(a.Item,{name:"description",label:"ការពិពណ៌នា",children:e.jsx(L,{placeholder:"បញ្ចូលការពិពណ៌នា (ស្រេចចិត្ត)",rows:4,size:"large"})}),e.jsx(M,{children:"ជំហានទូទាត់"}),e.jsx(a.List,{name:"payment_steps",children:(r,{add:n,remove:l})=>e.jsxs(e.Fragment,{children:[r.map(({key:p,name:o,...t})=>e.jsx($,{size:"small",style:{marginBottom:"16px",backgroundColor:"#fafafa"},title:`ជំហានទី ${o+1}`,extra:r.length>1&&e.jsx(m,{type:"link",danger:!0,icon:e.jsx(q,{}),onClick:()=>l(o),size:"small",children:"លុប"}),children:e.jsxs(_,{gutter:16,children:[e.jsx(x,{xs:24,md:12,children:e.jsx(a.Item,{...t,name:[o,"amount"],label:"ចំនួនទឹកប្រាក់",rules:[{required:!0,message:"សូមបញ្ចូលចំនួនទឹកប្រាក់"},{type:"number",min:.01,message:"ចំនួនទឹកប្រាក់ត្រូវតែធំជាង 0"}],children:e.jsx(I,{placeholder:"ចំនួនទឹកប្រាក់",style:{width:"100%"},formatter:s=>`$ ${s}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:s=>s.replace(/\$\s?|(,*)/g,""),precision:2})})}),e.jsx(x,{xs:24,md:12,children:e.jsx(a.Item,{...t,name:[o,"due_date"],label:"កាលបរិច្ឆេទ",rules:[{required:!0,message:"សូមជ្រើសរើសកាលបរិច្ឆេទ"}],children:e.jsx(v,{placeholder:"កាលបរិច្ឆេទ",style:{width:"100%"},format:"DD/MM/YYYY",disabledDate:s=>s&&s<S().endOf("day")})})})]})},p)),e.jsx(m,{type:"dashed",onClick:()=>n(),block:!0,icon:e.jsx(w,{}),size:"large",style:{marginBottom:"24px"},children:"បន្ថែមជំហាន"})]})}),e.jsx("div",{style:{textAlign:"right",paddingTop:"16px",borderTop:"1px solid #f0f0f0"},children:e.jsxs(b,{size:"middle",children:[e.jsx(m,{size:"large",onClick:j,children:"បោះបង់"}),e.jsx(m,{type:"primary",htmlType:"submit",loading:R,icon:e.jsx(E,{}),size:"large",children:"រក្សាទុក"})]})})]})})]})]})}export{$e as default};
