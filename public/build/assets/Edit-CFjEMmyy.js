import{r as m,j as e,Q as E,t as I,S,d as w}from"./app-D0OhDuOP.js";import{A as B}from"./AdminLayout-DfyZC7U7.js";import{F as T}from"./FileUpload-C1UEOMq6.js";import{F as s}from"./index-01QrSur2.js";import{C as x}from"./index-BXZQm44E.js";import{R as V}from"./FileAddOutlined-PNzBbgEh.js";import{R as c,C as l}from"./row-Cvvd4www.js";import{I as n}from"./index-DyIYvMCA.js";import{T as h}from"./index-Dx6sVVHZ.js";import{S as R}from"./index-BXlDNFm_.js";import{R as k}from"./EnvironmentOutlined-C6fAnWDm.js";import{B as L}from"./Breadcrumb-XIs-K6bQ.js";import{T as D}from"./index-DUD5X347.js";import{S as $}from"./index-DeYg2bFH.js";import{B as u}from"./index-XQ9uBlxv.js";import{R as P}from"./ArrowLeftOutlined-DaEIyD4l.js";import{S as A}from"./index-CpY42lHj.js";import{R as Q}from"./ArrowRightOutlined-B6_dIG3C.js";import{R as M}from"./SaveOutlined-D-cLyBdL.js";import{s as z}from"./index-VXrvBi_7.js";import"./UserOutlined-Bw1Yg3TV.js";import"./index-BKPGZTnh.js";import"./EllipsisOutlined-BcUT9_x5.js";import"./PurePanel-BrlMViLC.js";import"./index-BoUcoXbW.js";import"./index-DxlGwFBo.js";import"./useClosable-rmjEiMr1.js";import"./CloseOutlined-CSg-7HVH.js";import"./pickAttrs-BMtZpb9Y.js";import"./extendsObject-78o_rR5W.js";import"./CheckOutlined-C-W3vkf9.js";import"./EyeOutlined-Bk9sN1n5.js";import"./CheckCircleOutlined-_P5yC29H.js";import"./index-DSx0c0nZ.js";import"./ExclamationCircleFilled-BuCwC-hN.js";import"./InfoCircleFilled-Csbq1HVY.js";import"./ActionButton-DPI_9ZHB.js";import"./Skeleton-BB1PfEPR.js";import"./index-BNYa27A7.js";import"./DeleteOutlined-C5fTVnAq.js";import"./FilePdfOutlined-BmX1d_m5.js";import"./FileImageOutlined-6X7nxdKY.js";import"./index-FPFFDuuk.js";import"./DownloadOutlined-BFocYQwA.js";import"./progress-CZwQN1Wi.js";import"./index-Bjcdw0HM.js";import"./UploadOutlined-qPHS_ZnN.js";import"./useVariants-VmmnPvRy.js";import"./getAllowClear-7r21EHJH.js";import"./Input-DIi4XD1o.js";import"./SearchOutlined-DdbS1Qlk.js";import"./EditOutlined-BQAB7wjt.js";import"./DownOutlined-BKT6hG3e.js";import"./useIcons-De8HtjeC.js";const{Title:O,Text:He}=D,{Step:U}=$,{Option:j}=R;function G({land:t,documents:p}){const[f]=s.useForm(),[o,_]=m.useState(0),[g,b]=m.useState([]),[q,y]=m.useState(!1),[a,v]=m.useState({title_deed_number:t.title_deed_number,location:t.location,province:t.province,district:t.district,commune:t.commune,village:t.village,size:t.size,size_unit:t.size_unit,price_per_unit:t.price_per_unit,total_price:t.total_price});m.useEffect(()=>{if(p&&p.length>0){const r=p.map(i=>({uid:i.id,name:i.file_name,status:"done",url:`/storage/${i.file_path}`,isExisting:!0,id:i.id,isDisplay:i.is_display}));b(r)}},[p]),m.useEffect(()=>{if(a.size&&a.price_per_unit){const r=a.size*a.price_per_unit;v(i=>({...i,total_price:r})),f.setFieldsValue({total_price:r})}},[a.size,a.price_per_unit]);const d=[{title:"ឯកសារ",icon:e.jsx(V,{}),content:e.jsx(x,{title:"បញ្ចូលឯកសារ",className:"mb-6",children:e.jsx(T,{fileList:g,setFileList:b,maxFiles:2})})},{title:"ព័ត៌មានដី",icon:e.jsx(k,{}),content:e.jsx(x,{title:"បញ្ចូលព័ត៌មានដី",className:"mb-6",children:e.jsxs(s,{form:f,layout:"vertical",initialValues:{title_deed_number:t.title_deed_number,location:t.location,province:t.province,district:t.district,commune:t.commune,village:t.village,size:t.size,size_unit:t.size_unit,price_per_unit:t.price_per_unit,total_price:t.total_price},onValuesChange:(r,i)=>{v({...a,...r})},children:[e.jsxs(c,{gutter:16,children:[e.jsx(l,{xs:24,md:12,children:e.jsx(s.Item,{label:"លេខប្លង់",name:"title_deed_number",rules:[{required:!0,message:"សូមបញ្ចូលលេខប្លង់"}],children:e.jsx(n,{placeholder:"បញ្ចូលលេខប្លង់"})})}),e.jsx(l,{xs:24,md:12,children:e.jsx(s.Item,{label:"ទីតាំង",name:"location",rules:[{required:!0,message:"សូមបញ្ចូលទីតាំង"}],children:e.jsx(n,{placeholder:"បញ្ចូលទីតាំង"})})})]}),e.jsxs(c,{gutter:16,children:[e.jsx(l,{xs:24,md:12,children:e.jsx(s.Item,{label:"ខេត្ត/ក្រុង",name:"province",rules:[{required:!0,message:"សូមបញ្ចូលខេត្ត/ក្រុង"}],children:e.jsx(n,{placeholder:"បញ្ចូលខេត្ត/ក្រុង"})})}),e.jsx(l,{xs:24,md:12,children:e.jsx(s.Item,{label:"ស្រុក/ខណ្ឌ",name:"district",rules:[{required:!0,message:"សូមបញ្ចូលស្រុក/ខណ្ឌ"}],children:e.jsx(n,{placeholder:"បញ្ចូលស្រុក/ខណ្ឌ"})})})]}),e.jsxs(c,{gutter:16,children:[e.jsx(l,{xs:24,md:12,children:e.jsx(s.Item,{label:"ឃុំ/សង្កាត់",name:"commune",rules:[{required:!0,message:"សូមបញ្ចូលឃុំ/សង្កាត់"}],children:e.jsx(n,{placeholder:"បញ្ចូលឃុំ/សង្កាត់"})})}),e.jsx(l,{xs:24,md:12,children:e.jsx(s.Item,{label:"ភូមិ",name:"village",rules:[{required:!0,message:"សូមបញ្ចូលភូមិ"}],children:e.jsx(n,{placeholder:"បញ្ចូលភូមិ"})})})]}),e.jsxs(c,{gutter:16,children:[e.jsx(l,{xs:24,md:8,children:e.jsx(s.Item,{label:"ទំហំ",name:"size",rules:[{required:!0,message:"សូមបញ្ចូលទំហំ"}],children:e.jsx(h,{style:{width:"100%"},min:0,placeholder:"បញ្ចូលទំហំ"})})}),e.jsx(l,{xs:24,md:4,children:e.jsx(s.Item,{label:"ឯកតា",name:"size_unit",rules:[{required:!0,message:"សូមជ្រើសរើសឯកតា"}],children:e.jsxs(R,{placeholder:"ជ្រើសរើសឯកតា",children:[e.jsx(j,{value:"sqm",children:"ម៉ែត្រការ៉េ"}),e.jsx(j,{value:"hectare",children:"ហិកតា"}),e.jsx(j,{value:"acre",children:"អាក្រ"})]})})}),e.jsx(l,{xs:24,md:12,children:e.jsx(s.Item,{label:"តម្លៃក្នុងមួយឯកតា",name:"price_per_unit",rules:[{required:!0,message:"សូមបញ្ចូលតម្លៃក្នុងមួយឯកតា"}],children:e.jsx(h,{style:{width:"100%"},min:0,formatter:r=>`$ ${r}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:r=>r.replace(/\$\s?|(,*)/g,""),placeholder:"បញ្ចូលតម្លៃក្នុងមួយឯកតា"})})})]}),e.jsx(s.Item,{label:"តម្លៃសរុប",name:"total_price",children:e.jsx(h,{style:{width:"100%"},min:0,formatter:r=>`$ ${r}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:r=>r.replace(/\$\s?|(,*)/g,""),placeholder:"តម្លៃសរុប",disabled:!0})})]})})}],C=async()=>{o===0&&_(o+1)},F=()=>{_(o-1)},N=async()=>{try{y(!0);const r={...a,documents:g.map(i=>({id:i.id,isExisting:i.isExisting||!1,tempPath:i.tempPath,fileName:i.name,isDisplay:i.isDisplay||!1}))};await w.put(`/api/lands/${t.id}`,r),z.success("ដីត្រូវបានកែប្រែដោយជោគជ័យ"),S.visit(route("data-entry.lands.index"))}catch(r){console.error("Error updating land:",r),z.error("មានបញ្ហាក្នុងការកែប្រែដី")}finally{y(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(E,{title:"កែប្រែដី"}),e.jsxs("div",{className:"land-edit",children:[e.jsx(L,{items:[{title:e.jsx(I,{href:route("data-entry.index"),children:"ជ្រើសរើសប្រភេទទិន្នន័យ"})},{title:e.jsx(I,{href:route("data-entry.lands.index"),children:"បញ្ជីដី"})},{title:"កែប្រែដី"}],className:"mb-6"}),e.jsxs(x,{children:[e.jsx(O,{level:4,className:"khmer-heading mb-6",children:"កែប្រែដី"}),e.jsx($,{current:o,className:"mb-8",children:d.map(r=>e.jsx(U,{title:r.title,icon:r.icon},r.title))}),e.jsx("div",{className:"steps-content mb-6",children:d[o].content}),e.jsx("div",{className:"steps-action",children:e.jsxs(c,{justify:"space-between",children:[e.jsx(l,{children:o>0&&e.jsx(u,{icon:e.jsx(P,{}),onClick:F,children:"ត្រឡប់ក្រោយ"})}),e.jsx(l,{children:e.jsxs(A,{children:[e.jsx(u,{onClick:()=>S.visit(route("data-entry.lands.index")),children:"បោះបង់"}),o<d.length-1&&e.jsx(u,{type:"primary",onClick:C,icon:e.jsx(Q,{}),children:"បន្ទាប់"}),o===d.length-1&&e.jsx(u,{type:"primary",onClick:N,loading:q,icon:e.jsx(M,{}),children:"រក្សាទុក"})]})})]})})]})]})]})}G.layout=t=>e.jsx(B,{title:"កែប្រែដី",children:t});export{G as default};
