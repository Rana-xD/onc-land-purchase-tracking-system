import{r as h,j as e,Q as $,t as I,d as S,S as M}from"./app-D0OhDuOP.js";import{A as B}from"./AdminLayout-DfyZC7U7.js";import{F as q}from"./FileUpload-C1UEOMq6.js";import{d as z}from"./dayjs.min-Bgh6-5v4.js";import{F as n}from"./index-01QrSur2.js";import{T as A}from"./index-DUD5X347.js";import{R as L}from"./FileOutlined-CmtzEeI9.js";import{I as u}from"./index-DyIYvMCA.js";import{T as O}from"./index-Dx6sVVHZ.js";import{D as Q}from"./index-C98K_sL4.js";import{R as U}from"./EnvironmentOutlined-C6fAnWDm.js";import{C as g}from"./index-BXZQm44E.js";import{R,C as l}from"./row-Cvvd4www.js";import{R as P}from"./CheckOutlined-C-W3vkf9.js";import{B as G}from"./Breadcrumb-XIs-K6bQ.js";import{S as D}from"./index-DeYg2bFH.js";import{D as H}from"./index-BoUcoXbW.js";import{B as b}from"./index-XQ9uBlxv.js";import{R as J}from"./ArrowLeftOutlined-DaEIyD4l.js";import{R as K}from"./SaveOutlined-D-cLyBdL.js";import{s as N}from"./index-VXrvBi_7.js";import"./UserOutlined-Bw1Yg3TV.js";import"./index-BKPGZTnh.js";import"./EllipsisOutlined-BcUT9_x5.js";import"./PurePanel-BrlMViLC.js";import"./index-CpY42lHj.js";import"./index-DxlGwFBo.js";import"./useClosable-rmjEiMr1.js";import"./CloseOutlined-CSg-7HVH.js";import"./pickAttrs-BMtZpb9Y.js";import"./extendsObject-78o_rR5W.js";import"./EyeOutlined-Bk9sN1n5.js";import"./CheckCircleOutlined-_P5yC29H.js";import"./index-DSx0c0nZ.js";import"./ExclamationCircleFilled-BuCwC-hN.js";import"./InfoCircleFilled-Csbq1HVY.js";import"./ActionButton-DPI_9ZHB.js";import"./Skeleton-BB1PfEPR.js";import"./index-BNYa27A7.js";import"./DeleteOutlined-C5fTVnAq.js";import"./FilePdfOutlined-BmX1d_m5.js";import"./FileImageOutlined-6X7nxdKY.js";import"./index-FPFFDuuk.js";import"./DownloadOutlined-BFocYQwA.js";import"./progress-CZwQN1Wi.js";import"./index-Bjcdw0HM.js";import"./UploadOutlined-qPHS_ZnN.js";import"./EditOutlined-BQAB7wjt.js";import"./getAllowClear-7r21EHJH.js";import"./useVariants-VmmnPvRy.js";import"./Input-DIi4XD1o.js";import"./SearchOutlined-DdbS1Qlk.js";import"./DownOutlined-BKT6hG3e.js";import"./CalendarOutlined-C5Gy31PM.js";import"./ClockCircleOutlined-BGruiaAm.js";import"./useIcons-De8HtjeC.js";const{Title:x,Text:i}=A,{Step:es}=D;function W({land:r,documents:c}){var k;const[t]=n.useForm(),[a,y]=h.useState(0),[Y,F]=h.useState(!1),[j,v]=h.useState([]),d=!!r;h.useEffect(()=>{r&&(t.setFieldsValue({...r,date_of_registration:r.date_of_registration?z(r.date_of_registration):null}),c&&v(c))},[r,c]);const C=s=>{v(s)},w=async s=>{F(!0);try{const o={...s,date_of_registration:s.date_of_registration?s.date_of_registration.format("YYYY-MM-DD"):null,documents:j};let m;d?(m=await S.put(`/api/lands/${r.id}`,o),N.success("ព័ត៌មានដីត្រូវបានកែប្រែដោយជោគជ័យ")):(m=await S.post("/api/lands",o),N.success("ព័ត៌មានដីត្រូវបានបង្កើតដោយជោគជ័យ")),M.visit(route("data-entry.lands.index"))}catch(o){if(console.error("Error saving land:",o),o.response&&o.response.data&&o.response.data.errors){const m=o.response.data.errors,_={};Object.keys(m).forEach(f=>{_[f]={name:f,errors:[m[f][0]]}}),t.setFields(Object.values(_))}else N.error("មានបញ្ហាក្នុងការរក្សាទុកព័ត៌មានដី")}finally{F(!1)}},E=()=>{t.validateFields().then(()=>{y(a+1)}).catch(s=>{console.log("Validation failed:",s)})},T=()=>{y(a-1)},V=s=>`${Number(s).toLocaleString("en-US",{maximumFractionDigits:2})} ម²`,p=[{title:"ឯកសារ",icon:e.jsx(L,{}),content:e.jsxs("div",{className:"document-step",children:[e.jsx(q,{category:"land",referenceId:r==null?void 0:r.id,initialFiles:c||[],onFilesChange:C,maxFiles:4}),e.jsx("div",{className:"mt-6",children:e.jsx(i,{type:"danger",className:"khmer-text",children:"* សូមផ្ទុកឡើងយ៉ាងហោចណាស់ឯកសារមួយ និងកំណត់ឯកសារមួយជាឯកសារបង្ហាញ"})})]})},{title:"ព័ត៌មានដី",icon:e.jsx(U,{}),content:e.jsxs("div",{className:"land-info-step",children:[e.jsx(n.Item,{label:"លេខក្បាលដី",name:"plot_number",rules:[{required:!0,message:"សូមបញ្ចូលលេខក្បាលដី"}],children:e.jsx(u,{placeholder:"បញ្ចូលលេខក្បាលដី"})}),e.jsx(n.Item,{label:"ទំហំ (ម²)",name:"size",rules:[{required:!0,message:"សូមបញ្ចូលទំហំដី"}],children:e.jsx(O,{style:{width:"100%"},placeholder:"បញ្ចូលទំហំដី",min:0,step:.01,formatter:s=>`${s}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:s=>s.replace(/\$\s?|(,*)/g,"")})}),e.jsx(n.Item,{label:"ទីតាំង",name:"location",rules:[{required:!0,message:"សូមបញ្ចូលទីតាំងដី"}],children:e.jsx(u.TextArea,{rows:4,placeholder:"បញ្ចូលទីតាំងដី"})}),e.jsx(n.Item,{label:"កាលបរិច្ឆេទចុះបញ្ជី",name:"date_of_registration",rules:[{required:!0,message:"សូមជ្រើសរើសកាលបរិច្ឆេទចុះបញ្ជី"}],children:e.jsx(Q,{style:{width:"100%"},format:"YYYY-MM-DD",placeholder:"ជ្រើសរើសកាលបរិច្ឆេទចុះបញ្ជី"})}),e.jsx(n.Item,{label:"កំណត់សម្គាល់",name:"notes",children:e.jsx(u.TextArea,{rows:4,placeholder:"បញ្ចូលកំណត់សម្គាល់"})})]})},{title:"បញ្ចប់",icon:e.jsx(P,{}),content:e.jsxs("div",{className:"confirmation-step",children:[e.jsx(x,{level:4,className:"khmer-heading mb-4",children:"បញ្ជាក់ព័ត៌មាន"}),e.jsx(i,{className:"khmer-text mb-6 block",children:"សូមពិនិត្យមើលព័ត៌មានដែលបានបញ្ចូលម្តងទៀត មុនពេលរក្សាទុក។"}),e.jsxs(g,{className:"mb-4",children:[e.jsx(x,{level:5,className:"khmer-heading mb-4",children:"ព័ត៌មានដី"}),e.jsxs(R,{gutter:[16,16],children:[e.jsxs(l,{span:12,children:[e.jsx(i,{strong:!0,className:"khmer-text",children:"លេខក្បាលដី:"}),e.jsx("div",{children:t.getFieldValue("plot_number")})]}),e.jsxs(l,{span:12,children:[e.jsx(i,{strong:!0,className:"khmer-text",children:"ទំហំ:"}),e.jsx("div",{children:t.getFieldValue("size")?V(t.getFieldValue("size")):""})]}),e.jsxs(l,{span:24,children:[e.jsx(i,{strong:!0,className:"khmer-text",children:"ទីតាំង:"}),e.jsx("div",{children:t.getFieldValue("location")})]}),e.jsxs(l,{span:12,children:[e.jsx(i,{strong:!0,className:"khmer-text",children:"កាលបរិច្ឆេទចុះបញ្ជី:"}),e.jsx("div",{children:(k=t.getFieldValue("date_of_registration"))==null?void 0:k.format("YYYY-MM-DD")})]}),e.jsxs(l,{span:24,children:[e.jsx(i,{strong:!0,className:"khmer-text",children:"កំណត់សម្គាល់:"}),e.jsx("div",{children:t.getFieldValue("notes")||"គ្មាន"})]})]})]}),e.jsxs(g,{children:[e.jsx(x,{level:5,className:"khmer-heading mb-4",children:"ឯកសារ"}),e.jsxs(i,{className:"khmer-text mb-2 block",children:["ចំនួនឯកសារ: ",j.length]}),j.length===0&&e.jsx(i,{type:"danger",className:"khmer-text",children:"មិនមានឯកសារត្រូវបានផ្ទុកឡើងទេ"})]})]})}];return e.jsxs(e.Fragment,{children:[e.jsx($,{title:d?"កែប្រែព័ត៌មានដី":"បង្កើតព័ត៌មានដីថ្មី"}),e.jsxs("div",{className:"land-form",children:[e.jsx(G,{items:[{title:e.jsx(I,{href:route("data-entry.index"),children:"ជ្រើសរើសប្រភេទទិន្នន័យ"})},{title:e.jsx(I,{href:route("data-entry.lands.index"),children:"បញ្ជីដី"})},{title:d?"កែប្រែព័ត៌មានដី":"បង្កើតព័ត៌មានដីថ្មី"}],className:"mb-6"}),e.jsxs(g,{children:[e.jsx(x,{level:4,className:"khmer-heading mb-6",children:d?"កែប្រែព័ត៌មានដី":"បង្កើតព័ត៌មានដីថ្មី"}),e.jsx(D,{current:a,items:p.map(s=>({title:s.title,icon:s.icon})),className:"mb-8"}),e.jsxs(n,{form:t,layout:"vertical",onFinish:w,className:"mt-6",children:[e.jsx("div",{className:"steps-content",children:p[a].content}),e.jsx(H,{}),e.jsx("div",{className:"steps-action",children:e.jsxs(R,{justify:"space-between",children:[e.jsx(l,{children:a>0&&e.jsx(b,{icon:e.jsx(J,{}),onClick:T,children:"ត្រឡប់ក្រោយ"})}),e.jsxs(l,{children:[a<p.length-1&&e.jsx(b,{type:"primary",onClick:E,children:"បន្ទាប់"}),a===p.length-1&&e.jsx(b,{type:"primary",icon:e.jsx(K,{}),loading:Y,onClick:()=>t.submit(),children:"រក្សាទុក"})]})]})})]})]})]})]})}W.layout=r=>e.jsx(B,{title:r.props.land?"កែប្រែព័ត៌មានដី":"បង្កើតព័ត៌មានដីថ្មី",children:r});export{W as default};
