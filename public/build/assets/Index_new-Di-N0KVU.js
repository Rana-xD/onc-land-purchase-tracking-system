import{r as y,j as r,Q as O,t as W,B as q,a as K,s as L}from"./app-C81v863Z.js";import{A as G,R as J,a as h,b as D}from"./AdminLayout-4hWCCW4J.js";import{C as c,T as U}from"./index-Cq5Cojs-.js";import{B as g}from"./Breadcrumb-4NJyj_rA.js";import{T as V}from"./index-DVx3a9qR.js";import{I as X}from"./index-CfwryaAm.js";import{R as Y}from"./SearchOutlined-rZRKH8d_.js";import{R as Z,C as j}from"./row-DVautw-w.js";import{S as f}from"./index-DO0bQJBi.js";import{R as B}from"./DollarOutlined-CK_MmAZG.js";import{S as d}from"./index-alDFd_10.js";import{F as u}from"./Table-9Jun1Fn2.js";import{R as ee,a as re}from"./RollbackOutlined-DR2LUgpk.js";import{T as oe}from"./index-oMLWggrR.js";import{P as ne}from"./index-DhmPHNZK.js";import"./UserOutlined-Cs_VmhTJ.js";import"./index-hGIK_HDO.js";import"./index-BDtS0eMa.js";import"./EllipsisOutlined-Dgx-5LTE.js";import"./PurePanel-B9LZ7YRU.js";import"./index-0iedL70p.js";import"./InboxOutlined-NtB6O71W.js";import"./useVariants-DiVBn6uh.js";import"./DownOutlined-Bis42zyM.js";import"./EditOutlined-Dt25MYJV.js";import"./getAllowClear-YBVvCZBt.js";import"./CheckOutlined-BtpNa_G2.js";import"./Input-BSKYPgzP.js";import"./EyeOutlined-B_Q_oTAq.js";import"./addEventListener-CGfbZz05.js";import"./index-CXKhVvIi.js";import"./useIcons-Bcyu7X2C.js";import"./index-Dyio-8w4.js";import"./useBubbleLock-g9XhDwJl.js";import"./index-BXobfGdR.js";import"./Pagination-CQl1u3Ip.js";import"./FileOutlined-CLduoszu.js";import"./FolderOutlined-D8jm1l7w.js";const{Title:ae}=V,{Search:te}=X;function Oe({auth:A,statistics:n,archived:E}){var $,b,v,C,I,N,R,k;const[l,S]=y.useState(!1),[a,F]=y.useState(E||{}),[w,_]=y.useState(""),[M,P]=y.useState("1"),Q=async(e,o)=>{try{S(!0),await K.post("/archive/restore",{type:e,id:o}),L.success("ទិន្នន័យត្រូវបានស្តារដោយជោគជ័យ");const t=await K.get("/archive/type/"+e);F(i=>({...i,[e]:t.data}))}catch(t){console.error("Error restoring:",t),L.error("មានបញ្ហាក្នុងការស្តារទិន្នន័យ")}finally{S(!1)}},s=e=>{switch(e){case"1":return[...(a.buyers||[]).map(o=>({...o,type:"buyers",typeName:"អ្នកទិញ"})),...(a.sellers||[]).map(o=>({...o,type:"sellers",typeName:"អ្នកលក់"})),...(a.lands||[]).map(o=>({...o,type:"lands",typeName:"ដី"}))];case"2":return[...(a.document_creations||[]).map(o=>({...o,type:"document_creations",typeName:"ឯកសារបង្កើត"})),...(a.sale_contracts||[]).map(o=>({...o,type:"sale_contracts",typeName:"កិច្ចសន្យាលក់"}))];case"3":return(a.commissions||[]).map(o=>({...o,type:"commissions",typeName:"កម៉ីសិន"}));case"4":return[...(a.users||[]).map(o=>({...o,type:"users",typeName:"អ្នកប្រើប្រាស់"})),...(a.roles||[]).map(o=>({...o,type:"roles",typeName:"តួនាទី"}))];case"5":return Object.entries(a).flatMap(([o,t])=>{const i={buyers:"អ្នកទិញ",sellers:"អ្នកលក់",lands:"ដី",document_creations:"ឯកសារបង្កើត",sale_contracts:"កិច្ចសន្យាលក់",commissions:"កម៉ីសិន",users:"អ្នកប្រើប្រាស់",roles:"តួនាទី"};return t.map(x=>({...x,type:o,typeName:i[o]||o}))});default:return[]}},H=e=>e?new Date(e).toLocaleDateString("km-KH",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"គ្មាន",T=e=>e.name?e.name:e.title?e.title:e.land_title_number?`ដីលេខ: ${e.land_title_number}`:e.contract_number?`កិច្ចសន្យាលេខ: ${e.contract_number}`:e.commission_type?`កម៉ីសិន ${e.commission_type}`:`#${e.id}`,m=e=>w?e.filter(o=>{var z;const t=T(o).toLowerCase(),i=(((z=o.deleted_by)==null?void 0:z.name)||"").toLowerCase(),x=w.toLowerCase();return t.includes(x)||i.includes(x)}):e,p=[{title:"ប្រភេទ",dataIndex:"typeName",key:"typeName",render:e=>r.jsx(oe,{color:"blue",children:e})},{title:"ឈ្មោះ/លេខសម្គាល់",dataIndex:"name",key:"name",render:(e,o)=>T(o)},{title:"កាលបរិច្ឆេទលុប",dataIndex:"deleted_at",key:"deleted_at",render:e=>H(e)},{title:"លុបដោយ",dataIndex:"deleted_by",key:"deleted_by",render:e=>(e==null?void 0:e.name)||"មិនស្គាល់"},{title:"សកម្មភាព",key:"action",render:(e,o)=>r.jsx(ne,{title:"បញ្ជាក់ការស្តារ",description:"តើអ្នកពិតជាចង់ស្តារទិន្នន័យនេះមែនទេ?",onConfirm:()=>Q(o.type,o.id),okText:"យល់ព្រម",cancelText:"បោះបង់",children:r.jsx(q,{type:"primary",icon:r.jsx(re,{}),size:"small",loading:l,children:"ស្តារឡើងវិញ"})})}];return r.jsxs(G,{user:A.user,children:[r.jsx(O,{title:"ទិន្នន័យ"}),r.jsx("div",{style:{padding:"24px"},children:r.jsxs(c,{children:[r.jsxs(g,{style:{marginBottom:16},children:[r.jsx(g.Item,{children:r.jsxs(W,{href:"/",children:[r.jsx(J,{})," ទំព័រដើម"]})}),r.jsx(g.Item,{children:"ទិន្នន័យ"})]}),r.jsxs("div",{style:{marginBottom:24},children:[r.jsx(ae,{level:3,children:"ទិន្នន័យ"}),r.jsx(te,{placeholder:"ស្វែងរក...",allowClear:!0,enterButton:r.jsx(Y,{}),size:"large",onSearch:e=>_(e),onChange:e=>_(e.target.value),style:{maxWidth:400}})]}),r.jsxs(Z,{gutter:16,style:{marginBottom:24},children:[r.jsx(j,{xs:24,sm:12,md:6,children:r.jsx(c,{children:r.jsx(f,{title:"ទិន្នន័យបញ្ចូល",value:((($=n==null?void 0:n.data_entry)==null?void 0:$.buyers)||0)+(((b=n==null?void 0:n.data_entry)==null?void 0:b.sellers)||0)+(((v=n==null?void 0:n.data_entry)==null?void 0:v.lands)||0),prefix:r.jsx(h,{}),valueStyle:{color:"#1890ff"}})})}),r.jsx(j,{xs:24,sm:12,md:6,children:r.jsx(c,{children:r.jsx(f,{title:"កិច្ចសន្យា",value:(((C=n==null?void 0:n.contracts)==null?void 0:C.document_creations)||0)+(((I=n==null?void 0:n.contracts)==null?void 0:I.sale_contracts)||0),prefix:r.jsx(h,{}),valueStyle:{color:"#52c41a"}})})}),r.jsx(j,{xs:24,sm:12,md:6,children:r.jsx(c,{children:r.jsx(f,{title:"កម៉ីសិន",value:((N=n==null?void 0:n.commissions)==null?void 0:N.total)||0,prefix:r.jsx(B,{}),valueStyle:{color:"#faad14"}})})}),r.jsx(j,{xs:24,sm:12,md:6,children:r.jsx(c,{children:r.jsx(f,{title:"អ្នកប្រើប្រាស់",value:(((R=n==null?void 0:n.users)==null?void 0:R.users)||0)+(((k=n==null?void 0:n.users)==null?void 0:k.roles)||0),prefix:r.jsx(D,{}),valueStyle:{color:"#722ed1"}})})})]}),r.jsx(U,{activeKey:M,onChange:P,items:[{key:"1",label:r.jsxs("span",{children:[r.jsx(h,{}),"ទិន្នន័យបញ្ចូល"]}),children:r.jsx(d,{spinning:l,children:r.jsx(u,{columns:p,dataSource:m(s("1")),rowKey:e=>`${e.type}-${e.id}`,pagination:{pageSize:10,showSizeChanger:!0,showTotal:e=>`សរុប ${e} ទិន្នន័យ`},locale:{emptyText:"មិនមានទិន្នន័យក្នុងទិន្នន័យ"}})})},{key:"2",label:r.jsxs("span",{children:[r.jsx(h,{}),"កិច្ចសន្យា"]}),children:r.jsx(d,{spinning:l,children:r.jsx(u,{columns:p,dataSource:m(s("2")),rowKey:e=>`${e.type}-${e.id}`,pagination:{pageSize:10,showSizeChanger:!0,showTotal:e=>`សរុប ${e} ទិន្នន័យ`},locale:{emptyText:"មិនមានទិន្នន័យក្នុងទិន្នន័យ"}})})},{key:"3",label:r.jsxs("span",{children:[r.jsx(B,{}),"កម៉ីសិន"]}),children:r.jsx(d,{spinning:l,children:r.jsx(u,{columns:p,dataSource:m(s("3")),rowKey:e=>`${e.type}-${e.id}`,pagination:{pageSize:10,showSizeChanger:!0,showTotal:e=>`សរុប ${e} ទិន្នន័យ`},locale:{emptyText:"មិនមានទិន្នន័យក្នុងទិន្នន័យ"}})})},{key:"4",label:r.jsxs("span",{children:[r.jsx(D,{}),"អ្នកប្រើប្រាស់"]}),children:r.jsx(d,{spinning:l,children:r.jsx(u,{columns:p,dataSource:m(s("4")),rowKey:e=>`${e.type}-${e.id}`,pagination:{pageSize:10,showSizeChanger:!0,showTotal:e=>`សរុប ${e} ទិន្នន័យ`},locale:{emptyText:"មិនមានទិន្នន័យក្នុងទិន្នន័យ"}})})},{key:"5",label:r.jsxs("span",{children:[r.jsx(ee,{}),"ទាំងអស់"]}),children:r.jsx(d,{spinning:l,children:r.jsx(u,{columns:p,dataSource:m(s("5")),rowKey:e=>`${e.type}-${e.id}`,pagination:{pageSize:10,showSizeChanger:!0,showTotal:e=>`សរុប ${e} ទិន្នន័យ`},locale:{emptyText:"មិនមានទិន្នន័យក្នុងទិន្នន័យ"}})})}]})]})})]})}export{Oe as default};
