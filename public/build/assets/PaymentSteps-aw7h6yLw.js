import{J as T,r as l,j as e,Q as Y,d as h}from"./app-D0OhDuOP.js";import{A as k,b as L}from"./AdminLayout-DfyZC7U7.js";import{d as P}from"./dayjs.min-Bgh6-5v4.js";import{F as m}from"./index-01QrSur2.js";import{C as x,R as A}from"./index-BXZQm44E.js";import{S as q}from"./index-DeYg2bFH.js";import{T as z}from"./index-DUD5X347.js";import{D as j}from"./index-BoUcoXbW.js";import{B as p}from"./index-XQ9uBlxv.js";import{R as B}from"./DeleteOutlined-C5fTVnAq.js";import{I as Q}from"./index-DyIYvMCA.js";import{T as G}from"./index-Dx6sVVHZ.js";import{D as H}from"./index-C98K_sL4.js";import{s as c}from"./index-VXrvBi_7.js";import{R as J}from"./UserOutlined-Bw1Yg3TV.js";import{R as K}from"./EnvironmentOutlined-C6fAnWDm.js";import{R as O}from"./DollarOutlined-BgkhO_OZ.js";import{R as U}from"./FileOutlined-CmtzEeI9.js";import"./index-BKPGZTnh.js";import"./EllipsisOutlined-BcUT9_x5.js";import"./PurePanel-BrlMViLC.js";import"./index-CpY42lHj.js";import"./row-Cvvd4www.js";import"./index-BNYa27A7.js";import"./CheckOutlined-C-W3vkf9.js";import"./ExclamationCircleFilled-BuCwC-hN.js";import"./CloseOutlined-CSg-7HVH.js";import"./Skeleton-BB1PfEPR.js";import"./useVariants-VmmnPvRy.js";import"./progress-CZwQN1Wi.js";import"./EditOutlined-BQAB7wjt.js";import"./getAllowClear-7r21EHJH.js";import"./Input-DIi4XD1o.js";import"./pickAttrs-BMtZpb9Y.js";import"./EyeOutlined-Bk9sN1n5.js";import"./SearchOutlined-DdbS1Qlk.js";import"./DownOutlined-BKT6hG3e.js";import"./CalendarOutlined-C5Gy31PM.js";import"./ClockCircleOutlined-BGruiaAm.js";import"./useIcons-De8HtjeC.js";import"./InfoCircleFilled-Csbq1HVY.js";const{Title:_,Text:d}=z;function Le({document:o,paymentSteps:y}){const{csrf_token:u}=T().props,[g,f]=l.useState(!1),[b]=m.useForm(),[a,i]=l.useState(y||[{step_number:1,amount:"",due_date:null,payment_time_description:""}]),[n,S]=l.useState(0),[v,$]=l.useState(!0);l.useEffect(()=>{let s=0,r=!1;a.forEach(t=>{t.amount&&(s+=parseFloat(t.amount)),(!t.amount||!t.due_date||!t.payment_time_description)&&(r=!0)}),S(s),$(r)},[a]);const D=()=>{const s=a.length+1;i([...a,{step_number:s,amount:"",due_date:null,payment_time_description:""}])},N=s=>{if(a.length<=1){c.error("យ៉ាងហោចណាស់ត្រូវមានដំណាក់កាលបង់ប្រាក់មួយ");return}const r=[...a];r.splice(s,1),r.forEach((t,E)=>{t.step_number=E+1}),i(r)},w=(s,r)=>{const t=[...a];t[s].amount=r,i(t)},I=(s,r)=>{const t=[...a];t[s].due_date=r?r.format("YYYY-MM-DD"):null,i(t)},R=(s,r)=>{const t=[...a];t[s].payment_time_description=r,i(t)},F=async()=>{if(a.some(t=>!t.amount||!t.due_date||!t.payment_time_description)){c.error("សូមបញ្ចូលចំនួនទឹកប្រាក់, កាលបរិច្ឆេទ និងពេលវេលាបង់ប្រាក់សម្រាប់ដំណាក់កាលទាំងអស់");return}const r=parseFloat(o.total_land_price);if(Math.abs(n-r)>.01){c.error(`ចំនួនទឹកប្រាក់សរុបត្រូវតែស្មើនឹងតម្លៃដីសរុប ($${r.toLocaleString()})`);return}f(!0);try{const t="sale-contracts";await h.post(`/api/${t}/${o.id}/payment-steps`,{payment_steps:a,_token:u}),await h.post(`/api/${t}/${o.id}/generate`,{_token:u}),window.location.href=route("sale-contracts.success",{id:o.id})}catch(t){console.error("បញ្ហាក្នុងការបង្កើតឯកសារ:",t),t.response&&t.response.data&&t.response.data.error?c.error(t.response.data.error):c.error("មានបញ្ហាក្នុងការបង្កើតឯកសារ")}finally{f(!1)}},M=3,C=[{title:"ជ្រើសរើសអ្នកទិញ",icon:e.jsx(J,{})},{title:"ជ្រើសរើសអ្នកលក់",icon:e.jsx(L,{})},{title:"ជ្រើសរើសដី និងកំណត់តម្លៃ",icon:e.jsx(K,{})},{title:"ដំណាក់កាលបង់ប្រាក់",icon:e.jsx(O,{})},{title:"បង្កើតឯកសារ",icon:e.jsx(U,{})}];return e.jsxs(k,{children:[e.jsx(Y,{title:"ដំណាក់កាលបង់ប្រាក់"}),e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsx(x,{className:"mb-6",children:e.jsx(q,{current:M,items:C,responsive:!0,className:"site-navigation-steps",size:"small"})}),e.jsxs(x,{children:[e.jsx(_,{level:3,className:"mb-6",children:"ដំណាក់កាលបង់ប្រាក់"}),e.jsx("div",{className:"mb-6",children:e.jsxs(d,{strong:!0,children:["តម្លៃដីសរុប: $",parseFloat(o.total_land_price).toLocaleString()]})}),e.jsx(j,{}),e.jsxs(m,{form:b,layout:"vertical",children:[a.map((s,r)=>e.jsxs("div",{className:"mb-8 p-4 border rounded-md bg-gray-50",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs(_,{level:5,children:["ដំណាក់កាលទី ",s.step_number]}),e.jsx(p,{danger:!0,icon:e.jsx(B,{}),onClick:()=>N(r),disabled:a.length<=1})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx(m.Item,{label:"ពេលវេលាបង់ប្រាក់ (Payment Time Description)",required:!0,children:e.jsx(Q,{value:s.payment_time_description,onChange:t=>R(r,t.target.value),placeholder:"បញ្ចូលពេលវេលាបង់ប្រាក់"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(m.Item,{label:"ចំនួនទឹកប្រាក់ (Amount)",required:!0,children:e.jsx(G,{style:{width:"100%"},min:0,precision:2,prefix:"$",value:s.amount,onChange:t=>w(r,t),placeholder:"បញ្ចូលចំនួនទឹកប្រាក់"})}),e.jsx(m.Item,{label:"កាលបរិច្ឆេទត្រូវបង់ (Due Date)",required:!0,children:e.jsx(H,{style:{width:"100%"},value:s.due_date?P(s.due_date):null,onChange:t=>I(r,t),placeholder:"ជ្រើសរើសកាលបរិច្ឆេទ",format:"DD/MM/YYYY"})})]})]})]},r)),e.jsx("div",{className:"text-center mb-6",children:e.jsx(p,{type:"dashed",icon:e.jsx(A,{}),onClick:D,children:"បន្ថែមដំណាក់កាលបង់ប្រាក់"})})]}),e.jsx(j,{}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx(d,{strong:!0,children:"ចំនួនទឹកប្រាក់សរុប:"}),e.jsxs(d,{strong:!0,style:{fontSize:"1.2rem",color:Math.abs(n-parseFloat(o.total_land_price))>.01?"red":"green"},children:["$",n.toLocaleString()]})]}),Math.abs(n-parseFloat(o.total_land_price))>.01&&e.jsx("div",{className:"mb-6 p-2 bg-red-50 border border-red-200 rounded text-center",children:e.jsxs(d,{type:"danger",children:["ចំនួនទឹកប្រាក់សរុបត្រូវតែស្មើនឹងតម្លៃដីសរុប ($",parseFloat(o.total_land_price).toLocaleString(),")"]})}),e.jsxs("div",{className:"flex justify-between mt-6",children:[e.jsx(p,{href:route("sale-contracts.select-lands",{id:o.id}),children:"ត្រឡប់"}),e.jsx(p,{type:"primary",onClick:F,loading:g,disabled:Math.abs(n-parseFloat(o.total_land_price))>.01||v,children:"បង្កើតឯកសារ"})]})]})]})]})}export{Le as default};
