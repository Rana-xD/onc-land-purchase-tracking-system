import{r as g,j as t,Q as R,S as z,d as W}from"./app-D0OhDuOP.js";import{A as $,B as E}from"./AdminLayout-DfyZC7U7.js";import{d as c}from"./dayjs.min-Bgh6-5v4.js";import{F as p}from"./index-01QrSur2.js";import{S as M}from"./index-CpY42lHj.js";import{B as x,T as K}from"./index-XQ9uBlxv.js";import{R as Q}from"./ArrowLeftOutlined-DaEIyD4l.js";import{T as V}from"./index-DUD5X347.js";import{C as o}from"./index-BXZQm44E.js";import{D as h}from"./index-orZlTmla.js";import{R as H,C as j}from"./row-Cvvd4www.js";import{F as L}from"./Table-CJMywyvl.js";import{M as N}from"./index-DSx0c0nZ.js";import{I as U}from"./index-DyIYvMCA.js";import{s as I}from"./index-VXrvBi_7.js";import{R as q}from"./CheckCircleOutlined-_P5yC29H.js";import"./UserOutlined-Bw1Yg3TV.js";import"./index-BKPGZTnh.js";import"./EllipsisOutlined-BcUT9_x5.js";import"./PurePanel-BrlMViLC.js";import"./index-BoUcoXbW.js";import"./CheckOutlined-C-W3vkf9.js";import"./ExclamationCircleFilled-BuCwC-hN.js";import"./CloseOutlined-CSg-7HVH.js";import"./EditOutlined-BQAB7wjt.js";import"./getAllowClear-7r21EHJH.js";import"./useVariants-VmmnPvRy.js";import"./Skeleton-BB1PfEPR.js";import"./index-BNYa27A7.js";import"./pickAttrs-BMtZpb9Y.js";import"./addEventListener-Dvq9iQDE.js";import"./index-BXlDNFm_.js";import"./useIcons-De8HtjeC.js";import"./DownOutlined-BKT6hG3e.js";import"./SearchOutlined-DdbS1Qlk.js";import"./index-CxyNWzZ_.js";import"./useBubbleLock-Dp5g0NxF.js";import"./index-HowiUfuo.js";import"./Pagination-C28t5-1k.js";import"./index-Bjcdw0HM.js";import"./extendsObject-78o_rR5W.js";import"./FileOutlined-CmtzEeI9.js";import"./FolderOutlined-CsvjmU0T.js";import"./Input-DIi4XD1o.js";import"./InfoCircleFilled-Csbq1HVY.js";import"./ActionButton-DPI_9ZHB.js";import"./useClosable-rmjEiMr1.js";import"./EyeOutlined-Bk9sN1n5.js";const{Title:G,Text:r}=V,{TextArea:J}=U;function Lt({commission:i}){const[Y,u]=g.useState(!1),[n,y]=g.useState(null),[d]=p.useForm(),[a,F]=g.useState(i.payment_steps||[]),l=e=>new Intl.NumberFormat("km-KH",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(e||0),_=()=>{z.visit("/commissions/post-purchase")},v=e=>{y(e),u(!0),d.resetFields()},S=()=>{u(!1),y(null),d.resetFields()},A=async e=>{var s,k;try{const m=await W.patch(`/commissions/api/payment-steps/${n.id}/mark-paid`,e);m.data.success&&(I.success(m.data.message),u(!1),y(null),d.resetFields(),F(w=>w.map(f=>f.id===n.id?{...f,status:"paid",paid_date:c().format("YYYY-MM-DD"),notes:e.notes}:f)))}catch(m){I.error(((k=(s=m.response)==null?void 0:s.data)==null?void 0:k.message)||"មានបញ្ហាក្នុងការបញ្ជាក់ការទូទាត់")}},D=[{title:"ជំហាន",dataIndex:"step_number",key:"step_number",render:e=>t.jsxs(r,{strong:!0,children:["ជំហានទី ",e]})},{title:"ចំនួនទឹកប្រាក់",dataIndex:"amount",key:"amount",align:"right",render:e=>t.jsx(r,{strong:!0,children:l(e)})},{title:"កាលបរិច្ឆេទ",dataIndex:"due_date",key:"due_date",render:e=>c(e).format("DD/MM/YYYY")},{title:"ស្ថានភាព",dataIndex:"status",key:"status",align:"center",render:e=>t.jsx(E,{status:e==="paid"?"success":"warning",text:e==="paid"?"បានបង់ហើយ":"មិនទាន់បង់"})},{title:"កាលបរិច្ឆេទបង់",dataIndex:"paid_date",key:"paid_date",render:e=>e?c(e).format("DD/MM/YYYY"):"-"},{title:"កំណត់ចំណាំ",dataIndex:"notes",key:"notes",render:e=>e||"-"},{title:"សកម្មភាព",key:"actions",align:"center",render:(e,s)=>s.status==="pending"&&t.jsx(K,{title:"បញ្ជាក់ថាជំហាននេះត្រូវបានបង់រួចហើយ",children:t.jsx(x,{type:"primary",icon:t.jsx(q,{}),onClick:()=>v(s),size:"small",children:"បញ្ជាក់ការទូទាត់"})})}],C=a.reduce((e,s)=>e+parseFloat(s.amount),0),b=a.filter(e=>e.status==="paid").reduce((e,s)=>e+parseFloat(s.amount),0),B=C-b,P=a.length,T=a.filter(e=>e.status==="paid").length;return t.jsxs($,{children:[t.jsx(R,{title:`ជំហានទូទាត់កម៉ីសិន - ${i.recipient_name}`}),t.jsxs("div",{style:{padding:"24px"},children:[t.jsx("div",{style:{marginBottom:"24px"},children:t.jsxs(M,{align:"center",children:[t.jsx(x,{icon:t.jsx(Q,{}),onClick:_,type:"text"}),t.jsxs(G,{level:2,style:{margin:0},children:["ជំហានទូទាត់កម៉ីសិន - ",i.recipient_name]})]})}),t.jsx(o,{style:{marginBottom:"24px"},children:t.jsxs(h,{title:"ព័ត៌មានកម៉ីសិន",bordered:!0,column:2,children:[t.jsx(h.Item,{label:"ឈ្មោះអ្នកទទួល",children:t.jsx(r,{strong:!0,children:i.recipient_name})}),t.jsx(h.Item,{label:"ចំនួនសរុប",children:t.jsx(r,{strong:!0,children:l(i.total_amount)})}),t.jsx(h.Item,{label:"ការពិពណ៌នា",span:2,children:i.description||"-"})]})}),t.jsxs(H,{gutter:16,style:{marginBottom:"24px"},children:[t.jsx(j,{xs:24,sm:6,children:t.jsx(o,{children:t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx(r,{type:"secondary",children:"ជំហានសរុប"}),t.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#1890ff"},children:P})]})})}),t.jsx(j,{xs:24,sm:6,children:t.jsx(o,{children:t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx(r,{type:"secondary",children:"ជំហានបានបង់"}),t.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#52c41a"},children:T})]})})}),t.jsx(j,{xs:24,sm:6,children:t.jsx(o,{children:t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx(r,{type:"secondary",children:"ចំនួនបានបង់"}),t.jsx("div",{style:{fontSize:"18px",fontWeight:"bold",color:"#52c41a"},children:l(b)})]})})}),t.jsx(j,{xs:24,sm:6,children:t.jsx(o,{children:t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx(r,{type:"secondary",children:"ចំនួននៅសល់"}),t.jsx("div",{style:{fontSize:"18px",fontWeight:"bold",color:"#faad14"},children:l(B)})]})})})]}),t.jsx(o,{title:"ជំហានទូទាត់",children:t.jsx(L,{columns:D,dataSource:a,rowKey:"id",pagination:!1,locale:{emptyText:"មិនមានជំហានទូទាត់"}})}),t.jsx(N,{title:"បញ្ជាក់ការទូទាត់",open:Y,onCancel:S,footer:null,width:500,children:n&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{style:{marginBottom:"16px",padding:"12px",backgroundColor:"#f5f5f5",borderRadius:"6px"},children:[t.jsxs(r,{strong:!0,children:["ជំហានទី ",n.step_number]}),t.jsx("br",{}),t.jsxs(r,{children:["ចំនួនទឹកប្រាក់: ",l(n.amount)]}),t.jsx("br",{}),t.jsxs(r,{children:["កាលបរិច្ឆេទ: ",c(n.due_date).format("DD/MM/YYYY")]})]}),t.jsxs(p,{form:d,layout:"vertical",onFinish:A,children:[t.jsx(p.Item,{name:"notes",label:"កំណត់ចំណាំ",children:t.jsx(J,{placeholder:"បញ្ចូលកំណត់ចំណាំ (ស្រេចចិត្ត)",rows:4})}),t.jsx(p.Item,{style:{marginBottom:0,textAlign:"right"},children:t.jsxs(M,{children:[t.jsx(x,{onClick:S,children:"បោះបង់"}),t.jsx(x,{type:"primary",htmlType:"submit",children:"បញ្ជាក់"})]})})]})]})})]})]})}export{Lt as default};
