import{r as n,I,_ as y,a as u,s as c,j as e,B as l}from"./app-Cq9T9vxM.js";import{M as R}from"./index-eUbAuevc.js";import{S as E}from"./index-C_zCuArI.js";import{F as $}from"./Table-BtVi7rN6.js";import{E as x}from"./index-B3veqm8A.js";import{S as M}from"./index-B5_NNnDd.js";import{T as h}from"./index-DPFVXnL-.js";import{R as v}from"./DownloadOutlined-C0uSoOge.js";import{P as S}from"./index-DkbBOswI.js";import{R as D}from"./DeleteOutlined-j2tGMUPF.js";import{R as F}from"./FilePdfOutlined-Be48nQQt.js";import{R as B}from"./FileImageOutlined-h47-aNI4.js";import"./PurePanel-Ce8hDmce.js";import"./getAllowClear-nqy4kNbo.js";import"./addEventListener-DU-bjus0.js";import"./DownOutlined-8JSIA4HI.js";import"./index-DAepUo0f.js";import"./index-DL0uTJIv.js";import"./EllipsisOutlined-BDh9HHBq.js";import"./Pagination-DlQ44rBm.js";import"./FileOutlined-azBO8rMn.js";import"./FolderOutlined-BXGz-0ra.js";import"./SearchOutlined-PK94XR1x.js";import"./Input-DONKCjvs.js";import"./useVariants-Ea3XEG1D.js";import"./useIcons-Ds0_kiqE.js";import"./CheckOutlined-_L7buK6x.js";var L={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.7L639.4 73.4c-6-6-14.2-9.4-22.7-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.6-9.4-22.6zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494zM402 549c0 5.4 4.4 9.5 9.8 9.5h32.4c5.4 0 9.8-4.2 9.8-9.4 0-28.2 25.8-51.6 58-51.6s58 23.4 58 51.5c0 25.3-21 47.2-49.3 50.9-19.3 2.8-34.5 20.3-34.7 40.1v32c0 5.5 4.5 10 10 10h32c5.5 0 10-4.5 10-10v-12.2c0-6 4-11.5 9.7-13.3 44.6-14.4 75-54 74.3-98.9-.8-55.5-49.2-100.8-108.5-101.6-61.4-.7-111.5 45.6-111.5 103zm78 195a32 32 0 1064 0 32 32 0 10-64 0z"}}]},name:"file-unknown",theme:"outlined"},P=function(i,r){return n.createElement(I,y({},i,{ref:r,icon:L}))},T=n.forwardRef(P);function de({visible:s,onCancel:i,paymentStep:r}){const[d,j]=n.useState([]),[w,a]=n.useState(!1);n.useEffect(()=>{s&&m()},[s,r]);const m=async()=>{a(!0);try{const t=r?`/api/reports/payment-steps/${r.id}/documents`:"/api/reports/contract-documents",o=await u.get(t);j(o.data.documents||[])}catch(t){console.error("បញ្ហាក្នុងការទាញកិច្ចសន្យា:",t),c.error("មានបញ្ហាក្នុងការផ្ទុកកិច្ចសន្យា")}finally{a(!1)}},g=t=>{window.open(`/api/reports/contract-documents/${t}/download`,"_blank")},k=async t=>{var o,p;try{a(!0),await u.delete(`/api/reports/contract-documents/${t}`),c.success("លុបកិច្ចសន្យាជោគជ័យ"),m()}catch(f){console.error("បញ្ហាក្នុងការលុបកិច្ចសន្យា:",f),c.error(((p=(o=f.response)==null?void 0:o.data)==null?void 0:p.error)||"មានបញ្ហាក្នុងការលុបកិច្ចសន្យា")}finally{a(!1)}},z=t=>t==="application/pdf"?e.jsx(F,{style:{fontSize:"20px",color:"#ff4d4f"}}):t.startsWith("image/")?e.jsx(B,{style:{fontSize:"20px",color:"#1890ff"}}):e.jsx(T,{style:{fontSize:"20px"}}),_=[{title:"ឈ្មោះកិច្ចសន្យា",dataIndex:"file_name",key:"file_name",render:(t,o)=>e.jsxs("div",{className:"flex items-center",children:[z(o.mime_type),e.jsx("span",{className:"ml-2",children:t})]})},{title:"ទំហំ",dataIndex:"file_size",key:"file_size",render:t=>{const o=t/1024;return o<1024?`${o.toFixed(2)} KB`:`${(o/1024).toFixed(2)} MB`}},{title:"ផ្ទុកនៅពេល",dataIndex:"uploaded_at",key:"uploaded_at",render:t=>new Date(t).toLocaleString()},{title:"សកម្មភាព",key:"actions",render:(t,o)=>e.jsxs(M,{size:"small",children:[e.jsx(h,{title:"ទាញយក",children:e.jsx(l,{icon:e.jsx(v,{}),size:"small",onClick:()=>g(o.id)})}),e.jsx(S,{title:"លុបកិច្ចសន្យា",description:"តើអ្នកចង់លុបកិច្ចសន្យានេះមែនទេ?",onConfirm:()=>k(o.id),okText:"យល់ព្រម",cancelText:"មិនយល់ព្រម",okButtonProps:{danger:!0},children:e.jsx(h,{title:"លុប",children:e.jsx(l,{danger:!0,icon:e.jsx(D,{}),size:"small"})})})]})}];return e.jsx(R,{title:r?`កិច្ចសន្យាសម្រាប់ដំណាក់កាលបង់ប្រាក់ទី${r.step_number}`:"កិច្ចសន្យាទាំងអស់",open:s,onCancel:i,footer:[e.jsx(l,{onClick:i,children:"បិទ"},"close")],width:800,children:e.jsx(E,{spinning:w,children:d.length>0?e.jsx($,{columns:_,dataSource:d,rowKey:"id",pagination:!1,size:"middle"}):e.jsx(x,{description:"មិនមានកិច្ចសន្យាទេ",image:x.PRESENTED_IMAGE_SIMPLE})})})}export{de as default};
