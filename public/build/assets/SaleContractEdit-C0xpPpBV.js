import{r as j,j as e,Q as E,B as m,s as c,h as _}from"./app-mk9C7I_N.js";import{A as N}from"./AdminLayout-CSpn-5iP.js";import{h as k}from"./moment-C5S46NFB.js";import{F as l}from"./index-ByQ52J4c.js";import{C as B,R as M}from"./index-DZTYDYFc.js";import{T as q}from"./index-DDFZ7dy0.js";import{R as A}from"./ArrowLeftOutlined-cOBH5Dj-.js";import{R as C,C as p}from"./row-CPFUowx7.js";import{T as b}from"./index-CuozxnK8.js";import{D as w}from"./index-DDZo9mtM.js";import{S as u}from"./index-CHP0fo2g.js";import{F as Q}from"./Table-CR7r1NXs.js";import{S as V}from"./index-pKRxIKW4.js";import{R as z}from"./SaveOutlined-odoOer7R.js";import{D as G}from"./index-BrAkZjxA.js";import{I}from"./index-BiMKBPmP.js";import{R as H}from"./DeleteOutlined-CQidAT13.js";import"./UserOutlined-Do6ZzMFA.js";import"./index-D66KGu5D.js";import"./index-phC_QXgK.js";import"./EllipsisOutlined-DwAdn_jY.js";import"./PurePanel-Bwrv9FGC.js";import"./InboxOutlined-CDGQXwno.js";import"./useVariants-BUy45nvZ.js";import"./EditOutlined-CkdCVUZ6.js";import"./getAllowClear-BGHWSs2V.js";import"./CheckOutlined-CeCjh9xi.js";import"./DownOutlined-CUiMnNSy.js";import"./useIcons-CunuZG3Y.js";import"./SearchOutlined-jGh7iI3q.js";import"./addEventListener-KCP_u9m-.js";import"./index-Bl_0AmJC.js";import"./Pagination-DbG4IO0G.js";import"./index-CYzbL2Oe.js";import"./FileOutlined-BPRx6OYG.js";import"./FolderOutlined-C4h6UTTq.js";import"./Input-DUxd1TpC.js";import"./dayjs.min-DI9V4UpH.js";import"./CalendarOutlined-DHG6L8yA.js";import"./ClockCircleOutlined-DNAvTwIZ.js";import"./EyeOutlined-CQ17cMyg.js";const{Title:v}=q,{Option:y}=u,{TextArea:Oe}=I;function Pe({document:o,buyers:R,sellers:$,lands:D}){const[x]=l.useForm(),[T,h]=j.useState(!1),[n,d]=j.useState([]);j.useEffect(()=>{var r,s,a,S;const t=((r=o.payment_steps)==null?void 0:r.map((i,P)=>({key:P,amount:i.amount,due_date:k(i.due_date),description:i.description||""})))||[];d(t),x.setFieldsValue({total_land_price:o.total_land_price,buyers:((s=o.buyers)==null?void 0:s.map(i=>i.buyer_id))||[],sellers:((a=o.sellers)==null?void 0:a.map(i=>i.seller_id))||[],lands:((S=o.lands)==null?void 0:S.map(i=>i.land_id))||[]})},[o,x]);const F=async t=>{if(n.length===0){c.error("សូមបន្ថែមដំណាក់កាលបង់ប្រាក់យ៉ាងហោចណាស់មួយ");return}h(!0);try{const r=n.map(a=>({amount:a.amount,due_date:a.due_date.format("YYYY-MM-DD"),description:a.description})),s={...t,payment_steps:r};_.put(route("sale-contracts.update",{id:o.id}),s,{onSuccess:()=>{c.success("លិខិតទិញលក់ត្រូវបានកែសម្រួលដោយជោគជ័យ")},onError:a=>{console.error("Validation errors:",a),c.error("មានបញ្ហាក្នុងការកែសម្រួល")},onFinish:()=>{h(!1)}})}catch(r){console.error("Error updating sale contract:",r),c.error("មានបញ្ហាក្នុងការកែសម្រួល"),h(!1)}},g=()=>{_.visit(route("sale-contracts.index"))},L=()=>{const t={key:Date.now(),amount:0,due_date:k(),description:""};d([...n,t])},Y=t=>{d(n.filter(r=>r.key!==t))},f=(t,r,s)=>{d(n.map(a=>a.key===t?{...a,[r]:s}:a))},O=[{title:"ចំនួនទឹកប្រាក់ ($)",dataIndex:"amount",key:"amount",render:(t,r)=>e.jsx(b,{value:t,onChange:s=>f(r.key,"amount",s),formatter:s=>`$ ${s}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:s=>s.replace(/\$\s?|(,*)/g,""),style:{width:"100%"},min:0})},{title:"កាលបរិច្ឆេទកំណត់",dataIndex:"due_date",key:"due_date",render:(t,r)=>e.jsx(G,{value:t,onChange:s=>f(r.key,"due_date",s),style:{width:"100%"},format:"DD/MM/YYYY"})},{title:"ការពិពណ៌នា",dataIndex:"description",key:"description",render:(t,r)=>e.jsx(I,{value:t,onChange:s=>f(r.key,"description",s.target.value),placeholder:"ការពិពណ៌នាដំណាក់កាល"})},{title:"សកម្មភាព",key:"action",render:(t,r)=>e.jsx(m,{type:"text",danger:!0,icon:e.jsx(H,{}),onClick:()=>Y(r.key)})}];return e.jsxs(N,{children:[e.jsx(E,{title:"កែសម្រួលលិខិតទិញលក់"}),e.jsx("div",{className:"container mx-auto py-6",children:e.jsxs(B,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs(v,{level:3,children:["កែសម្រួលលិខិតទិញលក់ #",o.id]}),e.jsx(m,{icon:e.jsx(A,{}),onClick:g,children:"ត្រឡប់ក្រោយ"})]}),e.jsxs(l,{form:x,layout:"vertical",onFinish:F,size:"large",children:[e.jsx(C,{gutter:24,children:e.jsx(p,{xs:24,md:12,children:e.jsx(l.Item,{label:"តម្លៃដីសរុប ($)",name:"total_land_price",rules:[{required:!0,message:"សូមបញ្ចូលតម្លៃដីសរុប"},{type:"number",min:0,message:"តម្លៃត្រូវតែធំជាង 0"}],children:e.jsx(b,{style:{width:"100%"},formatter:t=>`$ ${t}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:t=>t.replace(/\$\s?|(,*)/g,""),placeholder:"បញ្ចូលតម្លៃដីសរុប"})})})}),e.jsx(w,{}),e.jsxs(C,{gutter:24,children:[e.jsx(p,{xs:24,md:8,children:e.jsx(l.Item,{label:"អ្នកទិញ",name:"buyers",rules:[{required:!0,message:"សូមជ្រើសរើសអ្នកទិញ"}],children:e.jsx(u,{mode:"multiple",placeholder:"ជ្រើសរើសអ្នកទិញ",showSearch:!0,filterOption:(t,r)=>r.children.toLowerCase().indexOf(t.toLowerCase())>=0,children:R.map(t=>e.jsx(y,{value:t.id,children:t.name},t.id))})})}),e.jsx(p,{xs:24,md:8,children:e.jsx(l.Item,{label:"អ្នកលក់",name:"sellers",rules:[{required:!0,message:"សូមជ្រើសរើសអ្នកលក់"}],children:e.jsx(u,{mode:"multiple",placeholder:"ជ្រើសរើសអ្នកលក់",showSearch:!0,filterOption:(t,r)=>r.children.toLowerCase().indexOf(t.toLowerCase())>=0,children:$.map(t=>e.jsx(y,{value:t.id,children:t.name},t.id))})})}),e.jsx(p,{xs:24,md:8,children:e.jsx(l.Item,{label:"ដីធ្លី",name:"lands",rules:[{required:!0,message:"សូមជ្រើសរើសដីធ្លី"}],children:e.jsx(u,{mode:"multiple",placeholder:"ជ្រើសរើសដីធ្លី",showSearch:!0,filterOption:(t,r)=>r.children.toLowerCase().indexOf(t.toLowerCase())>=0,children:D.map(t=>e.jsxs(y,{value:t.id,children:[t.plot_number," - ",t.location]},t.id))})})})]}),e.jsx(w,{}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx(v,{level:4,children:"ដំណាក់កាលបង់ប្រាក់"}),e.jsx(m,{type:"dashed",icon:e.jsx(M,{}),onClick:L,children:"បន្ថែមដំណាក់កាល"})]}),e.jsx(Q,{columns:O,dataSource:n,pagination:!1,locale:{emptyText:"មិនមានដំណាក់កាលបង់ប្រាក់"}})]}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsxs(V,{children:[e.jsx(m,{onClick:g,children:"បោះបង់"}),e.jsx(m,{type:"primary",htmlType:"submit",loading:T,icon:e.jsx(z,{}),children:"រក្សាទុកការកែប្រែ"})]})})]})]})})]})}export{Pe as default};
