import{j as e,r as E,Q as R,d as k,S as Y}from"./app-D0OhDuOP.js";import{a as K,A as F}from"./AdminLayout-DfyZC7U7.js";import{F as w}from"./FileUpload-C1UEOMq6.js";import{d as z}from"./dayjs.min-Bgh6-5v4.js";import{C as B}from"./index-BXZQm44E.js";import{F as a}from"./index-01QrSur2.js";import{I as Q}from"./index-DyIYvMCA.js";import{S as N}from"./index-BXlDNFm_.js";import{D}from"./index-C98K_sL4.js";import{I as M}from"./index-CXWQQlPC.js";import{R as T}from"./FilePdfOutlined-BmX1d_m5.js";import{R as U}from"./FileImageOutlined-6X7nxdKY.js";import{T as H}from"./index-DUD5X347.js";import{B as L}from"./Breadcrumb-XIs-K6bQ.js";import{S as P}from"./index-DeYg2bFH.js";import{R as q,C}from"./row-Cvvd4www.js";import{B as x}from"./index-XQ9uBlxv.js";import{S as G}from"./index-CpY42lHj.js";import{s as j}from"./index-VXrvBi_7.js";import{R as Z}from"./UploadOutlined-qPHS_ZnN.js";import{R as X}from"./FormOutlined-BkmN8kbW.js";import"./UserOutlined-Bw1Yg3TV.js";import"./index-BKPGZTnh.js";import"./EllipsisOutlined-BcUT9_x5.js";import"./PurePanel-BrlMViLC.js";import"./index-BoUcoXbW.js";import"./index-DxlGwFBo.js";import"./useClosable-rmjEiMr1.js";import"./CloseOutlined-CSg-7HVH.js";import"./pickAttrs-BMtZpb9Y.js";import"./extendsObject-78o_rR5W.js";import"./CheckOutlined-C-W3vkf9.js";import"./EyeOutlined-Bk9sN1n5.js";import"./CheckCircleOutlined-_P5yC29H.js";import"./index-DSx0c0nZ.js";import"./ExclamationCircleFilled-BuCwC-hN.js";import"./InfoCircleFilled-Csbq1HVY.js";import"./ActionButton-DPI_9ZHB.js";import"./Skeleton-BB1PfEPR.js";import"./index-BNYa27A7.js";import"./DeleteOutlined-C5fTVnAq.js";import"./index-FPFFDuuk.js";import"./DownloadOutlined-BFocYQwA.js";import"./progress-CZwQN1Wi.js";import"./index-Bjcdw0HM.js";import"./useVariants-VmmnPvRy.js";import"./getAllowClear-7r21EHJH.js";import"./Input-DIi4XD1o.js";import"./SearchOutlined-DdbS1Qlk.js";import"./EditOutlined-BQAB7wjt.js";import"./useIcons-De8HtjeC.js";import"./DownOutlined-BKT6hG3e.js";import"./CalendarOutlined-C5Gy31PM.js";import"./ClockCircleOutlined-BGruiaAm.js";import"./addEventListener-Dvq9iQDE.js";const{Option:y}=N,{Title:_e,Text:$e}=H;function W({formData:i,setFormData:g,displayImage:r}){const A=(t,s)=>{g({...i,[t]:s})},m=t=>{if(!t)return!1;if(t.base64&&t.base64.startsWith("data:image/")||t.url&&t.url.startsWith("data:image/"))return!0;const s=t.name||t.fileName||"";if(s&&/\.(jpg|jpeg|png|gif|webp|bmp)$/i.test(s))return!0;const o=["image/jpeg","image/png","image/jpg","image/gif","image/webp","image/bmp"];return!!(t.type&&o.includes(t.type))},u=()=>{var c,d;if(!r)return null;const t=r.name||r.fileName||"",s=m(r)||t&&/\.(jpg|jpeg|png|gif|webp|bmp)$/i.test(t);let o=null;return r.base64?o=r.base64:r.url?o=r.url:(d=(c=r.response)==null?void 0:c.file)!=null&&d.base64?o=r.response.file.base64:r.tempPath?o=`/storage/${r.tempPath}`:t&&(o=`/storage/temp/${t}`),e.jsx(B,{title:"រូបភាពបង្ហាញ",className:"mb-6",styles:{body:{padding:"16px",textAlign:"center"}},children:s&&o?e.jsx("div",{style:{maxWidth:"500px",margin:"0 auto"},children:e.jsx(M,{src:o,alt:r.name||r.fileName||"Image",style:{maxHeight:"350px",objectFit:"contain"},preview:{maskClassName:"preview-mask",mask:e.jsx("div",{children:"Click to view full size"})},fallback:"data:image/png;base64,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"})}):e.jsxs("div",{style:{padding:"20px",textAlign:"center"},children:[e.jsx("div",{style:{marginBottom:"10px",color:"red"},children:s?"No valid URL found":"Not an image file"}),r.type&&r.type.includes("pdf")?e.jsx(T,{style:{fontSize:"48px",color:"#ff4d4f"}}):e.jsx(U,{style:{fontSize:"48px",color:"#1890ff"}}),e.jsx("div",{style:{marginTop:"10px"},children:r.name||r.fileName||"ឯកសារ"})]})})};return e.jsxs(e.Fragment,{children:[r&&u(),e.jsx(B,{title:"ព័ត៌មានអ្នកទិញ",className:"mb-6",children:e.jsxs(a,{layout:"vertical",children:[e.jsx(a.Item,{label:"ឈ្មោះ",required:!0,rules:[{required:!0,message:"សូមបញ្ចូលឈ្មោះ"}],children:e.jsx(Q,{placeholder:"បញ្ចូលឈ្មោះ",value:i.name,onChange:t=>A("name",t.target.value)})}),e.jsx(a.Item,{label:"ភេទ",required:!0,children:e.jsxs(N,{value:i.sex,onChange:t=>A("sex",t),children:[e.jsx(y,{value:"male",children:"ប្រុស"}),e.jsx(y,{value:"female",children:"ស្រី"})]})}),e.jsx(a.Item,{label:"ថ្ងៃខែឆ្នាំកំណើត",required:!0,children:e.jsx(D,{style:{width:"100%"},format:"DD/MM/YYYY",value:i.date_of_birth?z(i.date_of_birth):null,onChange:(t,s)=>A("date_of_birth",t?t.format("YYYY-MM-DD"):null)})}),e.jsx(a.Item,{label:"លេខអត្តសញ្ញាណប័ណ្ណ",required:!0,children:e.jsx(Q,{placeholder:"បញ្ចូលលេខអត្តសញ្ញាណប័ណ្ណ",value:i.identity_number,onChange:t=>A("identity_number",t.target.value)})}),e.jsx(a.Item,{label:"អាសយដ្ឋាន",required:!0,children:e.jsx(Q.TextArea,{placeholder:"បញ្ចូលអាសយដ្ឋាន",rows:3,value:i.address,onChange:t=>A("address",t.target.value)})}),e.jsx(a.Item,{label:"លេខទូរស័ព្ទ",children:e.jsx(Q,{placeholder:"បញ្ចូលលេខទូរស័ព្ទ",value:i.phone_number,onChange:t=>A("phone_number",t.target.value)})})]})})]})}function O(){const[i,g]=E.useState(0),[r,A]=E.useState([]),[m,u]=E.useState({name:"",sex:"male",date_of_birth:"",identity_number:"",address:"",phone_number:""}),[t,s]=E.useState(!1),o=r.find(n=>n.isDisplay)||r[0]||null,c=()=>{g(i+1)},d=()=>{g(i-1)},S=async()=>{s(!0);try{const n=r.map(l=>{var f,b;const I=l.base64||((b=(f=l.response)==null?void 0:f.file)==null?void 0:b.base64),v=l.name||l.fileName,J=l.type||"image/jpeg";return{base64:I,fileName:v,mimeType:J,isDisplay:l.isDisplay||!1}}),h=await k.post("/api/buyers",{...m,documents:n});h.data.success||h.data.buyer&&h.data.buyer.id?(j.success("ព័ត៌មានអ្នកទិញត្រូវបានរក្សាទុកដោយជោគជ័យ!"),Y.visit(route("data-entry.buyers.index"))):j.error("មានបញ្ហាក្នុងការរក្សាទុកព័ត៌មានអ្នកទិញ។")}catch{j.error("មានបញ្ហាក្នុងការរក្សាទុកព័ត៌មានអ្នកទិញ។")}finally{s(!1)}},p=[{title:"បញ្ចូលឯកសារ",icon:e.jsx(Z,{}),content:e.jsx(w,{category:"buyer",fileList:r,onFilesChange:n=>{A(n)},maxFiles:2})},{title:"បញ្ចូលព័ត៌មាន",icon:e.jsx(X,{}),content:e.jsx(e.Fragment,{children:e.jsx(W,{formData:m,setFormData:u,displayImage:o})})}];return e.jsxs(e.Fragment,{children:[e.jsx(R,{title:"បញ្ចូលព័ត៌មានអ្នកទិញថ្មី"}),e.jsx(L,{className:"mb-6",items:[{href:route("dashboard"),title:e.jsx(K,{})},{href:route("data-entry.index"),title:"ទិន្នន័យបញ្ចូល"},{href:route("data-entry.buyers.index"),title:"បញ្ជីអ្នកទិញ"},{title:"បញ្ចូលព័ត៌មានអ្នកទិញថ្មី"}]}),e.jsxs(B,{children:[e.jsx(P,{current:i,items:p.map(n=>({title:n.title,icon:n.icon})),className:"mb-8"}),e.jsx("div",{className:"steps-content mb-8",children:p[i].content}),e.jsx("div",{className:"steps-action",children:e.jsxs(q,{justify:"space-between",children:[e.jsx(C,{children:i>0&&e.jsx(x,{onClick:d,children:"ត្រឡប់ក្រោយ"})}),e.jsx(C,{children:e.jsxs(G,{children:[i<p.length-1&&e.jsx(x,{type:"primary",onClick:c,children:"បន្ទាប់"}),i===p.length-1&&e.jsx(x,{type:"primary",onClick:S,loading:t,disabled:!m.name||!m.identity_number||r.length===0,children:"រក្សាទុក"})]})})]})})]})]})}O.layout=i=>e.jsx(F,{children:i,title:"បញ្ចូលព័ត៌មានអ្នកទិញថ្មី"});export{O as default};
