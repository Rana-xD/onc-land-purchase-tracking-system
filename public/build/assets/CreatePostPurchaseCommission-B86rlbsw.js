import{r as T,j as e,Q as $,d as z,S as j}from"./app-D0OhDuOP.js";import{A as D}from"./AdminLayout-DfyZC7U7.js";import{d as B}from"./dayjs.min-Bgh6-5v4.js";import{F as o}from"./index-01QrSur2.js";import{S as g}from"./index-CpY42lHj.js";import{B as m}from"./index-XQ9uBlxv.js";import{R as Y}from"./ArrowLeftOutlined-DaEIyD4l.js";import{T as v}from"./index-DUD5X347.js";import{C as y,R as A}from"./index-BXZQm44E.js";import{R as b,C as c}from"./row-Cvvd4www.js";import{I as C}from"./index-DyIYvMCA.js";import{T as I}from"./index-Dx6sVVHZ.js";import{D as S}from"./index-BoUcoXbW.js";import{D as k}from"./index-C98K_sL4.js";import{R as w}from"./MinusCircleOutlined-9D3uDow0.js";import{R as F}from"./SaveOutlined-D-cLyBdL.js";import{s as x}from"./index-VXrvBi_7.js";import"./UserOutlined-Bw1Yg3TV.js";import"./index-BKPGZTnh.js";import"./EllipsisOutlined-BcUT9_x5.js";import"./PurePanel-BrlMViLC.js";import"./CheckOutlined-C-W3vkf9.js";import"./ExclamationCircleFilled-BuCwC-hN.js";import"./CloseOutlined-CSg-7HVH.js";import"./EditOutlined-BQAB7wjt.js";import"./getAllowClear-7r21EHJH.js";import"./useVariants-VmmnPvRy.js";import"./Skeleton-BB1PfEPR.js";import"./index-BNYa27A7.js";import"./Input-DIi4XD1o.js";import"./pickAttrs-BMtZpb9Y.js";import"./EyeOutlined-Bk9sN1n5.js";import"./SearchOutlined-DdbS1Qlk.js";import"./DownOutlined-BKT6hG3e.js";import"./CalendarOutlined-C5Gy31PM.js";import"./ClockCircleOutlined-BGruiaAm.js";import"./useIcons-De8HtjeC.js";import"./InfoCircleFilled-Csbq1HVY.js";const{Title:M,Text:Re}=v,{TextArea:q}=C;function _e(){const[h]=o.useForm(),[R,u]=T.useState(!1),_=async r=>{var n,l,p,a;u(!0);try{const t=r.payment_steps.map(d=>({amount:d.amount,due_date:d.due_date.format("YYYY-MM-DD")})),s={...r,payment_steps:t},i=await z.post("/commissions/api/post-purchase",s);i.data.success&&(x.success(i.data.message),j.visit("/commissions/post-purchase"))}catch(t){if((l=(n=t.response)==null?void 0:n.data)!=null&&l.errors){const s=t.response.data.errors;Object.keys(s).forEach(i=>{i==="payment_steps"&&Array.isArray(s[i])?s[i].forEach(d=>{x.error(d)}):h.setFields([{name:i,errors:s[i]}])})}else x.error(((a=(p=t.response)==null?void 0:p.data)==null?void 0:a.message)||"មានបញ្ហាក្នុងការរក្សាទុក")}finally{u(!1)}},f=()=>{j.visit("/commissions/post-purchase")};return e.jsxs(D,{children:[e.jsx($,{title:"បន្ថែមកម៉ីសិនក្រោយទិញ"}),e.jsxs("div",{style:{padding:"24px"},children:[e.jsx("div",{style:{marginBottom:"24px"},children:e.jsxs(g,{align:"center",children:[e.jsx(m,{icon:e.jsx(Y,{}),onClick:f,type:"text"}),e.jsx(M,{level:2,style:{margin:0,textAlign:"center"},children:"បន្ថែមកម៉ីសិនក្រោយទិញ"})]})}),e.jsx(y,{children:e.jsxs(o,{form:h,layout:"vertical",onFinish:_,initialValues:{payment_steps:[{amount:null,due_date:null}]},children:[e.jsxs(b,{gutter:24,children:[e.jsx(c,{xs:24,md:12,children:e.jsx(o.Item,{name:"recipient_name",label:"ឈ្មោះអ្នកទទួល",rules:[{required:!0,message:"សូមបញ្ចូលឈ្មោះអ្នកទទួល"}],children:e.jsx(C,{placeholder:"បញ្ចូលឈ្មោះអ្នកទទួល",size:"large"})})}),e.jsx(c,{xs:24,md:12,children:e.jsx(o.Item,{name:"total_amount",label:"ចំនួនសរុប",rules:[{required:!0,message:"សូមបញ្ចូលចំនួនសរុប"},{type:"number",min:.01,message:"ចំនួនទឹកប្រាក់ត្រូវតែធំជាង 0"}],children:e.jsx(I,{placeholder:"បញ្ចូលចំនួនសរុប",style:{width:"100%"},size:"large",formatter:r=>`$ ${r}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:r=>r.replace(/\$\s?|(,*)/g,""),precision:2})})})]}),e.jsx(o.Item,{name:"description",label:"ការពិពណ៌នា",children:e.jsx(q,{placeholder:"បញ្ចូលការពិពណ៌នា (ស្រេចចិត្ត)",rows:4,size:"large"})}),e.jsx(S,{children:"ជំហានទូទាត់"}),e.jsx(o.List,{name:"payment_steps",children:(r,{add:n,remove:l})=>e.jsxs(e.Fragment,{children:[r.map(({key:p,name:a,...t})=>e.jsx(y,{size:"small",style:{marginBottom:"16px",backgroundColor:"#fafafa"},title:`ជំហានទី ${a+1}`,extra:r.length>1&&e.jsx(m,{type:"link",danger:!0,icon:e.jsx(w,{}),onClick:()=>l(a),size:"small",children:"លុប"}),children:e.jsxs(b,{gutter:16,children:[e.jsx(c,{xs:24,md:12,children:e.jsx(o.Item,{...t,name:[a,"amount"],label:"ចំនួនទឹកប្រាក់",rules:[{required:!0,message:"សូមបញ្ចូលចំនួនទឹកប្រាក់"},{type:"number",min:.01,message:"ចំនួនទឹកប្រាក់ត្រូវតែធំជាង 0"}],children:e.jsx(I,{placeholder:"ចំនួនទឹកប្រាក់",style:{width:"100%"},formatter:s=>`$ ${s}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:s=>s.replace(/\$\s?|(,*)/g,""),precision:2})})}),e.jsx(c,{xs:24,md:12,children:e.jsx(o.Item,{...t,name:[a,"due_date"],label:"កាលបរិច្ឆេទ",rules:[{required:!0,message:"សូមជ្រើសរើសកាលបរិច្ឆេទ"}],children:e.jsx(k,{placeholder:"កាលបរិច្ឆេទ",style:{width:"100%"},format:"DD/MM/YYYY",disabledDate:s=>s&&s<B().endOf("day")})})})]})},p)),e.jsx(m,{type:"dashed",onClick:()=>n(),block:!0,icon:e.jsx(A,{}),size:"large",style:{marginBottom:"24px"},children:"បន្ថែមជំហាន"})]})}),e.jsx("div",{style:{textAlign:"right",paddingTop:"16px",borderTop:"1px solid #f0f0f0"},children:e.jsxs(g,{size:"middle",children:[e.jsx(m,{size:"large",onClick:f,children:"បោះបង់"}),e.jsx(m,{type:"primary",htmlType:"submit",loading:R,icon:e.jsx(F,{}),size:"large",children:"រក្សាទុក"})]})})]})})]})]})}export{_e as default};
