import{r as d,I as G,_ as K,j as e,s as h,a as B,Q as X,t as Y,B as y}from"./app-BB1ZxGmZ.js";import{A as Z,a as ee}from"./AdminLayout-BuxP0tGi.js";import te from"./DocumentUploadModal-PLVl2RcS.js";import se from"./DocumentListModal-CgbdAm7b.js";import{R as ne,u as re}from"./useHTMLToPDF-DuN7tBgX.js";import{B as R}from"./Breadcrumb-W210Ky9C.js";import{R as le}from"./ArrowLeftOutlined-DPrGKClu.js";import{S as oe}from"./index-BaRQKH08.js";import{C as D}from"./index-CFcJuZ_P.js";import{C as Q}from"./Collapse-BGLgeGXr.js";import{F as ie}from"./Table-DYAIhjQx.js";import{S as E}from"./index-19zJLVvd.js";import{R as ce}from"./FilePdfOutlined-Bk0U6B6K.js";import{R as ae}from"./UploadOutlined-Cn7Qfj15.js";import{T as F}from"./index-CwdmVelz.js";import{R as M}from"./ClockCircleOutlined-C-s8qqeK.js";import{R as P}from"./CheckCircleOutlined-CSRirMR9.js";import{T as de}from"./index-4sotxCPT.js";import{P as O}from"./index-ZmRHGv6C.js";import"./UserOutlined-DbziX9m8.js";import"./index-BAJJZILe.js";import"./index-Dh1oKUG_.js";import"./EllipsisOutlined-BovgqE1k.js";import"./PurePanel-C84SwQv1.js";import"./InboxOutlined-DQe2Aezk.js";import"./index-BRhvAF0g.js";import"./row-C2x7paHm.js";import"./index-Yxxb-zBk.js";import"./index-D2Ym1l0Q.js";import"./DeleteOutlined-BYdkwIHm.js";import"./DownloadOutlined-q1lRnuRm.js";import"./EyeOutlined-Mb1FRF2d.js";import"./progress-D37wmuzZ.js";import"./CheckOutlined-bJGhASa0.js";import"./index-D_u505qY.js";import"./getAllowClear-DfqxFJiv.js";import"./useVariants-CY_Kcp5K.js";import"./useIcons-C3raLKSM.js";import"./DownOutlined-Bh2zEb-F.js";import"./SearchOutlined-CokIhbHK.js";import"./FileImageOutlined-DeKkUOaD.js";import"./addEventListener-sAx3j2N4.js";import"./index-C4BHrxfa.js";import"./Pagination-CLmWV7sf.js";import"./FileOutlined-BQmENh8X.js";import"./FolderOutlined-cW4S2ShW.js";import"./Input-AvN4Se7e.js";import"./jspdf.es.min-CJB1dIXq.js";import"./EditOutlined-DBTY11ET.js";var pe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"},he=function(p,a){return d.createElement(G,K({},p,{ref:a,icon:pe}))},W=d.forwardRef(he),xe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M342 88H120c-17.7 0-32 14.3-32 32v224c0 8.8 7.2 16 16 16h48c8.8 0 16-7.2 16-16V168h174c8.8 0 16-7.2 16-16v-48c0-8.8-7.2-16-16-16zm578 576h-48c-8.8 0-16 7.2-16 16v176H682c-8.8 0-16 7.2-16 16v48c0 8.8 7.2 16 16 16h222c17.7 0 32-14.3 32-32V680c0-8.8-7.2-16-16-16zM342 856H168V680c0-8.8-7.2-16-16-16h-48c-8.8 0-16 7.2-16 16v224c0 17.7 14.3 32 32 32h222c8.8 0 16-7.2 16-16v-48c0-8.8-7.2-16-16-16zM904 88H682c-8.8 0-16 7.2-16 16v48c0 8.8 7.2 16 16 16h174v176c0 8.8 7.2 16 16 16h48c8.8 0 16-7.2 16-16V120c0-17.7-14.3-32-32-32z"}}]},name:"expand",theme:"outlined"},me=function(p,a){return d.createElement(G,K({},p,{ref:a,icon:xe}))},fe=d.forwardRef(me);const je=({data:l,exportedBy:p})=>{var k,v,b,S,C,_,j,T,w,I,A,N,L;const[a,x]=d.useState({}),[i,V]=d.useState(!1),m=d.useRef(null),u=()=>{if(!m.current)return;const s=m.current.querySelectorAll("[data-section]"),n=1056,c={};s.forEach(o=>{const H=o.getAttribute("data-section"),q=o.offsetHeight,$=o.offsetTop%n;if($+q>n){const J=n-$;c[H]=J}}),x(c)};d.useEffect(()=>{m.current&&(m.current.calculatePageBreaks=u,m.current.setPageBreaks=x,m.current.pageBreaks=a)},[a]);const g=r=>new Intl.NumberFormat("km-KH",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(r||0),f=r=>new Date(r).toLocaleDateString("km-KH"),t={container:{fontFamily:'"Noto Sans Khmer", "Khmer OS", sans-serif',fontSize:"14px",lineHeight:"1.6",color:"#333",backgroundColor:"#fff",padding:"40px",maxWidth:"210mm",margin:"0 auto"},header:{textAlign:"center",marginBottom:"40px",borderBottom:"3px solid #333",paddingBottom:"20px"},title:{fontSize:"28px",fontWeight:"bold",marginBottom:"10px",color:"#333"},subtitle:{fontSize:"18px",marginBottom:"10px",color:"#666"},exportInfo:{textAlign:"right",fontSize:"12px",color:"#666",marginBottom:"20px"},section:{marginBottom:"30px",pageBreakInside:"avoid",breakInside:"avoid",display:"block",overflow:"visible"},sectionTitle:{fontSize:"20px",fontWeight:"bold",marginBottom:"15px",color:"#333",backgroundColor:"#f8f9fa",padding:"12px",borderLeft:"4px solid #dc3545"},contractInfo:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"15px",marginBottom:"20px"},buyerSellerSection:{marginBottom:"20px",padding:"15px",backgroundColor:"#f8f9fa",borderRadius:"5px",border:"1px solid #dee2e6",pageBreakInside:"avoid",breakInside:"avoid",display:"block",overflow:"visible",minHeight:"fit-content"},subSectionTitle:{fontSize:"16px",fontWeight:"bold",marginBottom:"10px",color:"#2E5984",borderBottom:"1px solid #dee2e6",paddingBottom:"5px"},infoGrid:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",pageBreakInside:"avoid",breakInside:"avoid"},infoItem:{display:"flex",justifyContent:"space-between",padding:"10px",backgroundColor:"#f8f9fa",borderRadius:"4px",border:"1px solid #e9ecef"},infoLabel:{fontWeight:"bold",color:"#495057"},infoValue:{color:"#dc3545",fontWeight:"bold"},table:{width:"100%",borderCollapse:"collapse",marginTop:"15px",pageBreakInside:"avoid",breakInside:"avoid"},tableHeader:{backgroundColor:"#dc3545",color:"white"},tableHeaderCell:{padding:"12px",textAlign:"center",fontWeight:"bold",border:"1px solid #dee2e6"},tableCell:{padding:"10px",textAlign:"center",border:"1px solid #dee2e6"},tableRow:{backgroundColor:"#fff"},tableRowAlt:{backgroundColor:"#f8f9fa"},noData:{textAlign:"center",fontStyle:"italic",color:"#6c757d",padding:"20px"},footer:{textAlign:"center",marginTop:"40px",fontSize:"12px",color:"#6c757d",borderTop:"1px solid #dee2e6",paddingTop:"20px"},keepTogether:{}};return e.jsxs("div",{ref:m,style:t.container,children:[e.jsxs("div",{style:t.header,children:[e.jsx("h1",{style:t.title,children:"របាយការណ៍កិច្ចសន្យា"}),e.jsxs("p",{style:t.subtitle,children:["កិច្ចសន្យាលេខ: ",(k=l.contract)==null?void 0:k.contract_id]})]}),e.jsxs("div",{style:t.exportInfo,children:[e.jsxs("div",{children:["នាំចេញដោយ: ",p]}),e.jsxs("div",{children:["កាលបរិច្ឆេទនាំចេញ: ",f(new Date().toISOString())]})]}),e.jsxs("div",{"data-section":"contract-info",style:{...t.section,...t.keepTogether,marginTop:a["contract-info"]?`${a["contract-info"]}px`:t.section.marginTop},children:[e.jsx("h2",{style:t.sectionTitle,children:"📋 ព័ត៌មានកិច្ចសន្យា"}),e.jsxs("div",{style:t.contractInfo,children:[e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"លេខកិច្ចសន្យា:"}),e.jsx("span",{style:t.infoValue,children:((v=l.contract)==null?void 0:v.id)||((b=l.contract)==null?void 0:b.contract_id)})]}),e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"កាលបរិច្ឆេទសញ្ញា:"}),e.jsx("span",{style:t.infoValue,children:f(((S=l.contract)==null?void 0:S.date)||((C=l.contract)==null?void 0:C.contract_date))})]}),e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"ស្ថានភាព:"}),e.jsx("span",{style:t.infoValue,children:(_=l.contract)==null?void 0:_.status})]}),e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"ចំនួនសរុប:"}),e.jsx("span",{style:t.infoValue,children:g((j=l.contract)==null?void 0:j.total_amount)})]})]})]}),e.jsxs("div",{"data-section":"buyer-info",style:{...t.section,...t.keepTogether,marginTop:a["buyer-info"]?`${a["buyer-info"]}px`:t.section.marginTop},children:[e.jsx("h2",{style:t.sectionTitle,children:"👤 ព័ត៌មានអ្នកទិញ"}),(T=l.contract)!=null&&T.buyers&&l.contract.buyers.length>0?l.contract.buyers.map((r,s)=>{var n,c,o;return e.jsxs("div",{style:t.buyerSellerSection,children:[e.jsxs("h3",{style:t.subSectionTitle,children:["អ្នកទិញ #",s+1]}),e.jsxs("div",{style:t.infoGrid,children:[e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"ឈ្មោះ:"}),e.jsx("span",{style:t.infoValue,children:((n=r.buyer)==null?void 0:n.name)||r.name})]}),e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"ទូរស័ព្ទ:"}),e.jsx("span",{style:t.infoValue,children:((c=r.buyer)==null?void 0:c.phone)||r.phone||"N/A"})]}),e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"អាសយដ្ឋាន:"}),e.jsx("span",{style:t.infoValue,children:((o=r.buyer)==null?void 0:o.address)||r.address||"N/A"})]})]})]},s)}):(w=l.contract)!=null&&w.buyer_name?e.jsxs("div",{style:t.infoGrid,children:[e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"ឈ្មោះ:"}),e.jsx("span",{style:t.infoValue,children:l.contract.buyer_name})]}),e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"ទូរស័ព្ទ:"}),e.jsx("span",{style:t.infoValue,children:l.contract.buyer_phone||"N/A"})]}),e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"អាសយដ្ឋាន:"}),e.jsx("span",{style:t.infoValue,children:l.contract.buyer_address||"N/A"})]})]}):e.jsx("p",{style:t.noData,children:"មិនមានព័ត៌មានអ្នកទិញ"})]}),e.jsxs("div",{"data-section":"seller-info",style:{...t.section,...t.keepTogether,marginTop:a["seller-info"]?`${a["seller-info"]}px`:t.section.marginTop},children:[e.jsx("h2",{style:t.sectionTitle,children:"🏢 ព័ត៌មានអ្នកលក់"}),(I=l.contract)!=null&&I.sellers&&l.contract.sellers.length>0?l.contract.sellers.map((r,s)=>{var n,c,o;return e.jsxs("div",{style:t.buyerSellerSection,children:[e.jsxs("h3",{style:t.subSectionTitle,children:["អ្នកលក់ #",s+1]}),e.jsxs("div",{style:t.infoGrid,children:[e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"ឈ្មោះ:"}),e.jsx("span",{style:t.infoValue,children:((n=r.seller)==null?void 0:n.name)||r.name})]}),e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"ទូរស័ព្ទ:"}),e.jsx("span",{style:t.infoValue,children:((c=r.seller)==null?void 0:c.phone)||r.phone||"N/A"})]}),e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"អាសយដ្ឋាន:"}),e.jsx("span",{style:t.infoValue,children:((o=r.seller)==null?void 0:o.address)||r.address||"N/A"})]})]})]},s)}):(A=l.contract)!=null&&A.seller_name?e.jsxs("div",{style:t.infoGrid,children:[e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"ឈ្មោះ:"}),e.jsx("span",{style:t.infoValue,children:l.contract.seller_name})]}),e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"ទូរស័ព្ទ:"}),e.jsx("span",{style:t.infoValue,children:l.contract.seller_phone||"N/A"})]}),e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"អាសយដ្ឋាន:"}),e.jsx("span",{style:t.infoValue,children:l.contract.seller_address||"N/A"})]})]}):e.jsx("p",{style:t.noData,children:"មិនមានព័ត៌មានអ្នកលក់"})]}),e.jsxs("div",{"data-section":"land-info",style:{...t.section,...t.keepTogether,marginTop:a["land-info"]?`${a["land-info"]}px`:t.section.marginTop},children:[e.jsx("h2",{style:t.sectionTitle,children:"🏞️ ព័ត៌មានដី"}),(N=l.contract)!=null&&N.lands&&l.contract.lands.length>0?l.contract.lands.map((r,s)=>{var n,c,o;return e.jsxs("div",{style:t.buyerSellerSection,children:[e.jsxs("h3",{style:t.subSectionTitle,children:["ដី #",s+1]}),e.jsxs("div",{style:t.infoGrid,children:[e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"លេខក្បាលដី:"}),e.jsx("span",{style:t.infoValue,children:((n=r.land)==null?void 0:n.plot_number)||r.plot_number||"N/A"})]}),e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"ទំហំ:"}),e.jsxs("span",{style:t.infoValue,children:[((c=r.land)==null?void 0:c.size)||r.size||"N/A"," ម²"]})]}),e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"ទីតាំង:"}),e.jsx("span",{style:t.infoValue,children:((o=r.land)==null?void 0:o.location)||r.location||"N/A"})]}),e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"តម្លៃសរុប:"}),e.jsx("span",{style:t.infoValue,children:g(r.total_price)})]})]})]},s)}):(L=l.contract)!=null&&L.land?e.jsxs("div",{style:t.infoGrid,children:[e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"លេខក្បាលដី:"}),e.jsx("span",{style:t.infoValue,children:l.contract.land.plot_number||"N/A"})]}),e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"ទំហំ:"}),e.jsxs("span",{style:t.infoValue,children:[l.contract.land.size||"N/A"," ម²"]})]}),e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"ទីតាំង:"}),e.jsx("span",{style:t.infoValue,children:l.contract.land.location||"N/A"})]})]}):e.jsx("p",{style:t.noData,children:"មិនមានព័ត៌មានដី"})]}),e.jsxs("div",{"data-section":"payment-steps",style:{...t.section,...t.keepTogether,marginTop:a["payment-steps"]?`${a["payment-steps"]}px`:t.section.marginTop},children:[e.jsx("h2",{style:t.sectionTitle,children:"💰 កំណែទឹកការទូទាត់"}),e.jsxs("table",{style:t.table,children:[e.jsx("thead",{style:t.tableHeader,children:e.jsxs("tr",{children:[e.jsx("th",{style:t.tableHeaderCell,children:"ជំហាន #"}),e.jsx("th",{style:t.tableHeaderCell,children:"ចំនួនទឹកប្រាក់"}),e.jsx("th",{style:t.tableHeaderCell,children:"កាលបរិច្ឆេទកំណត់"}),e.jsx("th",{style:t.tableHeaderCell,children:"ស្ថានភាព"})]})}),e.jsx("tbody",{children:l.payment_steps&&l.payment_steps.length>0?l.payment_steps.map((r,s)=>e.jsxs("tr",{style:s%2===0?t.tableRow:t.tableRowAlt,children:[e.jsx("td",{style:t.tableCell,children:r.step_number}),e.jsx("td",{style:t.tableCell,children:g(r.amount)}),e.jsx("td",{style:t.tableCell,children:f(r.due_date)}),e.jsx("td",{style:{...t.tableCell,color:r.status==="paid"?"#28a745":"#dc3545",fontWeight:"bold"},children:r.status==="paid"?"បង់ប្រាក់រួចរាល់":"មិនទាន់បង់ប្រាក់"})]},s)):e.jsx("tr",{children:e.jsx("td",{colSpan:"4",style:t.noData,children:"មិនមានទិន្នន័យការទូទាត់"})})})]})]}),l.contract_documents&&l.contract_documents.length>0&&e.jsxs("div",{style:t.section,children:[e.jsx("h2",{style:t.sectionTitle,children:"📄 កិច្ចសន្យាកិច្ចសន្យា"}),e.jsxs("table",{style:t.table,children:[e.jsx("thead",{style:t.tableHeader,children:e.jsxs("tr",{children:[e.jsx("th",{style:t.tableHeaderCell,children:"ឈ្មោះកិច្ចសន្យា"}),e.jsx("th",{style:t.tableHeaderCell,children:"ទំហំកិច្ចសន្យា"}),e.jsx("th",{style:t.tableHeaderCell,children:"ប្រភេទកិច្ចសន្យា"}),e.jsx("th",{style:t.tableHeaderCell,children:"កាលបរិច្ឆេទបញ្ចូល"}),e.jsx("th",{style:t.tableHeaderCell,children:"បញ្ចូលដោយ"})]})}),e.jsx("tbody",{children:l.contract_documents.map((r,s)=>e.jsxs("tr",{style:s%2===0?t.tableRow:t.tableRowAlt,children:[e.jsx("td",{style:t.tableCell,children:r.name}),e.jsx("td",{style:t.tableCell,children:formatFileSize(r.file_size)}),e.jsx("td",{style:t.tableCell,children:r.mime_type}),e.jsx("td",{style:t.tableCell,children:f(r.uploaded_at)}),e.jsx("td",{style:t.tableCell,children:r.uploaded_by||"N/A"})]},s))})]})]}),e.jsx("div",{style:t.footer,children:e.jsx("p",{children:"របាយការណ៍នេះត្រូវបានបង្កើតដោយប្រព័ន្ធតាមដានដីកម្ពុជា"})})]})},{Title:xt,Text:U}=de,{Panel:z}=Q;function mt({auth:l,contract_id:p}){const[a,x]=d.useState(!1),[i,V]=d.useState(null),[m,u]=d.useState(!1),[g,f]=d.useState(!1),[t,k]=d.useState(null),[v,b]=d.useState(null),[S,C]=d.useState(!1),{generatePDFFromComponent:_}=re();d.useEffect(()=>{p&&j(p)},[p]);const j=async s=>{var n,c;if(!s.trim()){h.error("សូមបញ្ចូលលេខកិច្ចសន្យា");return}x(!0);try{const o=await B.post("/api/reports/document/search",{contract_id:s.trim()});V(o.data),o.data&&o.data.contract?b(o.data.contract):b(null),h.success("រកឃើញកិច្ចសន្យា")}catch(o){console.error("បញ្ហាក្នុងការស្វែងរក:",o),h.error(((c=(n=o.response)==null?void 0:n.data)==null?void 0:c.error)||"មិនរកឃើញកិច្ចសន្យា"),V(null)}finally{x(!1)}},T=async s=>{var n,c;try{x(!0);const o=await B.post(`/api/reports/payment-steps/${s}/mark-as-paid`);h.success("បានកំណត់ថាបានបង់ប្រាក់ហើយ"),j(p)}catch(o){console.error("បញ្ហាក្នុងការកំណត់ថាបានបង់ប្រាក់:",o),h.error(((c=(n=o.response)==null?void 0:n.data)==null?void 0:c.error)||"មិនអាចកំណត់ថាបានបង់ប្រាក់")}finally{x(!1)}},w=async s=>{var n,c;try{x(!0);const o=await B.post(`/api/reports/payment-steps/${s}/mark-as-unpaid`);h.success("បានកំណត់ថាមិនទាន់បង់ប្រាក់"),j(p)}catch(o){console.error("បញ្ហាក្នុងការកំណត់ថាមិនទាន់បង់ប្រាក់:",o),h.error(((c=(n=o.response)==null?void 0:n.data)==null?void 0:c.error)||"មិនអាចកំណត់ថាមិនទាន់បង់ប្រាក់")}finally{x(!1)}},I=async s=>{if(!i){h.error("សូមស្វែងរកកិច្ចសន្យាជាមុនសិន");return}C(!0);try{if(s==="pdf"){const n=`document_report_${i.contract.contract_id}_${new Date().toISOString().split("T")[0]}.pdf`,c=e.jsx(je,{data:i,exportedBy:l.user.name}),o=await _(c,n);if(!o.success)throw new Error(o.error);h.success("នាំចេញ PDF បានជោគជ័យ")}else if(s==="excel"){const n=await B.post("/api/reports/document/export",{contract_id:i.contract.contract_id,format:"excel"},{responseType:"blob"}),c=window.URL.createObjectURL(new Blob([n.data])),o=document.createElement("a");o.href=c,o.setAttribute("download",`document_report_${i.contract.contract_id}.xlsx`),document.body.appendChild(o),o.click(),document.body.removeChild(o),h.success("នាំចេញ Excel បានជោគជ័យ")}}catch(n){console.error("Export error:",n),h.error(`មានបញ្ហាក្នុងការនាំចេញ: ${n.message}`)}finally{C(!1)}},A=()=>{if(!v){if(i&&i.contract){b(i.contract),u(!0);return}h.error("សូមស្វែងរកកិច្ចសន្យាមុននឹងផ្ទុកកិច្ចសន្យា");return}u(!0)},N=s=>{k(s),f(!0)},L=s=>{switch(s){case"paid":return e.jsxs(F,{color:"green",children:[e.jsx(P,{})," បានបង់ប្រាក់រួចរាល់"]});case"unpaid":default:return e.jsxs(F,{color:"red",children:[e.jsx(M,{})," មិនទាន់បង់ប្រាក់"]})}},r=[{title:"ដំណាក់កាល",dataIndex:"step_number",key:"step_number",width:120,render:s=>`ទី${s}`},{title:"ចំនួនទឹកប្រាក់",dataIndex:"amount",key:"amount",render:s=>`$${parseFloat(s).toLocaleString("en-US",{minimumFractionDigits:2})}`,width:150},{title:"កាលបរិច្ឆេទត្រូវបង់ប្រាក់",dataIndex:"due_date",key:"due_date",render:(s,n)=>new Date(s)<new Date&&n.status==="unpaid"?e.jsx(U,{strong:!0,style:{color:"red"},children:s}):e.jsx(U,{children:s})},{title:"ស្ថានភាព",dataIndex:"status",key:"status",render:s=>L(s)},{title:"សកម្មភាព",key:"actions",render:(s,n)=>e.jsx(E,{size:"small",children:n.status!=="paid"?e.jsx(O,{title:"តើអ្នកប្រាកដថាចង់កំណត់ថាបានបង់ប្រាក់នេះមែនទេ?",description:"ការសកម្មភាពនេះអាចត្រូវបានប្រព្រឹត្តទៅ",icon:e.jsx(W,{style:{color:"#faad14"}}),okText:"បាទ/ចាស",cancelText:"ទេ",okButtonProps:{style:{backgroundColor:"#1890ff",borderColor:"#1890ff"}},onConfirm:()=>T(n.id),children:e.jsx(y,{type:"primary",icon:e.jsx(P,{}),size:"small",style:{backgroundColor:"#52c41a",borderColor:"#52c41a"},title:"កំណត់ថាបានបង់ប្រាក់"})}):e.jsx(O,{title:"តើអ្នកប្រាកដថាចង់កំណត់ថាមិនទាន់បង់ប្រាក់នេះមែនទេ?",description:"ការសកម្មភាពនេះនឹងប្តូរស្ថានភាពទៅជាមិនទាន់បង់ប្រាក់",icon:e.jsx(W,{style:{color:"#faad14"}}),okText:"បាទ/ចាស",cancelText:"ទេ",okButtonProps:{style:{backgroundColor:"#ff4d4f",borderColor:"#ff4d4f"}},onConfirm:()=>w(n.id),children:e.jsx(y,{type:"primary",icon:e.jsx(M,{}),size:"small",style:{backgroundColor:"#ff4d4f",borderColor:"#ff4d4f"},title:"កំណត់ថាមិនទាន់បង់ប្រាក់"})})})}];return e.jsxs(Z,{user:l.user,header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"ព័ត៌មានលម្អិតកិច្ចសន្យា"}),children:[e.jsx(X,{title:`ព័ត៌មានលម្អិតកិច្ចសន្យា - ${p}`}),e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[e.jsxs(R,{className:"mb-6",children:[e.jsx(R.Item,{children:e.jsx(Y,{href:"/reports/document",children:"របាយការណ៍កិច្ចសន្យា"})}),e.jsx(R.Item,{children:"ព័ត៌មានលម្អិត"}),e.jsx(R.Item,{children:p})]}),e.jsx("div",{className:"mb-6",children:e.jsx(y,{icon:e.jsx(le,{}),onClick:()=>window.history.back(),children:"ត្រឡប់ក្រោយ"})}),a&&e.jsx("div",{className:"text-center my-8",children:e.jsx(oe,{size:"large"})}),i&&e.jsx(e.Fragment,{children:e.jsxs(D,{title:`កិច្ចសន្យា: ${i.contract.contract_id}`,className:"mb-6",extra:e.jsxs(E,{children:[e.jsx(y,{type:"primary",danger:!0,icon:e.jsx(ce,{}),onClick:()=>I("pdf"),loading:S,children:"នាំចេញជា PDF"}),e.jsx(y,{type:"primary",style:{backgroundColor:"#52c41a"},icon:e.jsx(ne,{}),onClick:()=>I("excel"),children:"នាំចេញជា Excel"}),e.jsx(y,{icon:e.jsx(ae,{}),onClick:()=>A(),children:"ផ្ទុកកិច្ចសន្យា"}),e.jsx(y,{icon:e.jsx(fe,{}),onClick:()=>N(null),children:"មើលកិច្ចសន្យាទាំងអស់"})]}),children:[e.jsxs(Q,{defaultActiveKey:["1","2","3"],children:[e.jsx(z,{header:"ព័ត៌មានអ្នកទិញ",children:i.contract.buyers&&i.contract.buyers.length>0?e.jsx(e.Fragment,{children:i.contract.buyers.map((s,n)=>e.jsxs("div",{className:n>0?"mt-4 pt-4 border-t":"",children:[i.contract.buyers.length>1&&e.jsxs("h4",{className:"font-bold mb-2",children:["អ្នកទិញទី ",n+1]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ឈ្មោះ:"})," ",s.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ទូរស័ព្ទ:"})," ",s.phone||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"អាសយដ្ឋាន:"})," ",s.address||"N/A"]})]},s.id))}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"ឈ្មោះ:"})," ",i.contract.buyer_info.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ទូរស័ព្ទ:"})," ",i.contract.buyer_info.phone||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"អាសយដ្ឋាន:"})," ",i.contract.buyer_info.address||"N/A"]})]})},"1"),e.jsx(z,{header:"ព័ត៌មានអ្នកលក់",children:i.contract.sellers&&i.contract.sellers.length>0?e.jsx(e.Fragment,{children:i.contract.sellers.map((s,n)=>e.jsxs("div",{className:n>0?"mt-4 pt-4 border-t":"",children:[i.contract.sellers.length>1&&e.jsxs("h4",{className:"font-bold mb-2",children:["អ្នកលក់ទី ",n+1]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ឈ្មោះ:"})," ",s.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ទូរស័ព្ទ:"})," ",s.phone||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"អាសយដ្ឋាន:"})," ",s.address||"N/A"]})]},s.id))}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"ឈ្មោះ:"})," ",i.contract.seller_info.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ទូរស័ព្ទ:"})," ",i.contract.seller_info.phone||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"អាសយដ្ឋាន:"})," ",i.contract.seller_info.address||"N/A"]})]})},"2"),e.jsx(z,{header:"ព័ត៌មានដី",children:i.contract.lands&&i.contract.lands.length>0?e.jsx(e.Fragment,{children:i.contract.lands.map((s,n)=>e.jsxs("div",{className:n>0?"mt-4 pt-4 border-t":"",children:[i.contract.lands.length>1&&e.jsxs("h4",{className:"font-bold mb-2",children:["ដីទី ",n+1]}),e.jsxs("p",{children:[e.jsx("strong",{children:"លេខក្បែងដី:"})," ",s.plot_number]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ទំហំ:"})," ",s.size]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ទីតាំង:"})," ",s.location]}),e.jsxs("p",{children:[e.jsx("strong",{children:"តម្លៃក្នុងម៉ែត្រការ៉េ:"})," ",s.price_per_meter]}),e.jsxs("p",{children:[e.jsx("strong",{children:"តម្លៃសរុប:"})," ",s.total_price]})]},s.id))}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"លេខក្បែងដី:"})," ",i.contract.land_info.plot_number]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ទំហំ:"})," ",i.contract.land_info.size]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ទីតាំង:"})," ",i.contract.land_info.location]})]})},"3")]}),e.jsx("div",{className:"mt-6",children:e.jsx(ie,{columns:r,dataSource:i.payment_steps,rowKey:"id",pagination:!1,size:"middle"})})]})}),!a&&!i&&e.jsx(D,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ee,{style:{fontSize:"48px",color:"#ccc"}}),e.jsx("p",{className:"mt-4 text-gray-500",children:"មិនរកឃើញកិច្ចសន្យា"})]})})]})}),e.jsx(te,{visible:m,onCancel:()=>u(!1),saleContract:v,onSuccess:()=>{u(!1),j(p)}}),e.jsx(se,{visible:g,onCancel:()=>f(!1),paymentStep:t})]})}export{mt as default};
