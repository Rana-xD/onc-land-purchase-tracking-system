import{r as m,I as E,_,R as F,j as r,B as b,s,e as z}from"./app-BBTICp4j.js";import{F as g}from"./index-C68SiXGT.js";import{M as B}from"./index-DSSNgvuj.js";import{S as O}from"./index-CcJgjeQ-.js";import{U as j}from"./index-DKeUDZu7.js";import"./index-C5oWf6N6.js";import"./row-Dtoexlvv.js";import"./PurePanel-DnHFRN3c.js";import"./DeleteOutlined--CfOCEP9.js";import"./DownloadOutlined-DboLZX6H.js";import"./EyeOutlined-Dift8YHl.js";import"./progress-0HAaq4eU.js";import"./CheckOutlined-DMU6mItx.js";var P={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.2 446.3l-.2-.8-112.2-285.1c-5-16.1-19.9-27.2-36.8-27.2H281.2c-17 0-32.1 11.3-36.9 27.6L139.4 443l-.3.7-.2.8c-1.3 4.9-1.7 9.9-1 14.8-.1 1.6-.2 3.2-.2 4.8V830a60.9 60.9 0 0060.8 60.8h627.2c33.5 0 60.8-27.3 60.9-60.8V464.1c0-1.3 0-2.6-.1-3.7.4-4.9 0-9.6-1.3-14.1zm-295.8-43l-.3 15.7c-.8 44.9-31.8 75.1-77.1 75.1-22.1 0-41.1-7.1-54.8-20.6S436 441.2 435.6 419l-.3-15.7H229.5L309 210h399.2l81.7 193.3H589.4zm-375 76.8h157.3c24.3 57.1 76 90.8 140.4 90.8 33.7 0 65-9.4 90.3-27.2 22.2-15.6 39.5-37.4 50.7-63.6h156.5V814H214.4V480.1z"}}]},name:"inbox",theme:"outlined"},T=function(p,t){return m.createElement(E,_({},p,{ref:t,icon:P}))},U=m.forwardRef(T);const{Dragger:D}=j;function W({visible:c,onCancel:p,saleContract:t,onSuccess:M}){const[u]=g.useForm(),[d,h]=m.useState([]),[x,y]=m.useState(!1);F.useEffect(()=>{console.log("DocumentUploadModal - saleContract prop:",t)},[t]),F.useEffect(()=>{c&&(u.resetFields(),h([]))},[c,t,u]);const R=o=>new Promise((a,n)=>{const e=new FileReader;e.readAsDataURL(o),e.onload=()=>a(e.result),e.onerror=i=>n(i)}),I=async()=>{var o,a;try{if(!t||!t.contract_id){s.error("ត្រូវការកិច្ចសន្យាលក់ទិញដើម្បីផ្ទុកឯកសារ");return}if(d.length===0){s.error("សូមជ្រើសរើសឯកសារមួយដើម្បីផ្ទុក");return}y(!0);const n=d[0],e=n.originFileObj||n;console.log("File object:",e),console.log("File type:",e.type),console.log("File size:",e.size);const i=await R(e);console.log("File converted to base64");const l=`/api/reports/contract-documents/${t.contract_id}/upload`;await z.post(l,{file:i,file_name:e.name,file_type:e.type,file_size:e.size},{headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Accept:"application/json"}}),s.success("ផ្ទុកឯកសារជោគជ័យ"),M()}catch(n){console.error("បញ្ហាក្នុងការផ្ទុកឯកសារ:",n);const e=(a=(o=n.response)==null?void 0:o.data)==null?void 0:a.error;if(typeof e=="string")s.error(e);else if(e&&typeof e=="object"){const i=[];Object.keys(e).forEach(l=>{const f=e[l];Array.isArray(f)?i.push(`${l}: ${f.join(", ")}`):typeof f=="string"&&i.push(`${l}: ${f}`)}),i.length>0?s.error(i.join(`
`)):s.error("មិនអាចផ្ទុកឯកសារបាន")}else s.error("មិនអាចផ្ទុកឯកសារបាន")}finally{y(!1)}},L={onRemove:o=>{h([])},beforeUpload:o=>o.type==="application/pdf"||o.type==="image/jpeg"||o.type==="image/png"?o.size/1024/1024<10?(h([o]),!1):(s.error("ឯកសារត្រូវតែមានទំហំតូចជាង 10MB!"),j.LIST_IGNORE):(s.error("អ្នកអាចផ្ទុកបានតែឯកសារប្រភេទ PDF, JPG, រឹ PNG ប៉ុណ្ណោះ!"),j.LIST_IGNORE),fileList:d};return r.jsx(B,{title:t?`ផ្ទុកឯកសារសម្រាប់កិច្ចសន្យាលក់ទិញ ${t.title||""}`:"ផ្ទុកឯកសារទូទៅ",open:c,onCancel:p,footer:[r.jsx(b,{onClick:p,children:"បោះបង់"},"cancel"),r.jsx(b,{type:"primary",onClick:I,loading:x,disabled:d.length===0,children:"ផ្ទុកឯកសារ"},"upload")],children:r.jsx(O,{spinning:x,children:r.jsx(g,{form:u,layout:"vertical",children:r.jsx(g.Item,{label:"ឯកសារ",children:r.jsxs(D,{...L,children:[r.jsx("p",{className:"ant-upload-drag-icon",children:r.jsx(U,{})}),r.jsx("p",{className:"ant-upload-text",children:"ចុចហើយអូសឯកសារទៅកាន់តំបន់នេះដើម្បីផ្ទុក"}),r.jsx("p",{className:"ant-upload-hint",children:"គាំទ្រប្រភេទ PDF, JPG, PNG។ ទំហំអតិបរមា: 10MB"})]})})})})})}export{W as default};
