import{r as m,j as t,Q as C,t as h,B as c,h as g,s as p,a as I}from"./app-BB1ZxGmZ.js";import{A as B}from"./AdminLayout-BuxP0tGi.js";import{L as v}from"./LandForm-Cx-PU88n.js";import{F as E,B as N}from"./BackImageUpload-9KlZxYkV.js";import{B as R}from"./Breadcrumb-W210Ky9C.js";import{C as F}from"./index-CFcJuZ_P.js";import{T as D}from"./index-4sotxCPT.js";import{S as y}from"./index-CQIrajnk.js";import{R as L,C as j}from"./row-C2x7paHm.js";import{R as T}from"./ArrowLeftOutlined-DPrGKClu.js";import{S as $}from"./index-19zJLVvd.js";import{R as w}from"./ArrowRightOutlined-6LNn2DEV.js";import{S as z}from"./index-D_u505qY.js";import"./UserOutlined-DbziX9m8.js";import"./index-BAJJZILe.js";import"./index-Dh1oKUG_.js";import"./EllipsisOutlined-BovgqE1k.js";import"./PurePanel-C84SwQv1.js";import"./InboxOutlined-DQe2Aezk.js";import"./dayjs.min-BKpMflCA.js";import"./khmerDate-iNtMyZoL.js";import"./index-BRhvAF0g.js";import"./index-quoohvpH.js";import"./getAllowClear-DfqxFJiv.js";import"./Input-AvN4Se7e.js";import"./useVariants-CY_Kcp5K.js";import"./EyeOutlined-Mb1FRF2d.js";import"./SearchOutlined-CokIhbHK.js";import"./EditOutlined-DBTY11ET.js";import"./index-Dgyafjhd.js";import"./CalendarOutlined-DBEW_rIX.js";import"./ClockCircleOutlined-C-s8qqeK.js";import"./useIcons-C3raLKSM.js";import"./CheckOutlined-bJGhASa0.js";import"./DownOutlined-Bh2zEb-F.js";import"./index-B_wGj_Gp.js";import"./SaveOutlined-BTWtA3Rs.js";import"./index-xjqdTS8d.js";import"./addEventListener-sAx3j2N4.js";import"./index-CwdmVelz.js";import"./DeleteOutlined-BYdkwIHm.js";import"./FileImageOutlined-DeKkUOaD.js";import"./index-D2Ym1l0Q.js";import"./DownloadOutlined-q1lRnuRm.js";import"./progress-D37wmuzZ.js";import"./index-Yxxb-zBk.js";import"./index-BaRQKH08.js";import"./UploadOutlined-Cn7Qfj15.js";const{Title:A,Text:wt}=D,{Step:Q}=y,{Option:zt}=z;function U({land:r,documents:l}){const[i,d]=m.useState(0),[o,f]=m.useState(null),[a,u]=m.useState(null),[M,x]=m.useState(!1);m.useEffect(()=>{l&&l.length>0&&l.forEach(e=>{const s={uid:e.id,name:e.file_name,fileName:e.file_name,url:`/storage/${e.file_path}`,base64:`/storage/${e.file_path}`,isExisting:!0,id:e.id,isDisplay:e.is_display,mimeType:"image/jpeg"};e.is_display?f(s):u(s)})},[l]);const n=[{title:"រូបខាងមុខ",content:"front-image"},{title:"រូបខាងក្រោយ",content:"back-image"},{title:"បញ្ចូលព័ត៌មាន",content:"land-info"}],b=()=>{if(i===0){if(!o){p.error("សូមផ្ទុកឡើងរូបខាងមុខ");return}}else if(i===1&&!a){p.error("សូមផ្ទុកឡើងរូបខាងក្រោយ");return}d(i+1)},S=()=>{d(i-1)},_=async e=>{x(!0);try{const s=[];o&&s.push({...o,isDisplay:!0,type:"front"}),a&&s.push({...a,isDisplay:!1,type:"back"});const k={...e,files:s};await I.put(`/api/lands/${r.id}`,k),p.success("ដីត្រូវបានកែប្រែដោយជោគជ័យ"),g.visit(route("data-entry.lands.index"))}catch(s){console.error("Error updating land:",s),p.error("មានបញ្ហាក្នុងការកែប្រែដី")}finally{x(!1)}};return t.jsxs(t.Fragment,{children:[t.jsx(C,{title:"កែប្រែដី"}),t.jsxs("div",{className:"land-edit",children:[t.jsx(R,{items:[{title:t.jsx(h,{href:route("data-entry.index"),children:"ជ្រើសរើសប្រភេទទិន្នន័យ"})},{title:t.jsx(h,{href:route("data-entry.lands.index"),children:"បញ្ជីដី"})},{title:"កែប្រែដី"}],className:"mb-6"}),t.jsxs(F,{children:[t.jsx(A,{level:4,className:"khmer-heading mb-6",children:"កែប្រែដី"}),t.jsx(y,{current:i,className:"mb-8",children:n.map(e=>t.jsx(Q,{title:e.title,icon:e.icon},e.title))}),t.jsxs("div",{className:"steps-content mb-6",children:[n[i].content==="front-image"&&t.jsx(E,{category:"land",frontImage:o,onFrontImageChange:f}),n[i].content==="back-image"&&t.jsx(N,{category:"land",backImage:a,onBackImageChange:u}),n[i].content==="land-info"&&t.jsx(v,{onSubmit:_,files:[o,a].filter(Boolean),frontImage:o,initialValues:{plot_number:r.title_deed_number,location:r.location,date_of_registration:r.date_of_registration?dayjs(r.date_of_registration):null,size:r.size}})]}),t.jsx("div",{className:"steps-action",children:t.jsxs(L,{justify:"space-between",children:[t.jsx(j,{children:i>0&&t.jsx(c,{icon:t.jsx(T,{}),onClick:S,children:"ត្រឡប់ក្រោយ"})}),t.jsx(j,{children:t.jsxs($,{children:[t.jsx(c,{onClick:()=>g.visit(route("data-entry.lands.index")),children:"បោះបង់"}),i<n.length-1&&t.jsx(c,{type:"primary",onClick:b,icon:t.jsx(w,{}),iconPosition:"end",children:i===0?"បន្តទៅរូបខាងក្រោយ":"បន្ទាប់"})]})})]})})]})]})]})}U.layout=r=>t.jsx(B,{title:"កែប្រែដី",children:r});export{U as default};
