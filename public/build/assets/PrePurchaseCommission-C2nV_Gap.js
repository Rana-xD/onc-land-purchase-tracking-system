import{r as i,j as e,Q as L,d as f}from"./app-D0OhDuOP.js";import{A as N,B as H}from"./AdminLayout-DfyZC7U7.js";import{F as l}from"./index-01QrSur2.js";import{T as J}from"./index-DUD5X347.js";import{C as O,R as U}from"./index-BXZQm44E.js";import{R as G,C as b}from"./row-Cvvd4www.js";import{I as T}from"./index-DyIYvMCA.js";import{R as W}from"./SearchOutlined-DdbS1Qlk.js";import{T as g,B as m}from"./index-XQ9uBlxv.js";import{F as X}from"./Table-CJMywyvl.js";import{M as Y}from"./index-DSx0c0nZ.js";import{T as Z}from"./index-Dx6sVVHZ.js";import{S as F}from"./index-CpY42lHj.js";import{s as o}from"./index-VXrvBi_7.js";import{R as ee}from"./EditOutlined-BQAB7wjt.js";import{P as R}from"./index-BLwNk9Dd.js";import{R as te}from"./DeleteOutlined-C5fTVnAq.js";import{R as se}from"./CheckCircleOutlined-_P5yC29H.js";import"./UserOutlined-Bw1Yg3TV.js";import"./index-BKPGZTnh.js";import"./EllipsisOutlined-BcUT9_x5.js";import"./PurePanel-BrlMViLC.js";import"./index-BoUcoXbW.js";import"./CheckOutlined-C-W3vkf9.js";import"./ExclamationCircleFilled-BuCwC-hN.js";import"./CloseOutlined-CSg-7HVH.js";import"./getAllowClear-7r21EHJH.js";import"./Skeleton-BB1PfEPR.js";import"./useVariants-VmmnPvRy.js";import"./index-BNYa27A7.js";import"./Input-DIi4XD1o.js";import"./pickAttrs-BMtZpb9Y.js";import"./EyeOutlined-Bk9sN1n5.js";import"./addEventListener-Dvq9iQDE.js";import"./index-BXlDNFm_.js";import"./useIcons-De8HtjeC.js";import"./DownOutlined-BKT6hG3e.js";import"./index-CxyNWzZ_.js";import"./useBubbleLock-Dp5g0NxF.js";import"./index-HowiUfuo.js";import"./Pagination-C28t5-1k.js";import"./index-Bjcdw0HM.js";import"./extendsObject-78o_rR5W.js";import"./FileOutlined-CmtzEeI9.js";import"./FolderOutlined-CsvjmU0T.js";import"./InfoCircleFilled-Csbq1HVY.js";import"./ActionButton-DPI_9ZHB.js";import"./useClosable-rmjEiMr1.js";const{Title:re,Text:_}=J,{TextArea:ae}=T;function Ze(){const[$,B]=i.useState([]),[M,w]=i.useState(!1),[z,j]=i.useState(!1),[u,y]=i.useState(null),[n]=l.useForm(),[h,A]=i.useState(""),[x,P]=i.useState({current:1,pageSize:15,total:0}),E=t=>new Intl.NumberFormat("km-KH",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(t||0),c=async(t=1,s="")=>{w(!0);try{const r=await f.get("/commissions/api/pre-purchase",{params:{page:t,search:s}});r.data.commissions&&(B(r.data.commissions),P({current:r.data.pagination.current_page,pageSize:r.data.pagination.per_page,total:r.data.pagination.total}))}catch{o.error("មានបញ្ហាក្នុងការទាញយកទិន្នន័យ")}finally{w(!1)}};i.useEffect(()=>{c()},[]);const v=t=>{A(t),c(1,t)},D=t=>{c(t.current,h)},S=(t=null)=>{y(t),j(!0),t?n.setFieldsValue({recipient_name:t.recipient_name,total_amount:t.total_amount,description:t.description}):n.resetFields()},k=()=>{j(!1),y(null),n.resetFields()},Q=async t=>{var s,r,a,I;try{const p=u?`/commissions/api/pre-purchase/${u.id}`:"/commissions/api/pre-purchase",d=await f[u?"put":"post"](p,t);d.data.success&&(o.success(d.data.message),j(!1),y(null),n.resetFields(),c(x.current,h))}catch(p){if((r=(s=p.response)==null?void 0:s.data)!=null&&r.errors){const C=p.response.data.errors;Object.keys(C).forEach(d=>{n.setFields([{name:d,errors:C[d]}])})}else o.error(((I=(a=p.response)==null?void 0:a.data)==null?void 0:I.message)||"មានបញ្ហាក្នុងការរក្សាទុក")}},V=async t=>{var s,r;try{const a=await f.delete(`/commissions/api/pre-purchase/${t}`);a.data.success&&(o.success(a.data.message),c(x.current,h))}catch(a){o.error(((r=(s=a.response)==null?void 0:s.data)==null?void 0:r.message)||"មានបញ្ហាក្នុងការលុប")}},q=async t=>{var s,r;try{const a=await f.patch(`/commissions/api/pre-purchase/${t}/mark-paid`);a.data.success&&(o.success(a.data.message),c(x.current,h))}catch(a){o.error(((r=(s=a.response)==null?void 0:s.data)==null?void 0:r.message)||"មានបញ្ហាក្នុងការបញ្ជាក់ការទូទាត់")}},K=[{title:"ឈ្មោះអ្នកទទួល",dataIndex:"recipient_name",key:"recipient_name",render:t=>e.jsx(_,{strong:!0,children:t})},{title:"ចំនួនទឹកប្រាក់",dataIndex:"total_amount",key:"total_amount",align:"right",render:t=>e.jsx(_,{strong:!0,children:E(t)})},{title:"ការពិពណ៌នា",dataIndex:"description",key:"description",render:t=>t||"-"},{title:"ស្ថានភាព",dataIndex:"status",key:"status",align:"center",render:t=>e.jsx(H,{status:t==="paid"?"success":"warning",text:t==="paid"?"បានបង់ហើយ":"មិនទាន់បង់"})},{title:"សកម្មភាព",key:"actions",align:"center",render:(t,s)=>e.jsxs(F,{children:[e.jsx(g,{title:"កែប្រែកម៉ីសិន",children:e.jsx(m,{type:"link",icon:e.jsx(ee,{}),onClick:()=>S(s),size:"small"})}),e.jsx(R,{title:"តើអ្នកពិតជាចង់លុបមែនទេ?",onConfirm:()=>V(s.id),okText:"យល់ព្រម",cancelText:"បោះបង់",children:e.jsx(g,{title:"លុបកម៉ីសិន",children:e.jsx(m,{type:"link",danger:!0,icon:e.jsx(te,{}),size:"small"})})}),s.status==="pending"&&e.jsx(R,{title:"តើអ្នកពិតជាចង់បញ្ជាក់ការទូទាត់មែនទេ?",onConfirm:()=>q(s.id),okText:"យល់ព្រម",cancelText:"បោះបង់",children:e.jsx(g,{title:"បញ្ជាក់ការទូទាត់",children:e.jsx(m,{type:"link",icon:e.jsx(se,{}),size:"small",style:{color:"#52c41a"}})})})]})}];return e.jsxs(N,{children:[e.jsx(L,{title:"កម៉ីសិនមុនទិញ"}),e.jsxs("div",{style:{padding:"24px"},children:[e.jsx("div",{style:{marginBottom:"24px",textAlign:"center"},children:e.jsx(re,{level:2,style:{margin:0},children:"កម៉ីសិនមុនទិញ"})}),e.jsxs(O,{children:[e.jsxs(G,{justify:"space-between",align:"middle",style:{marginBottom:"16px"},children:[e.jsx(b,{children:e.jsx(T.Search,{placeholder:"ស្វែងរកតាមឈ្មោះ...",allowClear:!0,onSearch:v,style:{width:300},prefix:e.jsx(W,{})})}),e.jsx(b,{children:e.jsx(g,{title:"បន្ថែមកម៉ីសិនមុនទិញថ្មី",children:e.jsx(m,{type:"primary",icon:e.jsx(U,{}),onClick:()=>S(),children:"បន្ថែមថ្មី"})})})]}),e.jsx(X,{columns:K,dataSource:$,rowKey:"id",loading:M,pagination:{...x,showSizeChanger:!1,showQuickJumper:!0,showTotal:(t,s)=>`${s[0]}-${s[1]} នៃ ${t} ធាតុ`},onChange:D,locale:{emptyText:"មិនមានទិន្នន័យ"}})]}),e.jsx(Y,{title:u?"កែប្រែកម៉ីសិនមុនទិញ":"បន្ថែមកម៉ីសិនមុនទិញ",open:z,onCancel:k,footer:null,width:600,children:e.jsxs(l,{form:n,layout:"vertical",onFinish:Q,children:[e.jsx(l.Item,{name:"recipient_name",label:"ឈ្មោះអ្នកទទួល",rules:[{required:!0,message:"សូមបញ្ចូលឈ្មោះអ្នកទទួល"}],children:e.jsx(T,{placeholder:"បញ្ចូលឈ្មោះអ្នកទទួល"})}),e.jsx(l.Item,{name:"total_amount",label:"ចំនួនទឹកប្រាក់",rules:[{required:!0,message:"សូមបញ្ចូលចំនួនទឹកប្រាក់"},{type:"number",min:.01,message:"ចំនួនទឹកប្រាក់ត្រូវតែធំជាង 0"}],children:e.jsx(Z,{placeholder:"បញ្ចូលចំនួនទឹកប្រាក់",style:{width:"100%"},formatter:t=>`$ ${t}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:t=>t.replace(/\$\s?|(,*)/g,""),precision:2})}),e.jsx(l.Item,{name:"description",label:"ការពិពណ៌នា",children:e.jsx(ae,{placeholder:"បញ្ចូលការពិពណ៌នា (ស្រេចចិត្ត)",rows:4})}),e.jsx(l.Item,{style:{marginBottom:0,textAlign:"right"},children:e.jsxs(F,{children:[e.jsx(m,{onClick:k,children:"បោះបង់"}),e.jsx(m,{type:"primary",htmlType:"submit",children:"រក្សាទុក"})]})})]})})]})]})}export{Ze as default};
