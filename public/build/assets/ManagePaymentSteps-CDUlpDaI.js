import{r as g,j as e,Q as R,B as m,h as z,a as W,s as M}from"./app-zwF1qXmt.js";import{A as $}from"./AdminLayout-7EiKnzDi.js";import{d as p}from"./dayjs.min-CRXJIXUF.js";import{F as x}from"./index-DXl_YxVc.js";import{S as I}from"./index-Dcqx-5CC.js";import{R as E}from"./ArrowLeftOutlined-Tw5MBVrk.js";import{T as K}from"./index-Bur7rjdX.js";import{C as a}from"./index-BViq9QJ5.js";import{D as h}from"./index-DGJOJLw9.js";import{R as Q,C as j}from"./row-CL6R5YQg.js";import{F as V}from"./Table-BOxY9eJ4.js";import{M as H}from"./index-DNJxu2mi.js";import{I as L}from"./index-DnWjr1E0.js";import{B as N}from"./index-BTMXsAZS.js";import{T as U}from"./index-B73L-RiE.js";import{R as q}from"./CheckCircleOutlined-DSJjJs7V.js";import"./UserOutlined-_tsZ_L2L.js";import"./index-BwOrOVI4.js";import"./EllipsisOutlined-BgCch_Wi.js";import"./PurePanel-BlgAcrce.js";import"./InboxOutlined-C6Tl-Jce.js";import"./EditOutlined-DAqDAxHf.js";import"./getAllowClear-DSmRZVga.js";import"./useVariants-DJWLAYkM.js";import"./CheckOutlined-CWbPYj3k.js";import"./addEventListener-VTVT0Xmn.js";import"./index-CseKHSuS.js";import"./useIcons-DF0NetuM.js";import"./DownOutlined-CAWJwJ4J.js";import"./SearchOutlined-ckskIcIF.js";import"./index-DZvpsH_A.js";import"./useBubbleLock-Be9_HeRQ.js";import"./index-c65RzQeC.js";import"./Pagination-a66s3alc.js";import"./index-lwJ32dcB.js";import"./FileOutlined-Cr8DQwSN.js";import"./FolderOutlined-D2Qk_bz3.js";import"./Input-BkgYjX8b.js";import"./EyeOutlined-DlB_godP.js";const{Title:G,Text:r}=K,{TextArea:J}=L;function Re({commission:i}){const[Y,u]=g.useState(!1),[n,y]=g.useState(null),[d]=x.useForm(),[o,F]=g.useState(i.payment_steps||[]),l=t=>new Intl.NumberFormat("km-KH",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(t||0),_=()=>{z.visit("/commissions/post-purchase")},v=t=>{y(t),u(!0),d.resetFields()},b=()=>{u(!1),y(null),d.resetFields()},A=async t=>{var s,k;try{const c=await W.patch(`/commissions/api/payment-steps/${n.id}/mark-paid`,t);c.data.success&&(M.success(c.data.message),u(!1),y(null),d.resetFields(),F(w=>w.map(f=>f.id===n.id?{...f,status:"paid",paid_date:p().format("YYYY-MM-DD"),notes:t.notes}:f)))}catch(c){M.error(((k=(s=c.response)==null?void 0:s.data)==null?void 0:k.message)||"មានបញ្ហាក្នុងការបញ្ជាក់ការទូទាត់")}},D=[{title:"ជំហាន",dataIndex:"step_number",key:"step_number",render:t=>e.jsxs(r,{strong:!0,children:["ជំហានទី ",t]})},{title:"ចំនួនទឹកប្រាក់",dataIndex:"amount",key:"amount",align:"right",render:t=>e.jsx(r,{strong:!0,children:l(t)})},{title:"កាលបរិច្ឆេទ",dataIndex:"due_date",key:"due_date",render:t=>p(t).format("DD/MM/YYYY")},{title:"ស្ថានភាព",dataIndex:"status",key:"status",align:"center",render:t=>e.jsx(N,{status:t==="paid"?"success":"warning",text:t==="paid"?"បានបង់ហើយ":"មិនទាន់បង់"})},{title:"កាលបរិច្ឆេទបង់",dataIndex:"paid_date",key:"paid_date",render:t=>t?p(t).format("DD/MM/YYYY"):"-"},{title:"កំណត់ចំណាំ",dataIndex:"notes",key:"notes",render:t=>t||"-"},{title:"សកម្មភាព",key:"actions",align:"center",render:(t,s)=>s.status==="pending"&&e.jsx(U,{title:"បញ្ជាក់ថាជំហាននេះត្រូវបានបង់រួចហើយ",children:e.jsx(m,{type:"primary",icon:e.jsx(q,{}),onClick:()=>v(s),size:"small",children:"បញ្ជាក់ការទូទាត់"})})}],C=o.reduce((t,s)=>t+parseFloat(s.amount),0),S=o.filter(t=>t.status==="paid").reduce((t,s)=>t+parseFloat(s.amount),0),B=C-S,P=o.length,T=o.filter(t=>t.status==="paid").length;return e.jsxs($,{children:[e.jsx(R,{title:`ជំហានទូទាត់កុំស្យុង - ${i.recipient_name}`}),e.jsxs("div",{style:{padding:"24px"},children:[e.jsx("div",{style:{marginBottom:"24px"},children:e.jsxs(I,{align:"center",children:[e.jsx(m,{icon:e.jsx(E,{}),onClick:_,type:"text"}),e.jsxs(G,{level:2,style:{margin:0},children:["ជំហានទូទាត់កុំស្យុង - ",i.recipient_name]})]})}),e.jsx(a,{style:{marginBottom:"24px"},children:e.jsxs(h,{title:"ព័ត៌មានកុំស្យុង",bordered:!0,column:2,children:[e.jsx(h.Item,{label:"ឈ្មោះអ្នកទទួល",children:e.jsx(r,{strong:!0,children:i.recipient_name})}),e.jsx(h.Item,{label:"ចំនួនសរុប",children:e.jsx(r,{strong:!0,children:l(i.total_amount)})}),e.jsx(h.Item,{label:"ការពិពណ៌នា",span:2,children:i.description||"-"})]})}),e.jsxs(Q,{gutter:16,style:{marginBottom:"24px"},children:[e.jsx(j,{xs:24,sm:6,children:e.jsx(a,{children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(r,{type:"secondary",children:"ជំហានសរុប"}),e.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#1890ff"},children:P})]})})}),e.jsx(j,{xs:24,sm:6,children:e.jsx(a,{children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(r,{type:"secondary",children:"ជំហានបានបង់"}),e.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#52c41a"},children:T})]})})}),e.jsx(j,{xs:24,sm:6,children:e.jsx(a,{children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(r,{type:"secondary",children:"ចំនួនបានបង់"}),e.jsx("div",{style:{fontSize:"18px",fontWeight:"bold",color:"#52c41a"},children:l(S)})]})})}),e.jsx(j,{xs:24,sm:6,children:e.jsx(a,{children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(r,{type:"secondary",children:"ចំនួននៅសល់"}),e.jsx("div",{style:{fontSize:"18px",fontWeight:"bold",color:"#faad14"},children:l(B)})]})})})]}),e.jsx(a,{title:"ជំហានទូទាត់",children:e.jsx(V,{columns:D,dataSource:o,rowKey:"id",pagination:!1,locale:{emptyText:"មិនមានជំហានទូទាត់"}})}),e.jsx(H,{title:"បញ្ជាក់ការទូទាត់",open:Y,onCancel:b,footer:null,width:500,children:n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"16px",padding:"12px",backgroundColor:"#f5f5f5",borderRadius:"6px"},children:[e.jsxs(r,{strong:!0,children:["ជំហានទី ",n.step_number]}),e.jsx("br",{}),e.jsxs(r,{children:["ចំនួនទឹកប្រាក់: ",l(n.amount)]}),e.jsx("br",{}),e.jsxs(r,{children:["កាលបរិច្ឆេទ: ",p(n.due_date).format("DD/MM/YYYY")]})]}),e.jsxs(x,{form:d,layout:"vertical",onFinish:A,children:[e.jsx(x.Item,{name:"notes",label:"កំណត់ចំណាំ",children:e.jsx(J,{placeholder:"បញ្ចូលកំណត់ចំណាំ (ស្រេចចិត្ត)",rows:4})}),e.jsx(x.Item,{style:{marginBottom:0,textAlign:"right"},children:e.jsxs(I,{children:[e.jsx(m,{onClick:b,children:"បោះបង់"}),e.jsx(m,{type:"primary",htmlType:"submit",children:"បញ្ជាក់"})]})})]})]})})]})]})}export{Re as default};
