import{r as f,_ as E,R as F,j as r,d as _}from"./app-D0OhDuOP.js";import{F as g}from"./index-01QrSur2.js";import{M as z}from"./index-DSx0c0nZ.js";import{S as B}from"./index-Bjcdw0HM.js";import{U as j}from"./index-FPFFDuuk.js";import{I as O,B as b}from"./index-XQ9uBlxv.js";import{s}from"./index-VXrvBi_7.js";import"./row-Cvvd4www.js";import"./index-BNYa27A7.js";import"./CheckOutlined-C-W3vkf9.js";import"./ExclamationCircleFilled-BuCwC-hN.js";import"./CloseOutlined-CSg-7HVH.js";import"./InfoCircleFilled-Csbq1HVY.js";import"./ActionButton-DPI_9ZHB.js";import"./pickAttrs-BMtZpb9Y.js";import"./useClosable-rmjEiMr1.js";import"./extendsObject-78o_rR5W.js";import"./Skeleton-BB1PfEPR.js";import"./PurePanel-BrlMViLC.js";import"./DeleteOutlined-C5fTVnAq.js";import"./DownloadOutlined-BFocYQwA.js";import"./EyeOutlined-Bk9sN1n5.js";import"./progress-CZwQN1Wi.js";var P={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.2 446.3l-.2-.8-112.2-285.1c-5-16.1-19.9-27.2-36.8-27.2H281.2c-17 0-32.1 11.3-36.9 27.6L139.4 443l-.3.7-.2.8c-1.3 4.9-1.7 9.9-1 14.8-.1 1.6-.2 3.2-.2 4.8V830a60.9 60.9 0 0060.8 60.8h627.2c33.5 0 60.8-27.3 60.9-60.8V464.1c0-1.3 0-2.6-.1-3.7.4-4.9 0-9.6-1.3-14.1zm-295.8-43l-.3 15.7c-.8 44.9-31.8 75.1-77.1 75.1-22.1 0-41.1-7.1-54.8-20.6S436 441.2 435.6 419l-.3-15.7H229.5L309 210h399.2l81.7 193.3H589.4zm-375 76.8h157.3c24.3 57.1 76 90.8 140.4 90.8 33.7 0 65-9.4 90.3-27.2 22.2-15.6 39.5-37.4 50.7-63.6h156.5V814H214.4V480.1z"}}]},name:"inbox",theme:"outlined"},T=function(c,t){return f.createElement(O,E({},c,{ref:t,icon:P}))},U=f.forwardRef(T);const{Dragger:D}=j;function se({visible:p,onCancel:c,saleContract:t,onSuccess:M}){const[u]=g.useForm(),[d,h]=f.useState([]),[x,y]=f.useState(!1);F.useEffect(()=>{console.log("DocumentUploadModal - saleContract prop:",t)},[t]),F.useEffect(()=>{p&&(u.resetFields(),h([]))},[p,t,u]);const R=o=>new Promise((a,i)=>{const e=new FileReader;e.readAsDataURL(o),e.onload=()=>a(e.result),e.onerror=n=>i(n)}),I=async()=>{var o,a;try{if(!t||!t.contract_id){s.error("ត្រូវការកិច្ចសន្យាលក់ទិញដើម្បីផ្ទុកឯកសារ");return}if(d.length===0){s.error("សូមជ្រើសរើសឯកសារមួយដើម្បីផ្ទុក");return}y(!0);const i=d[0],e=i.originFileObj||i;console.log("File object:",e),console.log("File type:",e.type),console.log("File size:",e.size);const n=await R(e);console.log("File converted to base64");const l=`/api/reports/contract-documents/${t.contract_id}/upload`;await _.post(l,{file:n,file_name:e.name,file_type:e.type,file_size:e.size},{headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Accept:"application/json"}}),s.success("ផ្ទុកឯកសារជោគជ័យ"),M()}catch(i){console.error("បញ្ហាក្នុងការផ្ទុកឯកសារ:",i);const e=(a=(o=i.response)==null?void 0:o.data)==null?void 0:a.error;if(typeof e=="string")s.error(e);else if(e&&typeof e=="object"){const n=[];Object.keys(e).forEach(l=>{const m=e[l];Array.isArray(m)?n.push(`${l}: ${m.join(", ")}`):typeof m=="string"&&n.push(`${l}: ${m}`)}),n.length>0?s.error(n.join(`
`)):s.error("មិនអាចផ្ទុកឯកសារបាន")}else s.error("មិនអាចផ្ទុកឯកសារបាន")}finally{y(!1)}},L={onRemove:o=>{h([])},beforeUpload:o=>o.type==="application/pdf"||o.type==="image/jpeg"||o.type==="image/png"?o.size/1024/1024<10?(h([o]),!1):(s.error("ឯកសារត្រូវតែមានទំហំតូចជាង 10MB!"),j.LIST_IGNORE):(s.error("អ្នកអាចផ្ទុកបានតែឯកសារប្រភេទ PDF, JPG, រឹ PNG ប៉ុណ្ណោះ!"),j.LIST_IGNORE),fileList:d};return r.jsx(z,{title:t?`ផ្ទុកឯកសារសម្រាប់កិច្ចសន្យាលក់ទិញ ${t.title||""}`:"ផ្ទុកឯកសារទូទៅ",open:p,onCancel:c,footer:[r.jsx(b,{onClick:c,children:"បោះបង់"},"cancel"),r.jsx(b,{type:"primary",onClick:I,loading:x,disabled:d.length===0,children:"ផ្ទុកឯកសារ"},"upload")],children:r.jsx(B,{spinning:x,children:r.jsx(g,{form:u,layout:"vertical",children:r.jsx(g.Item,{label:"ឯកសារ",children:r.jsxs(D,{...L,children:[r.jsx("p",{className:"ant-upload-drag-icon",children:r.jsx(U,{})}),r.jsx("p",{className:"ant-upload-text",children:"ចុចហើយអូសឯកសារទៅកាន់តំបន់នេះដើម្បីផ្ទុក"}),r.jsx("p",{className:"ant-upload-hint",children:"គាំទ្រប្រភេទ PDF, JPG, PNG។ ទំហំអតិបរមា: 10MB"})]})})})})})}export{se as default};
