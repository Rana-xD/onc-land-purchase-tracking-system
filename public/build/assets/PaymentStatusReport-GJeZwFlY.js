import{r as n,d as $,j as e,Q as z,t as P}from"./app-D0OhDuOP.js";import{A as U}from"./AdminLayout-DfyZC7U7.js";import{s as m}from"./index-VXrvBi_7.js";import{C as o}from"./index-BXZQm44E.js";import{R as p,C as s}from"./row-Cvvd4www.js";import{T as N}from"./index-DUD5X347.js";import{S as w}from"./index-Bjcdw0HM.js";import{A as O}from"./index-Ctm2Ggmv.js";import{S as i}from"./index-CpY42lHj.js";import{T as v,B as A}from"./index-XQ9uBlxv.js";import{R as Q}from"./FilePdfOutlined-BmX1d_m5.js";import{R as W}from"./FileExcelOutlined-BY1VKBUv.js";import{E as M}from"./index-BXlDNFm_.js";import{R as V}from"./FolderOutlined-CsvjmU0T.js";import{D as q}from"./index-BoUcoXbW.js";import{R as D}from"./FileOutlined-CmtzEeI9.js";import{R as h}from"./DollarOutlined-BgkhO_OZ.js";import{L as T}from"./index-gO1UGJsN.js";import"./UserOutlined-Bw1Yg3TV.js";import"./index-BKPGZTnh.js";import"./EllipsisOutlined-BcUT9_x5.js";import"./PurePanel-BrlMViLC.js";import"./ExclamationCircleFilled-BuCwC-hN.js";import"./CloseOutlined-CSg-7HVH.js";import"./InfoCircleFilled-Csbq1HVY.js";import"./pickAttrs-BMtZpb9Y.js";import"./Skeleton-BB1PfEPR.js";import"./useVariants-VmmnPvRy.js";import"./index-BNYa27A7.js";import"./EditOutlined-BQAB7wjt.js";import"./getAllowClear-7r21EHJH.js";import"./CheckOutlined-C-W3vkf9.js";import"./useIcons-De8HtjeC.js";import"./DownOutlined-BKT6hG3e.js";import"./SearchOutlined-DdbS1Qlk.js";import"./extendsObject-78o_rR5W.js";import"./Pagination-C28t5-1k.js";const{Title:G,Text:l}=N,j={padding:"16px",borderRadius:"2px",boxShadow:"0 1px 2px rgba(0,0,0,0.05)",height:"100%"},u={fontSize:"24px",fontWeight:"bold",marginTop:"8px",display:"block"},g={fontSize:"14px",color:"rgba(0, 0, 0, 0.45)",marginBottom:"4px"},ve=({auth:F})=>{const[a,b]=n.useState(!1),[C,S]=n.useState(!1),[I,R]=n.useState(null),[r,_]=n.useState(null),[B,y]=n.useState(null),d=t=>t==null?"$0.00":"$"+new Intl.NumberFormat("en-US").format(t),k=n.useCallback(async()=>{b(!0),y(null),_(null);try{const t=await $.post("/reports/payment-status/data");_(t.data)}catch(t){console.error("Error fetching payment status report data:",t),y(t.response&&t.response.data&&t.response.data.error?t.response.data.error:"Failed to fetch report data"),m.error("Failed to load payment status data. Please refresh the page.")}finally{b(!1)}},[]);n.useEffect(()=>{k()},[k]);const E=n.useCallback(async t=>{S(!0),R(t),m.loading(`Preparing ${t.toUpperCase()} export...`);try{const c=await $.post("/reports/payment-status/export",{format:t},{responseType:"blob"}),f=new Blob([c.data],{type:t==="pdf"?"application/pdf":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),L=window.URL.createObjectURL(f),x=document.createElement("a");x.href=L,x.setAttribute("download",`payment_status_report_${new Date().toISOString().split("T")[0]}.${t==="excel"?"xlsx":t}`),document.body.appendChild(x),x.click(),x.remove(),m.success(`${t.toUpperCase()} exported successfully!`)}catch(c){console.error(`Error exporting ${t}:`,c),y(`Failed to export report as ${t}`),m.error(`Failed to export ${t.toUpperCase()}. Please try again.`)}finally{S(!1),R(null)}},[]);return e.jsxs(U,{user:F.user,children:[e.jsx(z,{title:"របាយការណ៍ប្រាក់បានបង់/មិនទាន់បង់"}),e.jsxs("div",{style:{padding:"24px"},children:[e.jsx(o,{style:{marginBottom:"24px"},children:e.jsxs(p,{gutter:16,align:"middle",children:[e.jsx(s,{xs:24,sm:12,children:e.jsx(G,{level:4,style:{margin:0},children:"របាយការណ៍ប្រាក់បានបង់/មិនទាន់បង់"})}),e.jsx(s,{xs:24,sm:12,style:{textAlign:"right"},children:a&&e.jsx(w,{})})]})}),B&&e.jsx(O,{message:"Error",description:B,type:"error",showIcon:!0,style:{marginBottom:"24px"}}),!a&&r&&r.contracts&&r.contracts.length>0&&e.jsxs(p,{gutter:16,style:{marginBottom:"24px"},children:[e.jsx(s,{xs:24,sm:8,style:{marginBottom:"16px"},children:e.jsx(o,{style:{...j,backgroundColor:"#e6f7ff"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{style:g,children:"ចំនួនសរុបទាំងអស់"}),e.jsx("span",{style:{...u},children:d(r.summary.total_amount)})]})})}),e.jsx(s,{xs:24,sm:8,style:{marginBottom:"16px"},children:e.jsx(o,{style:{...j,backgroundColor:"#f6ffed"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{style:g,children:"ចំនួនបានបង់"}),e.jsx("span",{style:{...u,color:"#52c41a"},children:d(r.summary.total_paid)})]})})}),e.jsx(s,{xs:24,sm:8,style:{marginBottom:"16px"},children:e.jsx(o,{style:{...j,backgroundColor:"#fff1f0"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{style:g,children:"ចំនួនមិនទាន់បង់"}),e.jsx("span",{style:{...u,color:"#f5222d"},children:d(r.summary.total_unpaid)})]})})})]}),!a&&r&&r.contracts&&r.contracts.length>0&&e.jsx(o,{style:{marginBottom:"24px"},children:e.jsxs(p,{gutter:16,align:"middle",children:[e.jsx(s,{xs:24,sm:12,children:e.jsx(l,{children:"ទិន្នន័យរបាយការណ៍"})}),e.jsx(s,{xs:24,sm:12,style:{textAlign:"right"},children:e.jsxs(i,{children:[e.jsx(v,{title:"នាំចេញរបាយការណ៍ជាឯកសារ PDF",children:e.jsx(A,{type:"primary",style:{backgroundColor:"#ff4d4f"},icon:e.jsx(Q,{}),onClick:()=>E("pdf"),loading:C&&I==="pdf",children:"PDF"})}),e.jsx(v,{title:"នាំចេញរបាយការណ៍ជាឯកសារ Excel",children:e.jsx(A,{type:"primary",style:{backgroundColor:"#52c41a"},icon:e.jsx(W,{}),onClick:()=>E("excel"),loading:C&&I==="excel",children:"Excel"})})]})})]})}),a&&e.jsxs(o,{style:{textAlign:"center",padding:"40px 0"},children:[e.jsx(w,{size:"large"}),e.jsx("p",{style:{marginTop:16},children:"កំពុងបង្កើតរបាយការណ៍..."})]}),!a&&(!r||!r.contracts||r.contracts.length===0)&&e.jsxs(o,{style:{textAlign:"center",padding:"20px 0"},children:[e.jsx(M,{description:e.jsx(l,{style:{fontSize:"16px"},children:"មិនមានទិន្នន័យសម្រាប់ការជ្រើសរើសនេះ"}),image:e.jsx(V,{style:{fontSize:60,color:"#ccc"}})}),e.jsx(q,{dashed:!0}),e.jsx(l,{type:"secondary",children:"កំពុងផ្ទុកទិន្នន័យ..."})]}),!a&&r&&r.contracts&&r.contracts.length>0&&e.jsxs("div",{style:{backgroundColor:"#fff",marginBottom:"24px"},children:[e.jsxs(p,{gutter:16,style:{backgroundColor:"#fafafa",padding:"12px 16px",borderBottom:"1px solid #f0f0f0",marginBottom:"8px",fontWeight:"bold"},children:[e.jsx(s,{xs:24,sm:6,md:4,style:{display:"flex",alignItems:"center"},children:e.jsxs(i,{children:[e.jsx(D,{}),e.jsx(l,{children:"លេខកុងត្រា"})]})}),e.jsx(s,{xs:24,sm:6,md:4,style:{display:"flex",alignItems:"center"},children:e.jsxs(i,{children:[e.jsx(D,{}),e.jsx(l,{children:"លេខដី"})]})}),e.jsx(s,{xs:24,sm:4,md:4,style:{display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsxs(i,{children:[e.jsx(h,{}),e.jsx(l,{children:"ចំនួនសរុប"})]})}),e.jsx(s,{xs:24,sm:4,md:6,style:{display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsxs(i,{children:[e.jsx(h,{}),e.jsx(l,{children:"ចំនួនបានបង់"})]})}),e.jsx(s,{xs:24,sm:4,md:6,style:{display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsxs(i,{children:[e.jsx(h,{}),e.jsx(l,{children:"ចំនួនមិនទាន់បង់"})]})})]}),e.jsx(T,{itemLayout:"horizontal",dataSource:r.contracts,renderItem:t=>e.jsx(T.Item,{style:{background:"#fff",padding:"16px",marginBottom:"8px",borderBottom:"1px solid #f0f0f0"},children:e.jsxs(p,{gutter:16,style:{width:"100%"},children:[e.jsx(s,{xs:24,sm:6,md:4,style:{display:"flex",alignItems:"center"},children:e.jsx(P,{href:`/reports/document?contract_id=${t.contract_id}`,className:"text-blue-600 hover:text-blue-800 font-bold",children:t.contract_id})}),e.jsx(s,{xs:24,sm:6,md:4,style:{display:"flex",alignItems:"center"},children:Array.isArray(t.lands)&&t.lands.length>0?e.jsx(i,{direction:"vertical",size:"small",style:{width:"100%"},children:t.lands.map((c,f)=>e.jsx("span",{children:c.plot_number},f))}):t.land_plot_number?e.jsx("span",{children:t.land_plot_number}):e.jsx("span",{children:"-"})}),e.jsx(s,{xs:24,sm:4,md:4,style:{display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsx(l,{children:d(t.total_amount)})}),e.jsx(s,{xs:24,sm:4,md:6,style:{display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsx(l,{style:{color:"#52c41a"},children:d(t.paid_amount)})}),e.jsx(s,{xs:24,sm:4,md:6,style:{display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsx(l,{style:{color:"#f5222d"},children:d(t.unpaid_amount)})})]})})})]})]})]})};export{ve as default};
