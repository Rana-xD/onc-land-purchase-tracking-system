import{r as n,j as e,Q as Y,t as g,S as R,d as k}from"./app-D0OhDuOP.js";import{A as q}from"./AdminLayout-DfyZC7U7.js";import{F as w}from"./FileUpload-C1UEOMq6.js";import{d as S}from"./dayjs.min-Bgh6-5v4.js";import{F as a}from"./index-01QrSur2.js";import{C as h}from"./index-BXZQm44E.js";import{R as V}from"./FileAddOutlined-PNzBbgEh.js";import{R as u,C as o}from"./row-Cvvd4www.js";import{I as p}from"./index-DyIYvMCA.js";import{R as f}from"./index-HowiUfuo.js";import{D as $}from"./index-C98K_sL4.js";import{R as B}from"./UserOutlined-Bw1Yg3TV.js";import{B as M}from"./Breadcrumb-XIs-K6bQ.js";import{T}from"./index-DUD5X347.js";import{S as v}from"./index-DeYg2bFH.js";import{B as c}from"./index-XQ9uBlxv.js";import{R as L}from"./ArrowLeftOutlined-DaEIyD4l.js";import{S as A}from"./index-CpY42lHj.js";import{R as P}from"./ArrowRightOutlined-B6_dIG3C.js";import{R as Q}from"./SaveOutlined-D-cLyBdL.js";import{s as I}from"./index-VXrvBi_7.js";import"./index-BKPGZTnh.js";import"./EllipsisOutlined-BcUT9_x5.js";import"./PurePanel-BrlMViLC.js";import"./index-BoUcoXbW.js";import"./index-DxlGwFBo.js";import"./useClosable-rmjEiMr1.js";import"./CloseOutlined-CSg-7HVH.js";import"./pickAttrs-BMtZpb9Y.js";import"./extendsObject-78o_rR5W.js";import"./CheckOutlined-C-W3vkf9.js";import"./EyeOutlined-Bk9sN1n5.js";import"./CheckCircleOutlined-_P5yC29H.js";import"./index-DSx0c0nZ.js";import"./ExclamationCircleFilled-BuCwC-hN.js";import"./InfoCircleFilled-Csbq1HVY.js";import"./ActionButton-DPI_9ZHB.js";import"./Skeleton-BB1PfEPR.js";import"./index-BNYa27A7.js";import"./DeleteOutlined-C5fTVnAq.js";import"./FilePdfOutlined-BmX1d_m5.js";import"./FileImageOutlined-6X7nxdKY.js";import"./index-FPFFDuuk.js";import"./DownloadOutlined-BFocYQwA.js";import"./progress-CZwQN1Wi.js";import"./index-Bjcdw0HM.js";import"./UploadOutlined-qPHS_ZnN.js";import"./useVariants-VmmnPvRy.js";import"./getAllowClear-7r21EHJH.js";import"./Input-DIi4XD1o.js";import"./SearchOutlined-DdbS1Qlk.js";import"./EditOutlined-BQAB7wjt.js";import"./useBubbleLock-Dp5g0NxF.js";import"./CalendarOutlined-C5Gy31PM.js";import"./ClockCircleOutlined-BGruiaAm.js";import"./useIcons-De8HtjeC.js";import"./DownOutlined-BKT6hG3e.js";const{Title:G,Text:Oe}=T,{Step:U}=v;function z({buyer:t,documents:l}){const[j]=a.useForm(),[i,x]=n.useState(0),[_,b]=n.useState([]),[C,y]=n.useState(!1),[m,D]=n.useState({name:t.name,sex:t.sex,date_of_birth:t.date_of_birth,identity_number:t.identity_number,address:t.address,phone_number:t.phone_number});n.useEffect(()=>{if(l&&l.length>0){const r=l.map(s=>({uid:s.id,name:s.file_name,status:"done",url:`/storage/${s.file_path}`,isExisting:!0,id:s.id,isDisplay:s.is_display}));b(r)}},[l]);const d=[{title:"ឯកសារ",icon:e.jsx(V,{}),content:e.jsx(h,{title:"បញ្ចូលឯកសារ",className:"mb-6",children:e.jsx(w,{fileList:_,setFileList:b,maxFiles:2})})},{title:"ព័ត៌មានអ្នកទិញ",icon:e.jsx(B,{}),content:e.jsx(h,{title:"បញ្ចូលព័ត៌មានអ្នកទិញ",className:"mb-6",children:e.jsxs(a,{form:j,layout:"vertical",initialValues:{name:t.name,sex:t.sex,date_of_birth:t.date_of_birth?S(t.date_of_birth):null,identity_number:t.identity_number,address:t.address,phone_number:t.phone_number},onValuesChange:(r,s)=>{D({...m,...r})},children:[e.jsxs(u,{gutter:16,children:[e.jsx(o,{xs:24,md:12,children:e.jsx(a.Item,{label:"ឈ្មោះ",name:"name",rules:[{required:!0,message:"សូមបញ្ចូលឈ្មោះ"}],children:e.jsx(p,{placeholder:"បញ្ចូលឈ្មោះ"})})}),e.jsx(o,{xs:24,md:12,children:e.jsx(a.Item,{label:"ភេទ",name:"sex",rules:[{required:!0,message:"សូមជ្រើសរើសភេទ"}],children:e.jsxs(f.Group,{children:[e.jsx(f,{value:"male",children:"ប្រុស"}),e.jsx(f,{value:"female",children:"ស្រី"})]})})})]}),e.jsxs(u,{gutter:16,children:[e.jsx(o,{xs:24,md:12,children:e.jsx(a.Item,{label:"ថ្ងៃខែឆ្នាំកំណើត",name:"date_of_birth",rules:[{required:!0,message:"សូមបញ្ចូលថ្ងៃខែឆ្នាំកំណើត"}],children:e.jsx($,{style:{width:"100%"},format:"YYYY-MM-DD",placeholder:"ជ្រើសរើសថ្ងៃខែឆ្នាំកំណើត"})})}),e.jsx(o,{xs:24,md:12,children:e.jsx(a.Item,{label:"លេខអត្តសញ្ញាណប័ណ្ណ",name:"identity_number",rules:[{required:!0,message:"សូមបញ្ចូលលេខអត្តសញ្ញាណប័ណ្ណ"}],children:e.jsx(p,{placeholder:"បញ្ចូលលេខអត្តសញ្ញាណប័ណ្ណ"})})})]}),e.jsx(a.Item,{label:"អាសយដ្ឋាន",name:"address",rules:[{required:!0,message:"សូមបញ្ចូលអាសយដ្ឋាន"}],children:e.jsx(p.TextArea,{rows:3,placeholder:"បញ្ចូលអាសយដ្ឋាន"})}),e.jsx(a.Item,{label:"លេខទូរស័ព្ទ",name:"phone_number",rules:[{required:!0,message:"សូមបញ្ចូលលេខទូរស័ព្ទ"}],children:e.jsx(p,{placeholder:"បញ្ចូលលេខទូរស័ព្ទ"})})]})})}],F=async()=>{if(i===1)try{await j.validateFields(),x(i+1)}catch(r){console.error("Validation failed:",r)}else x(i+1)},N=()=>{x(i-1)},E=async()=>{try{y(!0);const r={...m,date_of_birth:m.date_of_birth instanceof S?m.date_of_birth.format("YYYY-MM-DD"):m.date_of_birth,documents:_.map(s=>({id:s.id,isExisting:s.isExisting||!1,tempPath:s.tempPath,fileName:s.name,isDisplay:s.isDisplay||!1}))};await k.put(`/api/buyers/${t.id}`,r),I.success("អ្នកទិញត្រូវបានកែប្រែដោយជោគជ័យ"),R.visit(route("data-entry.buyers.index"))}catch(r){console.error("Error updating buyer:",r),I.error("មានបញ្ហាក្នុងការកែប្រែអ្នកទិញ")}finally{y(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(Y,{title:"កែប្រែអ្នកទិញ"}),e.jsxs("div",{className:"buyer-edit",children:[e.jsx(M,{items:[{title:e.jsx(g,{href:route("data-entry.index"),children:"ជ្រើសរើសប្រភេទទិន្នន័យ"})},{title:e.jsx(g,{href:route("data-entry.buyers.index"),children:"បញ្ជីអ្នកទិញ"})},{title:"កែប្រែអ្នកទិញ"}],className:"mb-6"}),e.jsxs(h,{children:[e.jsx(G,{level:4,className:"khmer-heading mb-6",children:"កែប្រែអ្នកទិញ"}),e.jsx(v,{current:i,className:"mb-8",children:d.map(r=>e.jsx(U,{title:r.title,icon:r.icon},r.title))}),e.jsx("div",{className:"steps-content mb-6",children:d[i].content}),e.jsx("div",{className:"steps-action",children:e.jsxs(u,{justify:"space-between",children:[e.jsx(o,{children:i>0&&e.jsx(c,{icon:e.jsx(L,{}),onClick:N,children:"ត្រឡប់ក្រោយ"})}),e.jsx(o,{children:e.jsxs(A,{children:[e.jsx(c,{onClick:()=>R.visit(route("data-entry.buyers.index")),children:"បោះបង់"}),i<d.length-1&&e.jsx(c,{type:"primary",onClick:F,icon:e.jsx(P,{}),children:"បន្ទាប់"}),i===d.length-1&&e.jsx(c,{type:"primary",onClick:E,loading:C,icon:e.jsx(Q,{}),children:"រក្សាទុក"})]})})]})})]})]})]})}z.layout=t=>e.jsx(q,{title:"កែប្រែអ្នកទិញ",children:t});export{z as default};
