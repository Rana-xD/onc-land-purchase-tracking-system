import{r as y,j as r,Q as O,t as W,B as q,a as K,s as L}from"./app-mk9C7I_N.js";import{A as G,R as J,a as h,b as D}from"./AdminLayout-CSpn-5iP.js";import{C as c,T as U}from"./index-DZTYDYFc.js";import{B as g}from"./Breadcrumb-Ceo11VVb.js";import{T as V}from"./index-DDFZ7dy0.js";import{I as X}from"./index-BiMKBPmP.js";import{R as Y}from"./SearchOutlined-jGh7iI3q.js";import{R as Z,C as j}from"./row-CPFUowx7.js";import{S as f}from"./index-DFUblwpt.js";import{R as B}from"./DollarOutlined-Db7zyGBC.js";import{S as d}from"./index-CYzbL2Oe.js";import{F as u}from"./Table-CR7r1NXs.js";import{R as ee,a as re}from"./RollbackOutlined-Cphx8t5g.js";import{T as ne}from"./index-DUw4RcKT.js";import{P as ae}from"./index-D2FKLp4I.js";import"./UserOutlined-Do6ZzMFA.js";import"./index-D66KGu5D.js";import"./index-phC_QXgK.js";import"./EllipsisOutlined-DwAdn_jY.js";import"./PurePanel-Bwrv9FGC.js";import"./index-pKRxIKW4.js";import"./InboxOutlined-CDGQXwno.js";import"./useVariants-BUy45nvZ.js";import"./DownOutlined-CUiMnNSy.js";import"./EditOutlined-CkdCVUZ6.js";import"./getAllowClear-BGHWSs2V.js";import"./CheckOutlined-CeCjh9xi.js";import"./Input-DUxd1TpC.js";import"./EyeOutlined-CQ17cMyg.js";import"./addEventListener-KCP_u9m-.js";import"./index-CHP0fo2g.js";import"./useIcons-CunuZG3Y.js";import"./index-Bl_0AmJC.js";import"./Pagination-DbG4IO0G.js";import"./FileOutlined-BPRx6OYG.js";import"./FolderOutlined-C4h6UTTq.js";const{Title:oe}=V,{Search:te}=X;function Qe({auth:A,statistics:a,archived:E}){var $,b,v,C,I,N,R,k;const[l,S]=y.useState(!1),[o,F]=y.useState(E||{}),[w,_]=y.useState(""),[M,P]=y.useState("1"),Q=async(e,n)=>{try{S(!0),await K.post("/archive/restore",{type:e,id:n}),L.success("ទិន្នន័យត្រូវបានស្តារដោយជោគជ័យ");const t=await K.get("/archive/type/"+e);F(i=>({...i,[e]:t.data}))}catch(t){console.error("Error restoring:",t),L.error("មានបញ្ហាក្នុងការស្តារទិន្នន័យ")}finally{S(!1)}},s=e=>{switch(e){case"1":return[...(o.buyers||[]).map(n=>({...n,type:"buyers",typeName:"អ្នកទិញ"})),...(o.sellers||[]).map(n=>({...n,type:"sellers",typeName:"អ្នកលក់"})),...(o.lands||[]).map(n=>({...n,type:"lands",typeName:"ដី"}))];case"2":return[...(o.document_creations||[]).map(n=>({...n,type:"document_creations",typeName:"ឯកសារបង្កើត"})),...(o.sale_contracts||[]).map(n=>({...n,type:"sale_contracts",typeName:"កិច្ចសន្យាលក់"}))];case"3":return(o.commissions||[]).map(n=>({...n,type:"commissions",typeName:"កុំស្យុង"}));case"4":return[...(o.users||[]).map(n=>({...n,type:"users",typeName:"អ្នកប្រើប្រាស់"})),...(o.roles||[]).map(n=>({...n,type:"roles",typeName:"តួនាទី"}))];case"5":return Object.entries(o).flatMap(([n,t])=>{const i={buyers:"អ្នកទិញ",sellers:"អ្នកលក់",lands:"ដី",document_creations:"ឯកសារបង្កើត",sale_contracts:"កិច្ចសន្យាលក់",commissions:"កុំស្យុង",users:"អ្នកប្រើប្រាស់",roles:"តួនាទី"};return t.map(x=>({...x,type:n,typeName:i[n]||n}))});default:return[]}},H=e=>e?new Date(e).toLocaleDateString("km-KH",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"គ្មាន",T=e=>e.name?e.name:e.title?e.title:e.land_title_number?`ដីលេខ: ${e.land_title_number}`:e.contract_number?`កិច្ចសន្យាលេខ: ${e.contract_number}`:e.commission_type?`កុំស្យុង ${e.commission_type}`:`#${e.id}`,m=e=>w?e.filter(n=>{var z;const t=T(n).toLowerCase(),i=(((z=n.deleted_by)==null?void 0:z.name)||"").toLowerCase(),x=w.toLowerCase();return t.includes(x)||i.includes(x)}):e,p=[{title:"ប្រភេទ",dataIndex:"typeName",key:"typeName",render:e=>r.jsx(ne,{color:"blue",children:e})},{title:"ឈ្មោះ/លេខសម្គាល់",dataIndex:"name",key:"name",render:(e,n)=>T(n)},{title:"កាលបរិច្ឆេទលុប",dataIndex:"deleted_at",key:"deleted_at",render:e=>H(e)},{title:"លុបដោយ",dataIndex:"deleted_by",key:"deleted_by",render:e=>(e==null?void 0:e.name)||"មិនស្គាល់"},{title:"សកម្មភាព",key:"action",render:(e,n)=>r.jsx(ae,{title:"បញ្ជាក់ការស្តារ",description:"តើអ្នកពិតជាចង់ស្តារទិន្នន័យនេះមែនទេ?",onConfirm:()=>Q(n.type,n.id),okText:"យល់ព្រម",cancelText:"បោះបង់",children:r.jsx(q,{type:"primary",icon:r.jsx(re,{}),size:"small",loading:l,children:"ស្តារឡើងវិញ"})})}];return r.jsxs(G,{user:A.user,children:[r.jsx(O,{title:"ទិន្នន័យ"}),r.jsx("div",{style:{padding:"24px"},children:r.jsxs(c,{children:[r.jsxs(g,{style:{marginBottom:16},children:[r.jsx(g.Item,{children:r.jsxs(W,{href:"/",children:[r.jsx(J,{})," ទំព័រដើម"]})}),r.jsx(g.Item,{children:"ទិន្នន័យ"})]}),r.jsxs("div",{style:{marginBottom:24},children:[r.jsx(oe,{level:3,children:"ទិន្នន័យ"}),r.jsx(te,{placeholder:"ស្វែងរក...",allowClear:!0,enterButton:r.jsx(Y,{}),size:"large",onSearch:e=>_(e),onChange:e=>_(e.target.value),style:{maxWidth:400}})]}),r.jsxs(Z,{gutter:16,style:{marginBottom:24},children:[r.jsx(j,{xs:24,sm:12,md:6,children:r.jsx(c,{children:r.jsx(f,{title:"ទិន្នន័យបញ្ចូល",value:((($=a==null?void 0:a.data_entry)==null?void 0:$.buyers)||0)+(((b=a==null?void 0:a.data_entry)==null?void 0:b.sellers)||0)+(((v=a==null?void 0:a.data_entry)==null?void 0:v.lands)||0),prefix:r.jsx(h,{}),valueStyle:{color:"#1890ff"}})})}),r.jsx(j,{xs:24,sm:12,md:6,children:r.jsx(c,{children:r.jsx(f,{title:"កិច្ចសន្យា",value:(((C=a==null?void 0:a.contracts)==null?void 0:C.document_creations)||0)+(((I=a==null?void 0:a.contracts)==null?void 0:I.sale_contracts)||0),prefix:r.jsx(h,{}),valueStyle:{color:"#52c41a"}})})}),r.jsx(j,{xs:24,sm:12,md:6,children:r.jsx(c,{children:r.jsx(f,{title:"កុំស្យុង",value:((N=a==null?void 0:a.commissions)==null?void 0:N.total)||0,prefix:r.jsx(B,{}),valueStyle:{color:"#faad14"}})})}),r.jsx(j,{xs:24,sm:12,md:6,children:r.jsx(c,{children:r.jsx(f,{title:"អ្នកប្រើប្រាស់",value:(((R=a==null?void 0:a.users)==null?void 0:R.users)||0)+(((k=a==null?void 0:a.users)==null?void 0:k.roles)||0),prefix:r.jsx(D,{}),valueStyle:{color:"#722ed1"}})})})]}),r.jsx(U,{activeKey:M,onChange:P,items:[{key:"1",label:r.jsxs("span",{children:[r.jsx(h,{}),"ទិន្នន័យបញ្ចូល"]}),children:r.jsx(d,{spinning:l,children:r.jsx(u,{columns:p,dataSource:m(s("1")),rowKey:e=>`${e.type}-${e.id}`,pagination:{pageSize:10,showSizeChanger:!0,showTotal:e=>`សរុប ${e} ទិន្នន័យ`},locale:{emptyText:"មិនមានទិន្នន័យក្នុងទិន្នន័យ"}})})},{key:"2",label:r.jsxs("span",{children:[r.jsx(h,{}),"កិច្ចសន្យា"]}),children:r.jsx(d,{spinning:l,children:r.jsx(u,{columns:p,dataSource:m(s("2")),rowKey:e=>`${e.type}-${e.id}`,pagination:{pageSize:10,showSizeChanger:!0,showTotal:e=>`សរុប ${e} ទិន្នន័យ`},locale:{emptyText:"មិនមានទិន្នន័យក្នុងទិន្នន័យ"}})})},{key:"3",label:r.jsxs("span",{children:[r.jsx(B,{}),"កុំស្យុង"]}),children:r.jsx(d,{spinning:l,children:r.jsx(u,{columns:p,dataSource:m(s("3")),rowKey:e=>`${e.type}-${e.id}`,pagination:{pageSize:10,showSizeChanger:!0,showTotal:e=>`សរុប ${e} ទិន្នន័យ`},locale:{emptyText:"មិនមានទិន្នន័យក្នុងទិន្នន័យ"}})})},{key:"4",label:r.jsxs("span",{children:[r.jsx(D,{}),"អ្នកប្រើប្រាស់"]}),children:r.jsx(d,{spinning:l,children:r.jsx(u,{columns:p,dataSource:m(s("4")),rowKey:e=>`${e.type}-${e.id}`,pagination:{pageSize:10,showSizeChanger:!0,showTotal:e=>`សរុប ${e} ទិន្នន័យ`},locale:{emptyText:"មិនមានទិន្នន័យក្នុងទិន្នន័យ"}})})},{key:"5",label:r.jsxs("span",{children:[r.jsx(ee,{}),"ទាំងអស់"]}),children:r.jsx(d,{spinning:l,children:r.jsx(u,{columns:p,dataSource:m(s("5")),rowKey:e=>`${e.type}-${e.id}`,pagination:{pageSize:10,showSizeChanger:!0,showTotal:e=>`សរុប ${e} ទិន្នន័យ`},locale:{emptyText:"មិនមានទិន្នន័យក្នុងទិន្នន័យ"}})})}]})]})})]})}export{Qe as default};
