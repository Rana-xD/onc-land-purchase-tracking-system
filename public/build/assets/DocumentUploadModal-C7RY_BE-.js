import{r as x,R as F,j as r,B as R,s as t,a as P}from"./app-Cq9T9vxM.js";import{F as u}from"./index-UraXu45p.js";import{M as T}from"./index-eUbAuevc.js";import{S as U}from"./index-C_zCuArI.js";import{U as h}from"./index-Ut4Nl-5k.js";import{R as B}from"./InboxOutlined-ZSWvT0kT.js";import"./index-DPFVXnL-.js";import"./row-CJ-aj50t.js";import"./PurePanel-Ce8hDmce.js";import"./DeleteOutlined-j2tGMUPF.js";import"./DownloadOutlined-C0uSoOge.js";import"./EyeOutlined-CFXJhbVH.js";import"./progress-CdXVhW7a.js";import"./CheckOutlined-_L7buK6x.js";const{Dragger:D}=h;function X({visible:d,onCancel:g,saleContract:s,onSuccess:M}){const[f]=u.useForm(),[p,m]=x.useState([]),[j,y]=x.useState(!1);F.useEffect(()=>{console.log("DocumentUploadModal - saleContract prop:",s)},[s]),F.useEffect(()=>{d&&(f.resetFields(),m([]))},[d,s,f]);const b=o=>new Promise((a,i)=>{const e=new FileReader;e.readAsDataURL(o),e.onload=()=>a(e.result),e.onerror=n=>i(n)}),E=async()=>{var o,a;try{if(!s||!s.contract_id){t.error("ត្រូវការកិច្ចសន្យាលក់ទិញដើម្បីផ្ទុកកិច្ចសន្យា");return}if(p.length===0){t.error("សូមជ្រើសរើសកិច្ចសន្យាមួយដើម្បីផ្ទុក");return}y(!0);const i=p[0],e=i.originFileObj||i;console.log("File object:",e),console.log("File type:",e.type),console.log("File size:",e.size);const n=await b(e);console.log("File converted to base64");const l=`/api/reports/contract-documents/${s.contract_id}/upload`;await P.post(l,{file:n,file_name:e.name,file_type:e.type,file_size:e.size},{headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Accept:"application/json"}}),t.success("ផ្ទុកកិច្ចសន្យាជោគជ័យ"),M()}catch(i){console.error("បញ្ហាក្នុងការផ្ទុកកិច្ចសន្យា:",i);const e=(a=(o=i.response)==null?void 0:o.data)==null?void 0:a.error;if(typeof e=="string")t.error(e);else if(e&&typeof e=="object"){const n=[];Object.keys(e).forEach(l=>{const c=e[l];Array.isArray(c)?n.push(`${l}: ${c.join(", ")}`):typeof c=="string"&&n.push(`${l}: ${c}`)}),n.length>0?t.error(n.join(`
`)):t.error("មិនអាចផ្ទុកកិច្ចសន្យាបាន")}else t.error("មិនអាចផ្ទុកកិច្ចសន្យាបាន")}finally{y(!1)}},L={onRemove:o=>{m([])},beforeUpload:o=>o.type==="application/pdf"||o.type==="image/jpeg"||o.type==="image/png"?o.size/1024/1024<10?(m([o]),!1):(t.error("កិច្ចសន្យាត្រូវតែមានទំហំតូចជាង 10MB!"),h.LIST_IGNORE):(t.error("អ្នកអាចផ្ទុកបានតែកិច្ចសន្យាប្រភេទ PDF, JPG, រឹ PNG ប៉ុណ្ណោះ!"),h.LIST_IGNORE),fileList:p};return r.jsx(T,{title:s?`ផ្ទុកកិច្ចសន្យាសម្រាប់កិច្ចសន្យាលក់ទិញ ${s.title||""}`:"ផ្ទុកកិច្ចសន្យាទូទៅ",open:d,onCancel:g,footer:[r.jsx(R,{onClick:g,children:"បោះបង់"},"cancel"),r.jsx(R,{type:"primary",onClick:E,loading:j,disabled:p.length===0,children:"ផ្ទុកកិច្ចសន្យា"},"upload")],children:r.jsx(U,{spinning:j,children:r.jsx(u,{form:f,layout:"vertical",children:r.jsx(u.Item,{label:"កិច្ចសន្យា",children:r.jsxs(D,{...L,children:[r.jsx("p",{className:"ant-upload-drag-icon",children:r.jsx(B,{})}),r.jsx("p",{className:"ant-upload-text",children:"ចុចហើយអូសកិច្ចសន្យាទៅកាន់តំបន់នេះដើម្បីផ្ទុក"}),r.jsx("p",{className:"ant-upload-hint",children:"គាំទ្រប្រភេទ PDF, JPG, PNG។ ទំហំអតិបរមា: 10MB"})]})})})})})}export{X as default};
