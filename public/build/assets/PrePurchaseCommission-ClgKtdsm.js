import{r as i,j as e,Q as L,B as l,e as f,s as o}from"./app-BBTICp4j.js";import{A as N}from"./AdminLayout-DxDDGS0e.js";import{F as m}from"./index-C68SiXGT.js";import{T as H}from"./index-Cfh7qGRB.js";import{C as J,R as O}from"./index-B2wIyAm9.js";import{R as U,C as b}from"./row-Dtoexlvv.js";import{I as T}from"./index-COa_6DPI.js";import{R as G}from"./SearchOutlined-DJlkhe1H.js";import{T as g}from"./index-C5oWf6N6.js";import{F as W}from"./Table-BNh4n8r6.js";import{M as X}from"./index-DSSNgvuj.js";import{T as Y}from"./index-QB1dCeWk.js";import{S as F}from"./index-BLi1CBmm.js";import{B as Z}from"./index-DqwI38n1.js";import{R as ee}from"./EditOutlined-DhdXE3k2.js";import{P as R}from"./index-B5Vkae57.js";import{R as te}from"./DeleteOutlined--CfOCEP9.js";import{R as se}from"./CheckCircleOutlined-ThKSjgvJ.js";import"./UserOutlined-B9ZAOThG.js";import"./index-D88NIlOR.js";import"./EllipsisOutlined-Bhf9hnSZ.js";import"./PurePanel-DnHFRN3c.js";import"./getAllowClear-DLCbMek5.js";import"./CheckOutlined-DMU6mItx.js";import"./useVariants-Bsn3ZCEZ.js";import"./Input-BDTvmsS1.js";import"./EyeOutlined-Dift8YHl.js";import"./addEventListener-ungWzbhy.js";import"./index-mLV1oJws.js";import"./useIcons-DLppMF82.js";import"./DownOutlined-CIxjOa2g.js";import"./index-BTHh_Gpg.js";import"./useBubbleLock-ClpRCOWH.js";import"./index-AFDIk0Sd.js";import"./Pagination-CRn34H2T.js";import"./index-CcJgjeQ-.js";import"./FileOutlined-Bkjwbk_U.js";import"./FolderOutlined-BtKR_-vO.js";const{Title:re,Text:_}=H,{TextArea:ae}=T;function Le(){const[$,B]=i.useState([]),[M,w]=i.useState(!1),[z,j]=i.useState(!1),[u,y]=i.useState(null),[n]=m.useForm(),[h,A]=i.useState(""),[x,P]=i.useState({current:1,pageSize:15,total:0}),E=t=>new Intl.NumberFormat("km-KH",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(t||0),c=async(t=1,s="")=>{w(!0);try{const r=await f.get("/commissions/api/pre-purchase",{params:{page:t,search:s}});r.data.commissions&&(B(r.data.commissions),P({current:r.data.pagination.current_page,pageSize:r.data.pagination.per_page,total:r.data.pagination.total}))}catch{o.error("មានបញ្ហាក្នុងការទាញយកទិន្នន័យ")}finally{w(!1)}};i.useEffect(()=>{c()},[]);const v=t=>{A(t),c(1,t)},D=t=>{c(t.current,h)},S=(t=null)=>{y(t),j(!0),t?n.setFieldsValue({recipient_name:t.recipient_name,total_amount:t.total_amount,description:t.description}):n.resetFields()},k=()=>{j(!1),y(null),n.resetFields()},Q=async t=>{var s,r,a,I;try{const p=u?`/commissions/api/pre-purchase/${u.id}`:"/commissions/api/pre-purchase",d=await f[u?"put":"post"](p,t);d.data.success&&(o.success(d.data.message),j(!1),y(null),n.resetFields(),c(x.current,h))}catch(p){if((r=(s=p.response)==null?void 0:s.data)!=null&&r.errors){const C=p.response.data.errors;Object.keys(C).forEach(d=>{n.setFields([{name:d,errors:C[d]}])})}else o.error(((I=(a=p.response)==null?void 0:a.data)==null?void 0:I.message)||"មានបញ្ហាក្នុងការរក្សាទុក")}},V=async t=>{var s,r;try{const a=await f.delete(`/commissions/api/pre-purchase/${t}`);a.data.success&&(o.success(a.data.message),c(x.current,h))}catch(a){o.error(((r=(s=a.response)==null?void 0:s.data)==null?void 0:r.message)||"មានបញ្ហាក្នុងការលុប")}},q=async t=>{var s,r;try{const a=await f.patch(`/commissions/api/pre-purchase/${t}/mark-paid`);a.data.success&&(o.success(a.data.message),c(x.current,h))}catch(a){o.error(((r=(s=a.response)==null?void 0:s.data)==null?void 0:r.message)||"មានបញ្ហាក្នុងការបញ្ជាក់ការទូទាត់")}},K=[{title:"ឈ្មោះអ្នកទទួល",dataIndex:"recipient_name",key:"recipient_name",render:t=>e.jsx(_,{strong:!0,children:t})},{title:"ចំនួនទឹកប្រាក់",dataIndex:"total_amount",key:"total_amount",align:"right",render:t=>e.jsx(_,{strong:!0,children:E(t)})},{title:"ការពិពណ៌នា",dataIndex:"description",key:"description",render:t=>t||"-"},{title:"ស្ថានភាព",dataIndex:"status",key:"status",align:"center",render:t=>e.jsx(Z,{status:t==="paid"?"success":"warning",text:t==="paid"?"បានបង់ហើយ":"មិនទាន់បង់"})},{title:"សកម្មភាព",key:"actions",align:"center",render:(t,s)=>e.jsxs(F,{children:[e.jsx(g,{title:"កែប្រែកម៉ីសិន",children:e.jsx(l,{type:"link",icon:e.jsx(ee,{}),onClick:()=>S(s),size:"small"})}),e.jsx(R,{title:"តើអ្នកពិតជាចង់លុបមែនទេ?",onConfirm:()=>V(s.id),okText:"យល់ព្រម",cancelText:"បោះបង់",children:e.jsx(g,{title:"លុបកម៉ីសិន",children:e.jsx(l,{type:"link",danger:!0,icon:e.jsx(te,{}),size:"small"})})}),s.status==="pending"&&e.jsx(R,{title:"តើអ្នកពិតជាចង់បញ្ជាក់ការទូទាត់មែនទេ?",onConfirm:()=>q(s.id),okText:"យល់ព្រម",cancelText:"បោះបង់",children:e.jsx(g,{title:"បញ្ជាក់ការទូទាត់",children:e.jsx(l,{type:"link",icon:e.jsx(se,{}),size:"small",style:{color:"#52c41a"}})})})]})}];return e.jsxs(N,{children:[e.jsx(L,{title:"កម៉ីសិនមុនទិញ"}),e.jsxs("div",{style:{padding:"24px"},children:[e.jsx("div",{style:{marginBottom:"24px",textAlign:"center"},children:e.jsx(re,{level:2,style:{margin:0},children:"កម៉ីសិនមុនទិញ"})}),e.jsxs(J,{children:[e.jsxs(U,{justify:"space-between",align:"middle",style:{marginBottom:"16px"},children:[e.jsx(b,{children:e.jsx(T.Search,{placeholder:"ស្វែងរកតាមឈ្មោះ...",allowClear:!0,onSearch:v,style:{width:300},prefix:e.jsx(G,{})})}),e.jsx(b,{children:e.jsx(g,{title:"បន្ថែមកម៉ីសិនមុនទិញថ្មី",children:e.jsx(l,{type:"primary",icon:e.jsx(O,{}),onClick:()=>S(),children:"បន្ថែមថ្មី"})})})]}),e.jsx(W,{columns:K,dataSource:$,rowKey:"id",loading:M,pagination:{...x,showSizeChanger:!1,showQuickJumper:!0,showTotal:(t,s)=>`${s[0]}-${s[1]} នៃ ${t} ធាតុ`},onChange:D,locale:{emptyText:"មិនមានទិន្នន័យ"}})]}),e.jsx(X,{title:u?"កែប្រែកម៉ីសិនមុនទិញ":"បន្ថែមកម៉ីសិនមុនទិញ",open:z,onCancel:k,footer:null,width:600,children:e.jsxs(m,{form:n,layout:"vertical",onFinish:Q,children:[e.jsx(m.Item,{name:"recipient_name",label:"ឈ្មោះអ្នកទទួល",rules:[{required:!0,message:"សូមបញ្ចូលឈ្មោះអ្នកទទួល"}],children:e.jsx(T,{placeholder:"បញ្ចូលឈ្មោះអ្នកទទួល"})}),e.jsx(m.Item,{name:"total_amount",label:"ចំនួនទឹកប្រាក់",rules:[{required:!0,message:"សូមបញ្ចូលចំនួនទឹកប្រាក់"},{type:"number",min:.01,message:"ចំនួនទឹកប្រាក់ត្រូវតែធំជាង 0"}],children:e.jsx(Y,{placeholder:"បញ្ចូលចំនួនទឹកប្រាក់",style:{width:"100%"},formatter:t=>`$ ${t}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:t=>t.replace(/\$\s?|(,*)/g,""),precision:2})}),e.jsx(m.Item,{name:"description",label:"ការពិពណ៌នា",children:e.jsx(ae,{placeholder:"បញ្ចូលការពិពណ៌នា (ស្រេចចិត្ត)",rows:4})}),e.jsx(m.Item,{style:{marginBottom:0,textAlign:"right"},children:e.jsxs(F,{children:[e.jsx(l,{onClick:k,children:"បោះបង់"}),e.jsx(l,{type:"primary",htmlType:"submit",children:"រក្សាទុក"})]})})]})})]})]})}export{Le as default};
