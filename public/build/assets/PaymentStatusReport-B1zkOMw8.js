import{r as n,e as $,s as m,j as e,Q as z,B as w,t as P}from"./app-BBTICp4j.js";import{A as U}from"./AdminLayout-DxDDGS0e.js";import{C as o}from"./index-B2wIyAm9.js";import{R as p,C as s}from"./row-Dtoexlvv.js";import{T as N}from"./index-Cfh7qGRB.js";import{S as v}from"./index-CcJgjeQ-.js";import{A as O}from"./index-DW0SOg5n.js";import{S as a}from"./index-BLi1CBmm.js";import{T as A}from"./index-C5oWf6N6.js";import{R as Q}from"./FilePdfOutlined-BnRZPQ4O.js";import{R as W}from"./FileExcelOutlined-CjheT0Db.js";import{E as M}from"./index-mLV1oJws.js";import{R as V}from"./FolderOutlined-BtKR_-vO.js";import{D as q}from"./index-dnjbR_wK.js";import{R as D}from"./FileOutlined-Bkjwbk_U.js";import{R as h}from"./DollarOutlined-DHlflz1y.js";import{L as T}from"./index-DO4ih9Lk.js";import"./UserOutlined-B9ZAOThG.js";import"./index-D88NIlOR.js";import"./EllipsisOutlined-Bhf9hnSZ.js";import"./PurePanel-DnHFRN3c.js";import"./useVariants-Bsn3ZCEZ.js";import"./EditOutlined-DhdXE3k2.js";import"./getAllowClear-DLCbMek5.js";import"./CheckOutlined-DMU6mItx.js";import"./useIcons-DLppMF82.js";import"./DownOutlined-CIxjOa2g.js";import"./SearchOutlined-DJlkhe1H.js";import"./Pagination-CRn34H2T.js";const{Title:G,Text:l}=N,j={padding:"16px",borderRadius:"2px",boxShadow:"0 1px 2px rgba(0,0,0,0.05)",height:"100%"},u={fontSize:"24px",fontWeight:"bold",marginTop:"8px",display:"block"},g={fontSize:"14px",color:"rgba(0, 0, 0, 0.45)",marginBottom:"4px"},Ie=({auth:F})=>{const[i,b]=n.useState(!1),[C,S]=n.useState(!1),[I,R]=n.useState(null),[r,_]=n.useState(null),[B,y]=n.useState(null),d=t=>t==null?"$0.00":"$"+new Intl.NumberFormat("en-US").format(t),k=n.useCallback(async()=>{b(!0),y(null),_(null);try{const t=await $.post("/reports/payment-status/data");_(t.data)}catch(t){console.error("Error fetching payment status report data:",t),y(t.response&&t.response.data&&t.response.data.error?t.response.data.error:"Failed to fetch report data"),m.error("Failed to load payment status data. Please refresh the page.")}finally{b(!1)}},[]);n.useEffect(()=>{k()},[k]);const E=n.useCallback(async t=>{S(!0),R(t),m.loading(`Preparing ${t.toUpperCase()} export...`);try{const c=await $.post("/reports/payment-status/export",{format:t},{responseType:"blob"}),f=new Blob([c.data],{type:t==="pdf"?"application/pdf":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),L=window.URL.createObjectURL(f),x=document.createElement("a");x.href=L,x.setAttribute("download",`payment_status_report_${new Date().toISOString().split("T")[0]}.${t==="excel"?"xlsx":t}`),document.body.appendChild(x),x.click(),x.remove(),m.success(`${t.toUpperCase()} exported successfully!`)}catch(c){console.error(`Error exporting ${t}:`,c),y(`Failed to export report as ${t}`),m.error(`Failed to export ${t.toUpperCase()}. Please try again.`)}finally{S(!1),R(null)}},[]);return e.jsxs(U,{user:F.user,children:[e.jsx(z,{title:"របាយការណ៍ប្រាក់បានបង់/មិនទាន់បង់"}),e.jsxs("div",{style:{padding:"24px"},children:[e.jsx(o,{style:{marginBottom:"24px"},children:e.jsxs(p,{gutter:16,align:"middle",children:[e.jsx(s,{xs:24,sm:12,children:e.jsx(G,{level:4,style:{margin:0},children:"របាយការណ៍ប្រាក់បានបង់/មិនទាន់បង់"})}),e.jsx(s,{xs:24,sm:12,style:{textAlign:"right"},children:i&&e.jsx(v,{})})]})}),B&&e.jsx(O,{message:"Error",description:B,type:"error",showIcon:!0,style:{marginBottom:"24px"}}),!i&&r&&r.contracts&&r.contracts.length>0&&e.jsxs(p,{gutter:16,style:{marginBottom:"24px"},children:[e.jsx(s,{xs:24,sm:8,style:{marginBottom:"16px"},children:e.jsx(o,{style:{...j,backgroundColor:"#e6f7ff"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{style:g,children:"ចំនួនសរុបទាំងអស់"}),e.jsx("span",{style:{...u},children:d(r.summary.total_amount)})]})})}),e.jsx(s,{xs:24,sm:8,style:{marginBottom:"16px"},children:e.jsx(o,{style:{...j,backgroundColor:"#f6ffed"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{style:g,children:"ចំនួនបានបង់"}),e.jsx("span",{style:{...u,color:"#52c41a"},children:d(r.summary.total_paid)})]})})}),e.jsx(s,{xs:24,sm:8,style:{marginBottom:"16px"},children:e.jsx(o,{style:{...j,backgroundColor:"#fff1f0"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{style:g,children:"ចំនួនមិនទាន់បង់"}),e.jsx("span",{style:{...u,color:"#f5222d"},children:d(r.summary.total_unpaid)})]})})})]}),!i&&r&&r.contracts&&r.contracts.length>0&&e.jsx(o,{style:{marginBottom:"24px"},children:e.jsxs(p,{gutter:16,align:"middle",children:[e.jsx(s,{xs:24,sm:12,children:e.jsx(l,{children:"ទិន្នន័យរបាយការណ៍"})}),e.jsx(s,{xs:24,sm:12,style:{textAlign:"right"},children:e.jsxs(a,{children:[e.jsx(A,{title:"នាំចេញរបាយការណ៍ជាឯកសារ PDF",children:e.jsx(w,{type:"primary",style:{backgroundColor:"#ff4d4f"},icon:e.jsx(Q,{}),onClick:()=>E("pdf"),loading:C&&I==="pdf",children:"PDF"})}),e.jsx(A,{title:"នាំចេញរបាយការណ៍ជាឯកសារ Excel",children:e.jsx(w,{type:"primary",style:{backgroundColor:"#52c41a"},icon:e.jsx(W,{}),onClick:()=>E("excel"),loading:C&&I==="excel",children:"Excel"})})]})})]})}),i&&e.jsxs(o,{style:{textAlign:"center",padding:"40px 0"},children:[e.jsx(v,{size:"large"}),e.jsx("p",{style:{marginTop:16},children:"កំពុងបង្កើតរបាយការណ៍..."})]}),!i&&(!r||!r.contracts||r.contracts.length===0)&&e.jsxs(o,{style:{textAlign:"center",padding:"20px 0"},children:[e.jsx(M,{description:e.jsx(l,{style:{fontSize:"16px"},children:"មិនមានទិន្នន័យសម្រាប់ការជ្រើសរើសនេះ"}),image:e.jsx(V,{style:{fontSize:60,color:"#ccc"}})}),e.jsx(q,{dashed:!0}),e.jsx(l,{type:"secondary",children:"កំពុងផ្ទុកទិន្នន័យ..."})]}),!i&&r&&r.contracts&&r.contracts.length>0&&e.jsxs("div",{style:{backgroundColor:"#fff",marginBottom:"24px"},children:[e.jsxs(p,{gutter:16,style:{backgroundColor:"#fafafa",padding:"12px 16px",borderBottom:"1px solid #f0f0f0",marginBottom:"8px",fontWeight:"bold"},children:[e.jsx(s,{xs:24,sm:6,md:4,style:{display:"flex",alignItems:"center"},children:e.jsxs(a,{children:[e.jsx(D,{}),e.jsx(l,{children:"លេខកុងត្រា"})]})}),e.jsx(s,{xs:24,sm:6,md:4,style:{display:"flex",alignItems:"center"},children:e.jsxs(a,{children:[e.jsx(D,{}),e.jsx(l,{children:"លេខដី"})]})}),e.jsx(s,{xs:24,sm:4,md:4,style:{display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsxs(a,{children:[e.jsx(h,{}),e.jsx(l,{children:"ចំនួនសរុប"})]})}),e.jsx(s,{xs:24,sm:4,md:6,style:{display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsxs(a,{children:[e.jsx(h,{}),e.jsx(l,{children:"ចំនួនបានបង់"})]})}),e.jsx(s,{xs:24,sm:4,md:6,style:{display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsxs(a,{children:[e.jsx(h,{}),e.jsx(l,{children:"ចំនួនមិនទាន់បង់"})]})})]}),e.jsx(T,{itemLayout:"horizontal",dataSource:r.contracts,renderItem:t=>e.jsx(T.Item,{style:{background:"#fff",padding:"16px",marginBottom:"8px",borderBottom:"1px solid #f0f0f0"},children:e.jsxs(p,{gutter:16,style:{width:"100%"},children:[e.jsx(s,{xs:24,sm:6,md:4,style:{display:"flex",alignItems:"center"},children:e.jsx(P,{href:`/reports/document?contract_id=${t.contract_id}`,className:"text-blue-600 hover:text-blue-800 font-bold",children:t.contract_id})}),e.jsx(s,{xs:24,sm:6,md:4,style:{display:"flex",alignItems:"center"},children:Array.isArray(t.lands)&&t.lands.length>0?e.jsx(a,{direction:"vertical",size:"small",style:{width:"100%"},children:t.lands.map((c,f)=>e.jsx("span",{children:c.plot_number},f))}):t.land_plot_number?e.jsx("span",{children:t.land_plot_number}):e.jsx("span",{children:"-"})}),e.jsx(s,{xs:24,sm:4,md:4,style:{display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsx(l,{children:d(t.total_amount)})}),e.jsx(s,{xs:24,sm:4,md:6,style:{display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsx(l,{style:{color:"#52c41a"},children:d(t.paid_amount)})}),e.jsx(s,{xs:24,sm:4,md:6,style:{display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsx(l,{style:{color:"#f5222d"},children:d(t.unpaid_amount)})})]})})})]})]})]})};export{Ie as default};
