import{r as g,j as e,Q as v,B as j,a as R,s as c,h as z}from"./app-C81v863Z.js";import{R as J,A as k}from"./AdminLayout-4hWCCW4J.js";import{F}from"./FileUpload-4FXsKutC.js";import{d as Y}from"./dayjs.min-C1_8woz9.js";import{C as x}from"./index-Cq5Cojs-.js";import{F as p}from"./index-C0G5YYq6.js";import{I as b}from"./index-CfwryaAm.js";import{D as T}from"./index-5Q1J_MEE.js";import{R as C,C as B}from"./row-DVautw-w.js";import{T as U}from"./index-DIyycjnG.js";import{I as K}from"./index-B2LGBo3K.js";import{R as M}from"./FilePdfOutlined-DEIi5Lbm.js";import{R as w}from"./FileImageOutlined-eYZWO5_j.js";import{T as H}from"./index-DVx3a9qR.js";import{B as L}from"./Breadcrumb-4NJyj_rA.js";import{S as P}from"./index-CxzV53XG.js";import{S as q}from"./index-0iedL70p.js";import{R as G}from"./UploadOutlined-CroxUJR-.js";import{R as D}from"./FormOutlined-BWVmM4n-.js";import"./UserOutlined-Cs_VmhTJ.js";import"./index-hGIK_HDO.js";import"./index-BDtS0eMa.js";import"./EllipsisOutlined-Dgx-5LTE.js";import"./PurePanel-B9LZ7YRU.js";import"./InboxOutlined-NtB6O71W.js";import"./index-oMLWggrR.js";import"./EyeOutlined-B_Q_oTAq.js";import"./CheckCircleOutlined-B1TgeDI1.js";import"./index-DhGGMygA.js";import"./DeleteOutlined-CEoMe9ec.js";import"./index-Pphe6XF4.js";import"./DownloadOutlined-DWQYyjAb.js";import"./progress-Dl3Fwial.js";import"./CheckOutlined-BtpNa_G2.js";import"./index-alDFd_10.js";import"./useVariants-DiVBn6uh.js";import"./getAllowClear-YBVvCZBt.js";import"./Input-BSKYPgzP.js";import"./SearchOutlined-rZRKH8d_.js";import"./EditOutlined-Dt25MYJV.js";import"./CalendarOutlined-BKTt4Cib.js";import"./ClockCircleOutlined-Zf5tEG56.js";import"./useIcons-Bcyu7X2C.js";import"./DownOutlined-Bis42zyM.js";import"./addEventListener-CGfbZz05.js";const{Title:we,Text:He}=H;function Z({formData:r,setFormData:d,displayImage:s}){const[i,a]=g.useState({plot_number:!1,location:!1,date_of_registration:!1,size:!1}),m=(t,A)=>{d({...r,[t]:A}),a({...i,[t]:!0})},E=(t,A)=>{d({...r,date_of_registration:A}),a({...i,date_of_registration:!0})},u=t=>t?t.base64?t.base64:t.url?t.url:t.response&&t.response.file&&t.response.file.url?t.response.file.url:t.originFileObj?URL.createObjectURL(t.originFileObj):t.tempPath?`/storage/${t.tempPath}`:t.response&&t.response.file&&t.response.file.tempPath?`/storage/${t.response.file.tempPath}`:null:null,l=t=>{if(!t)return!1;if(t.base64&&(t.base64.startsWith("data:image/jpeg")||t.base64.startsWith("data:image/png")||t.base64.startsWith("data:image/jpg")))return!0;const A=["image/jpeg","image/png","image/jpg"];return t.type&&A.includes(t.type)},h=()=>{if(!s)return null;const t=u(s);return e.jsx(x,{title:"រូបភាពបង្ហាញ",className:"mb-6",styles:{body:{padding:"16px",textAlign:"center"}},children:l(s)&&t?e.jsx("div",{style:{maxWidth:"500px",margin:"0 auto"},children:e.jsx(K,{src:t,alt:s.name||s.fileName,style:{maxHeight:"350px",objectFit:"contain"},preview:{maskClassName:"preview-mask",mask:e.jsx("div",{children:"Click to view full size"})},fallback:"data:image/png;base64,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"})}):e.jsxs("div",{style:{textAlign:"center",padding:"20px"},children:[s.type&&s.type.includes("pdf")?e.jsx(M,{style:{fontSize:"48px",color:"#ff4d4f"}}):e.jsx(w,{style:{fontSize:"48px",color:"#1890ff"}}),e.jsx("div",{style:{marginTop:"8px"},children:s.name||s.fileName})]})})};return e.jsxs(e.Fragment,{children:[s&&h(),e.jsx(x,{title:"ព័ត៌មានដី",className:"mb-6",children:e.jsxs(p,{layout:"vertical",className:"mt-6",children:[e.jsx(p.Item,{label:"លេខប្លង់",required:!0,validateStatus:i.plot_number&&!r.plot_number?"error":"",help:i.plot_number&&!r.plot_number?"សូមបញ្ចូលលេខប្លង់":"",children:e.jsx(b,{placeholder:"បញ្ចូលលេខប្លង់",value:r.plot_number,onChange:t=>m("plot_number",t.target.value)})}),e.jsx(p.Item,{label:"ទីតាំង",required:!0,validateStatus:i.location&&!r.location?"error":"",help:i.location&&!r.location?"សូមបញ្ចូលទីតាំង":"",children:e.jsx(b,{placeholder:"បញ្ចូលទីតាំង",value:r.location,onChange:t=>m("location",t.target.value)})}),e.jsx(p.Item,{label:"កាលបរិច្ឆេទចុះបញ្ជី",required:!0,validateStatus:i.date_of_registration&&!r.date_of_registration?"error":"",help:i.date_of_registration&&!r.date_of_registration?"សូមបញ្ចូលកាលបរិច្ឆេទចុះបញ្ជី":"",children:e.jsx(T,{style:{width:"100%"},placeholder:"ជ្រើសរើសកាលបរិច្ឆេទ",value:r.date_of_registration?Y(r.date_of_registration):null,onChange:E,format:"YYYY-MM-DD"})}),e.jsx(C,{gutter:16,children:e.jsx(B,{xs:24,children:e.jsx(p.Item,{label:"ទំហំ (ម៉ែត្រការ៉េ)",required:!0,validateStatus:i.size&&!r.size?"error":"",help:i.size&&!r.size?"សូមបញ្ចូលទំហំ":"",children:e.jsx(U,{style:{width:"100%"},placeholder:"បញ្ចូលទំហំ",value:r.size!==""?r.size:null,onChange:t=>m("size",t),stringMode:!1,min:0,step:.01,precision:2,addonAfter:"ម²"})})})})]})})]})}function _(){const[r,d]=g.useState(0),[s,i]=g.useState([]),[a,m]=g.useState({plot_number:"",location:"",date_of_registration:"",size:""}),[E,u]=g.useState(!1),l=s.find(o=>o.isDisplay)||s[0]||null,h=async()=>{u(!0);try{const o=s.map(n=>{const y=l&&(n.uid&&l.uid===n.uid||n.base64&&l.base64===n.base64),N=n.name||n.fileName,I=n.type||"image/jpeg",S=n.base64;return{fileName:N,isDisplay:y||!1,base64:S,mimeType:I}}),Q=await R.post("/api/lands",{...a,documents:o});Q.data.message&&Q.data.message.includes("successfully")?(c.success("ព័ត៌មានដីត្រូវបានរក្សាទុកដោយជោគជ័យ!"),setTimeout(()=>{z.visit(route("data-entry.lands.index"))},1500)):c.error("មានបញ្ហាក្នុងការរក្សាទុកព័ត៌មានដី។")}catch(o){o.response&&o.response.data?o.response.data.error?c.error(`មានបញ្ហា: ${o.response.data.error}`):o.response.data.errors?Object.values(o.response.data.errors).flat().forEach(n=>{c.error(n)}):c.error(`មានបញ្ហាក្នុងការរក្សាទុកព័ត៌មានដី។ កូដ: ${o.response.status}`):c.error("មានបញ្ហាក្នុងការរក្សាទុកព័ត៌មានដី។")}finally{u(!1)}},t=[{title:"បញ្ចូលកិច្ចសន្យា",icon:e.jsx(G,{}),content:e.jsx(F,{category:"land",fileList:s,onFilesChange:o=>{i(o)},maxFiles:2})},{title:"បញ្ចូលព័ត៌មាន",icon:e.jsx(D,{}),content:e.jsx(e.Fragment,{children:e.jsx(Z,{formData:a,setFormData:m,displayImage:l})})}],A=()=>{d(r+1)},f=()=>{d(r-1)};return e.jsxs(e.Fragment,{children:[e.jsx(v,{title:"បញ្ចូលព័ត៌មានដីថ្មី"}),e.jsx(L,{className:"mb-6",items:[{href:route("dashboard"),title:e.jsx(J,{})},{href:route("data-entry.index"),title:"ទិន្នន័យបញ្ចូល"},{href:route("data-entry.lands.index"),title:"បញ្ជីដី"},{title:"បញ្ចូលព័ត៌មានដីថ្មី"}]}),e.jsxs(x,{children:[e.jsx(P,{current:r,items:t.map(o=>({title:o.title,icon:o.icon})),className:"mb-8"}),e.jsx("div",{className:"steps-content mb-8",children:t[r].content}),e.jsx("div",{className:"steps-action",children:e.jsxs(C,{justify:"space-between",children:[e.jsx(B,{children:r>0&&e.jsx(j,{onClick:f,children:"ត្រឡប់ក្រោយ"})}),e.jsx(B,{children:e.jsxs(q,{children:[r<t.length-1&&e.jsx(j,{type:"primary",onClick:A,children:"បន្ទាប់"}),r===t.length-1&&e.jsx(j,{type:"primary",onClick:h,loading:E,disabled:!a.plot_number||!a.location||!a.date_of_registration||!a.size||s.length===0,children:"រក្សាទុក"})]})})]})})]})]})}_.layout=r=>e.jsx(k,{children:r,title:"បញ្ចូលព័ត៌មានដីថ្មី"});export{_ as default};
