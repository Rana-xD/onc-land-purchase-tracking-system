import{r as i,j as e,Q as q,B as p,a as y,s as d}from"./app-Cq9T9vxM.js";import{A as K}from"./AdminLayout-CqQNNgQt.js";import{F as n}from"./index-UraXu45p.js";import{T as L}from"./index-B236O7Xl.js";import{C as N,R as H}from"./index-0lybEGve.js";import{R as J,C as k}from"./row-CJ-aj50t.js";import{I as w}from"./index-DHD7yk2W.js";import{R as O}from"./SearchOutlined-PK94XR1x.js";import{T as C}from"./index-DPFVXnL-.js";import{F as U}from"./Table-BtVi7rN6.js";import{M as G}from"./index-eUbAuevc.js";import{T as W}from"./index-DBk7DIQb.js";import{S as F}from"./index-B5_NNnDd.js";import{B as X}from"./index-DbhdeYUq.js";import{R as Y}from"./EditOutlined-BcDUZ6EU.js";import{P as Z}from"./index-DkbBOswI.js";import{R as ee}from"./DeleteOutlined-j2tGMUPF.js";import"./UserOutlined-BJz0bsFe.js";import"./index-DL0uTJIv.js";import"./EllipsisOutlined-BDh9HHBq.js";import"./PurePanel-Ce8hDmce.js";import"./InboxOutlined-ZSWvT0kT.js";import"./getAllowClear-nqy4kNbo.js";import"./CheckOutlined-_L7buK6x.js";import"./useVariants-Ea3XEG1D.js";import"./Input-DONKCjvs.js";import"./EyeOutlined-CFXJhbVH.js";import"./addEventListener-DU-bjus0.js";import"./index-B3veqm8A.js";import"./useIcons-Ds0_kiqE.js";import"./DownOutlined-8JSIA4HI.js";import"./index-DAepUo0f.js";import"./Pagination-DlQ44rBm.js";import"./index-C_zCuArI.js";import"./FileOutlined-azBO8rMn.js";import"./FolderOutlined-BXGz-0ra.js";const{Title:te,Text:_}=L,{TextArea:se}=w;function Qe(){const[R,$]=i.useState([]),[B,S]=i.useState(!1),[M,h]=i.useState(!1),[u,x]=i.useState(null),[o]=n.useForm(),[f,z]=i.useState(""),[g,A]=i.useState({current:1,pageSize:15,total:0}),E=t=>new Intl.NumberFormat("km-KH",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(t||0),l=async(t=1,s="")=>{S(!0);try{const r=await y.get("/commissions/api/pre-purchase",{params:{page:t,search:s}});r.data.commissions&&($(r.data.commissions),A({current:r.data.pagination.current_page,pageSize:r.data.pagination.per_page,total:r.data.pagination.total}))}catch{d.error("មានបញ្ហាក្នុងការទាញយកទិន្នន័យ")}finally{S(!1)}};i.useEffect(()=>{l()},[]);const P=t=>{z(t),l(1,t)},v=t=>{l(t.current,f)},T=(t=null)=>{x(t),h(!0),t?o.setFieldsValue({recipient_name:t.recipient_name,total_amount:t.total_amount,description:t.description}):o.resetFields()},I=()=>{h(!1),x(null),o.resetFields()},D=async t=>{var s,r,a,b;try{const c=u?`/commissions/api/pre-purchase/${u.id}`:"/commissions/api/pre-purchase",m=await y[u?"put":"post"](c,t);m.data.success&&(d.success(m.data.message),h(!1),x(null),o.resetFields(),l(g.current,f))}catch(c){if((r=(s=c.response)==null?void 0:s.data)!=null&&r.errors){const j=c.response.data.errors;Object.keys(j).forEach(m=>{o.setFields([{name:m,errors:j[m]}])})}else d.error(((b=(a=c.response)==null?void 0:a.data)==null?void 0:b.message)||"មានបញ្ហាក្នុងការរក្សាទុក")}},Q=async t=>{var s,r;try{const a=await y.delete(`/commissions/api/pre-purchase/${t}`);a.data.success&&(d.success(a.data.message),l(g.current,f))}catch(a){d.error(((r=(s=a.response)==null?void 0:s.data)==null?void 0:r.message)||"មានបញ្ហាក្នុងការលុប")}},V=[{title:"ឈ្មោះអ្នកទទួល",dataIndex:"recipient_name",key:"recipient_name",render:t=>e.jsx(_,{strong:!0,children:t})},{title:"ចំនួនទឹកប្រាក់",dataIndex:"total_amount",key:"total_amount",align:"right",render:t=>e.jsx(_,{strong:!0,children:E(t)})},{title:"ការពិពណ៌នា",dataIndex:"description",key:"description",render:t=>t||"-"},{title:"ស្ថានភាព",dataIndex:"status",key:"status",align:"center",render:t=>e.jsx(X,{status:t==="paid"?"success":"warning",text:t==="paid"?"បានបង់ហើយ":"មិនទាន់បង់"})},{title:"សកម្មភាព",key:"actions",align:"center",render:(t,s)=>e.jsxs(F,{children:[e.jsx(C,{title:"កែប្រែកុំស្យុង",children:e.jsx(p,{type:"link",icon:e.jsx(Y,{}),onClick:()=>T(s),size:"small"})}),e.jsx(Z,{title:"តើអ្នកពិតជាចង់លុបមែនទេ?",onConfirm:()=>Q(s.id),okText:"យល់ព្រម",cancelText:"បោះបង់",children:e.jsx(C,{title:"លុបកុំស្យុង",children:e.jsx(p,{type:"link",danger:!0,icon:e.jsx(ee,{}),size:"small"})})})]})}];return e.jsxs(K,{children:[e.jsx(q,{title:"កុំស្យុងមុនទិញ"}),e.jsxs("div",{style:{padding:"24px"},children:[e.jsx("div",{style:{marginBottom:"24px",textAlign:"center"},children:e.jsx(te,{level:2,style:{margin:0},children:"កុំស្យុងមុនទិញ"})}),e.jsxs(N,{children:[e.jsxs(J,{justify:"space-between",align:"middle",style:{marginBottom:"16px"},children:[e.jsx(k,{children:e.jsx(w.Search,{placeholder:"ស្វែងរកតាមឈ្មោះ...",allowClear:!0,onSearch:P,style:{width:300},prefix:e.jsx(O,{})})}),e.jsx(k,{children:e.jsx(C,{title:"បន្ថែមកុំស្យុងមុនទិញថ្មី",children:e.jsx(p,{type:"primary",icon:e.jsx(H,{}),onClick:()=>T(),children:"បន្ថែមថ្មី"})})})]}),e.jsx(U,{columns:V,dataSource:R,rowKey:"id",loading:B,pagination:{...g,showSizeChanger:!1,showQuickJumper:!0,showTotal:(t,s)=>`${s[0]}-${s[1]} នៃ ${t} ធាតុ`},onChange:v,locale:{emptyText:"មិនមានទិន្នន័យ"}})]}),e.jsx(G,{title:u?"កែប្រែកុំស្យុងមុនទិញ":"បន្ថែមកុំស្យុងមុនទិញ",open:M,onCancel:I,footer:null,width:600,children:e.jsxs(n,{form:o,layout:"vertical",onFinish:D,children:[e.jsx(n.Item,{name:"recipient_name",label:"ឈ្មោះអ្នកទទួល",rules:[{required:!0,message:"សូមបញ្ចូលឈ្មោះអ្នកទទួល"}],children:e.jsx(w,{placeholder:"បញ្ចូលឈ្មោះអ្នកទទួល"})}),e.jsx(n.Item,{name:"total_amount",label:"ចំនួនទឹកប្រាក់",rules:[{required:!0,message:"សូមបញ្ចូលចំនួនទឹកប្រាក់"},{type:"number",min:.01,message:"ចំនួនទឹកប្រាក់ត្រូវតែធំជាង 0"}],children:e.jsx(W,{placeholder:"បញ្ចូលចំនួនទឹកប្រាក់",style:{width:"100%"},formatter:t=>`$ ${t}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:t=>t.replace(/\$\s?|(,*)/g,""),precision:2})}),e.jsx(n.Item,{name:"description",label:"ការពិពណ៌នា",children:e.jsx(se,{placeholder:"បញ្ចូលការពិពណ៌នា (ស្រេចចិត្ត)",rows:4})}),e.jsx(n.Item,{style:{marginBottom:0,textAlign:"right"},children:e.jsxs(F,{children:[e.jsx(p,{onClick:I,children:"បោះបង់"}),e.jsx(p,{type:"primary",htmlType:"submit",children:"រក្សាទុក"})]})})]})})]})]})}export{Qe as default};
