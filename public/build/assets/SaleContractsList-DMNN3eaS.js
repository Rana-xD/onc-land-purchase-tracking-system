import{r as n,a as R,j as r,Q as I,t as d,B as a,s as u,h as y}from"./app-mk9C7I_N.js";import{A as k}from"./AdminLayout-CSpn-5iP.js";import{C as T,R as D}from"./index-DZTYDYFc.js";import{T as $}from"./index-DDFZ7dy0.js";import{S as j}from"./index-pKRxIKW4.js";import{I as v}from"./index-BiMKBPmP.js";import{R as E}from"./SearchOutlined-jGh7iI3q.js";import{F as P}from"./Table-CR7r1NXs.js";import{T as i}from"./index-phC_QXgK.js";import{R as A}from"./EyeOutlined-CQ17cMyg.js";import{R as B}from"./EditOutlined-CkdCVUZ6.js";import{R as F}from"./FilePdfOutlined-DU1gttpQ.js";import{P as N}from"./index-D2FKLp4I.js";import{R as z}from"./DeleteOutlined-CQidAT13.js";import"./UserOutlined-Do6ZzMFA.js";import"./index-D66KGu5D.js";import"./EllipsisOutlined-DwAdn_jY.js";import"./PurePanel-Bwrv9FGC.js";import"./InboxOutlined-CDGQXwno.js";import"./useVariants-BUy45nvZ.js";import"./getAllowClear-BGHWSs2V.js";import"./CheckOutlined-CeCjh9xi.js";import"./Input-DUxd1TpC.js";import"./addEventListener-KCP_u9m-.js";import"./index-CHP0fo2g.js";import"./useIcons-CunuZG3Y.js";import"./DownOutlined-CUiMnNSy.js";import"./index-Bl_0AmJC.js";import"./Pagination-DbG4IO0G.js";import"./index-CYzbL2Oe.js";import"./FileOutlined-BPRx6OYG.js";import"./FolderOutlined-C4h6UTTq.js";const{Title:K}=$;function _e({initialDocuments:l}){const[p,f]=n.useState(l||[]),[_,x]=n.useState(!1),[c,w]=n.useState("");n.useEffect(()=>{l||g()},[l]);const g=async()=>{x(!0);try{const e=await R.get("/api/documents?type=sale_contract");f(e.data)}catch(e){console.error("បញ្ហាក្នុងការទាញកិច្ចសន្យាលក់ដី:",e)}finally{x(!1)}},h=e=>e?new Date(e).toLocaleDateString("km-KH",{year:"numeric",month:"long",day:"numeric"}):"",C=e=>{y.delete(route("sale-contracts.destroy",{id:e}),{onSuccess:()=>{u.success("លិខិតទិញ លក់ត្រូវបានលុបដោយជោគជ័យ"),f(p.filter(t=>t.id!==e))},onError:()=>{u.error("មានបញ្ហាក្នុងការលុបកិច្ចសន្យា")}})},m=e=>e.payment_steps&&e.payment_steps.some(t=>t.status==="paid"),S=e=>{if(m(e)){u.error("មិនអាចកែសម្រួលកិច្ចសន្យាទិញលក់បានទេ ពីព្រោះមានដំណាក់កាលបង់ប្រាក់ដែលបានបង់រួចរាល់ហើយ។");return}y.visit(route("sale-contracts.edit",{id:e.id}))},b=p.filter(e=>{if(!c)return!0;const t=c.toLowerCase();return!!(e.document_code&&e.document_code.toLowerCase().includes(t)||e.id.toString().includes(t)||e.created_at&&h(e.created_at).toLowerCase().includes(t)||e.buyers&&e.buyers.some(s=>s.buyer&&s.buyer.name&&s.buyer.name.toLowerCase().includes(t))||e.sellers&&e.sellers.some(s=>s.seller&&s.seller.name&&s.seller.name.toLowerCase().includes(t))||e.lands&&e.lands.some(s=>s.land&&s.land.plot_number&&s.land.plot_number.toLowerCase().includes(t)||s.land&&s.land.location&&s.land.location.toLowerCase().includes(t)))}),L=[{title:"លេខសម្គាល់",dataIndex:"document_code",key:"document_code",render:(e,t)=>e||`#${t.id}`,sorter:(e,t)=>e.document_code&&t.document_code?e.document_code.localeCompare(t.document_code):e.id-t.id},{title:"អ្នកទិញ",key:"buyers",render:(e,t)=>r.jsx("span",{children:t.buyers&&t.buyers.length>0?t.buyers.map(s=>{var o;return(o=s.buyer)==null?void 0:o.name}).filter(Boolean).join(", "):"N/A"})},{title:"អ្នកលក់",key:"sellers",render:(e,t)=>r.jsx("span",{children:t.sellers&&t.sellers.length>0?t.sellers.map(s=>{var o;return(o=s.seller)==null?void 0:o.name}).filter(Boolean).join(", "):"N/A"})},{title:"តម្លៃដីសរុប",dataIndex:"total_land_price",key:"total_land_price",render:e=>`$${parseFloat(e).toLocaleString()}`,sorter:(e,t)=>e.total_land_price-t.total_land_price},{title:"កាលបរិច្ឆេទបង្កើត",dataIndex:"created_at",key:"created_at",render:e=>h(e),sorter:(e,t)=>new Date(e.created_at)-new Date(t.created_at)},{title:"សកម្មភាព",key:"action",render:(e,t)=>r.jsxs(j,{size:"small",children:[r.jsx(i,{title:"មើលលិខិតទិញលក់",children:r.jsx(d,{href:route("sale-contracts.success",{id:t.id}),children:r.jsx(a,{type:"text",icon:r.jsx(A,{})})})}),r.jsx(i,{title:m(t)?"មិនអាចកែសម្រួលបានទេ - មានការបង់ប្រាក់រួចរាល់":"កែសម្រួលលិខិតទិញលក់",children:r.jsx(a,{type:"text",icon:r.jsx(B,{}),disabled:m(t),onClick:()=>S(t)})}),r.jsx(i,{title:"ទាញយក PDF",children:r.jsx(d,{href:route("sale-contracts.download",{id:t.id}),target:"_blank",children:r.jsx(a,{type:"text",icon:r.jsx(F,{})})})}),r.jsx(N,{title:"តើអ្នកប្រាកដជាចង់លុបកិច្ចសន្យានេះមែនទេ?",description:"ការលុបនេះមិនអាចត្រឡប់ក្រោយវិញបានទេ",onConfirm:()=>C(t.id),okText:"បាទ/ចាស",cancelText:"ទេ",children:r.jsx(i,{title:"លុបលិខិតទិញលក់",children:r.jsx(a,{type:"text",danger:!0,icon:r.jsx(z,{})})})})]})}];return r.jsxs(k,{children:[r.jsx(I,{title:"លិខិតទិញ លក់"}),r.jsx("div",{className:"container mx-auto py-6",children:r.jsxs(T,{children:[r.jsxs("div",{className:"flex justify-between items-center mb-6",children:[r.jsx(K,{level:3,children:"បញ្ជីលិខិតទិញ លក់"}),r.jsxs(j,{children:[r.jsx(v,{placeholder:"ស្វែងរក...",prefix:r.jsx(E,{}),value:c,onChange:e=>w(e.target.value),style:{width:200}}),r.jsx(d,{href:route("sale-contracts.create"),children:r.jsx(a,{type:"primary",icon:r.jsx(D,{}),children:"បង្កើតលិខិតទិញ លក់ថ្មី"})})]})]}),r.jsx(P,{rowKey:"id",columns:L,dataSource:b,loading:_,pagination:{pageSize:10}})]})})]})}export{_e as default};
