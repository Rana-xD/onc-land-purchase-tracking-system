import{r as g,j as r,Q as O,t as W,B as Y,a as q,s as w}from"./app-BrCXGEhZ.js";import{A as G,R as J,a as f,b as L}from"./AdminLayout-sV_EEP8n.js";import{C as x,T as U}from"./index-DRz4vaHg.js";import{B as T}from"./Breadcrumb-DB2HTosv.js";import{T as V}from"./index-Dru69ujH.js";import{I as X}from"./index-qaS1-amX.js";import{R as Z}from"./SearchOutlined-BDCl3y_A.js";import{R as ee,C as S}from"./row-stCrAj79.js";import{S as $}from"./index-BJXC7Zny.js";import{R as B}from"./DollarOutlined-Cbi10PKj.js";import{S as h}from"./index-DwuA6IHU.js";import{F as y}from"./Table-J9C6Be-7.js";import{R as re,a as oe}from"./RollbackOutlined-BdjbK87a.js";import{T as ne}from"./index-pzF3Y6wt.js";import{P as ae}from"./index-C5of6ZWE.js";import"./UserOutlined-DgkU0Wia.js";import"./index-DjqfnhJJ.js";import"./index-DXnJKA6M.js";import"./EllipsisOutlined-CxDggLKs.js";import"./PurePanel-BBaic0YS.js";import"./index-OVY5O9Wo.js";import"./InboxOutlined-Qxvmf9ye.js";import"./useVariants-EJywnfb4.js";import"./DownOutlined-Bc8ecrXM.js";import"./EditOutlined-tdLcT6_z.js";import"./getAllowClear-CiWMq0gn.js";import"./CheckOutlined-BONIWw9W.js";import"./Input-BbbFc-8M.js";import"./EyeOutlined-CG_zYn54.js";import"./addEventListener-I1XHhjus.js";import"./index-Ch5jzg5Q.js";import"./useIcons-CR98POIW.js";import"./index-D0979U_2.js";import"./useBubbleLock-CmR5-O3r.js";import"./index-Dib3LoS_.js";import"./Pagination-7ru7OaTS.js";import"./FileOutlined-DtqVzwrm.js";import"./FolderOutlined-sXfZ_WPD.js";const{Title:te}=V,{Search:se}=X;function Ye({auth:A,statistics:n,archived:F}){var C,I,N,k,z,M,D,K;const[i,_]=g.useState(!1),[t,le]=g.useState(F||{}),[b,R]=g.useState(""),[E,P]=g.useState("5"),Q=async(e,o)=>{var s,l,a,m;try{_(!0);const j=((s=(await q.post("/archive/restore",{type:e,id:o})).data)==null?void 0:s.message)||"ទិន្នន័យត្រូវបានស្តារដោយជោគជ័យ";w.success(j),setTimeout(()=>{window.location.reload()},800)}catch(p){if(console.error("Error restoring:",p),((l=p.response)==null?void 0:l.status)===403)w.error("អ្នកមិនមានសិទ្ធិស្តារទិន្នន័យនេះទេ");else{const j=((m=(a=p.response)==null?void 0:a.data)==null?void 0:m.message)||"មានបញ្ហាក្នុងការស្តារទិន្នន័យ";w.error(j)}}finally{_(!1)}},c=e=>{switch(e){case"1":return[...(t.buyers||[]).map(o=>({...o,type:"buyers",typeName:"អ្នកទិញ"})),...(t.sellers||[]).map(o=>({...o,type:"sellers",typeName:"អ្នកលក់"})),...(t.lands||[]).map(o=>({...o,type:"lands",typeName:"ដី"}))];case"2":return[...(t.document_creations||[]).map(o=>({...o,type:"document_creations",typeName:"កិច្ចសន្យា"}))];case"3":return(t.commissions||[]).map(o=>({...o,type:"commissions",typeName:"កុំស្យុង"}));case"4":return[...(t.users||[]).map(o=>({...o,type:"users",typeName:"អ្នកប្រើប្រាស់"})),...(t.roles||[]).map(o=>({...o,type:"roles",typeName:"តួនាទី"}))];case"5":return Object.entries(t).flatMap(([o,s])=>{if(o==="sale_contracts")return[];const l={buyers:"អ្នកទិញ",sellers:"អ្នកលក់",lands:"ដី",document_creations:"កិច្ចសន្យា",commissions:"កុំស្យុង",users:"អ្នកប្រើប្រាស់",roles:"តួនាទី"};return s.map(a=>({...a,type:o,typeName:l[o]||o}))});default:return[]}},H=e=>{if(!e)return"គ្មាន";const o=new Date(e),s=o.getDate(),l=o.getMonth()+1,a=o.getFullYear(),m=o.getHours().toString().padStart(2,"0"),p=o.getMinutes().toString().padStart(2,"0");return`ថ្ងៃទី ${s} ខែ${["មករា","កុម្ភៈ","មីនា","មេសា","ឧសភា","មិថុនា","កក្កដា","សីហា","កញ្ញា","តុលា","វិច្ឆិកា","ធ្នូ"][l-1]} ឆ្នាំ ${a} ម៉ោង ${m}:${p}`},v=e=>e.document_code?e.document_code:e.name?e.name:e.title?e.title:e.land_title_number?`ដីលេខ: ${e.land_title_number}`:e.contract_number?`កិច្ចសន្យាលេខ: ${e.contract_number}`:e.commission_type?`កុំស្យុង ${e.commission_type}`:`#${e.id}`,d=e=>b?e.filter(o=>{var m;const s=v(o).toLowerCase(),l=(((m=o.deleted_by)==null?void 0:m.name)||"").toLowerCase(),a=b.toLowerCase();return s.includes(a)||l.includes(a)}):e,u=[{title:"ប្រភេទ",dataIndex:"typeName",key:"typeName",render:e=>r.jsx(ne,{color:"blue",children:e})},{title:"ឈ្មោះ/លេខសម្គាល់",dataIndex:"name",key:"name",render:(e,o)=>v(o)},{title:"កាលបរិច្ឆេទលុប",dataIndex:"deleted_at",key:"deleted_at",render:e=>H(e)},{title:"លុបដោយ",dataIndex:"deleted_by",key:"deleted_by",render:e=>(e==null?void 0:e.name)||"មិនស្គាល់"},{title:"សកម្មភាព",key:"action",render:(e,o)=>r.jsx(ae,{title:"បញ្ជាក់ការស្តារ",description:"តើអ្នកពិតជាចង់ស្តារទិន្នន័យនេះមែនទេ?",onConfirm:()=>Q(o.type,o.id),okText:"យល់ព្រម",cancelText:"បោះបង់",children:r.jsx(Y,{type:"primary",icon:r.jsx(oe,{}),size:"small",loading:i,children:"ស្តារឡើងវិញ"})})}];return r.jsxs(G,{user:A.user,children:[r.jsx(O,{title:"ទិន្នន័យ"}),r.jsx("div",{style:{padding:"24px"},children:r.jsxs(x,{children:[r.jsxs(T,{style:{marginBottom:16},children:[r.jsx(T.Item,{children:r.jsxs(W,{href:"/",children:[r.jsx(J,{})," ទំព័រដើម"]})}),r.jsx(T.Item,{children:"ទិន្នន័យ"})]}),r.jsxs("div",{style:{marginBottom:24},children:[r.jsx(te,{level:3,children:"ទិន្នន័យ"}),r.jsx(se,{placeholder:"ស្វែងរក...",allowClear:!0,enterButton:r.jsx(Z,{}),size:"large",onSearch:e=>R(e),onChange:e=>R(e.target.value),style:{maxWidth:400}})]}),r.jsxs(ee,{gutter:16,style:{marginBottom:24},children:[r.jsx(S,{xs:24,sm:12,md:6,children:r.jsx(x,{children:r.jsx($,{title:"ទិន្នន័យបញ្ចូល",value:(((C=n==null?void 0:n.data_entry)==null?void 0:C.buyers)||0)+(((I=n==null?void 0:n.data_entry)==null?void 0:I.sellers)||0)+(((N=n==null?void 0:n.data_entry)==null?void 0:N.lands)||0),prefix:r.jsx(f,{}),valueStyle:{color:"#1890ff"}})})}),r.jsx(S,{xs:24,sm:12,md:6,children:r.jsx(x,{children:r.jsx($,{title:"កិច្ចសន្យា",value:(((k=n==null?void 0:n.contracts)==null?void 0:k.document_creations)||0)+(((z=n==null?void 0:n.contracts)==null?void 0:z.sale_contracts)||0),prefix:r.jsx(f,{}),valueStyle:{color:"#52c41a"}})})}),r.jsx(S,{xs:24,sm:12,md:6,children:r.jsx(x,{children:r.jsx($,{title:"កុំស្យុង",value:((M=n==null?void 0:n.commissions)==null?void 0:M.total)||0,prefix:r.jsx(B,{}),valueStyle:{color:"#faad14"}})})}),r.jsx(S,{xs:24,sm:12,md:6,children:r.jsx(x,{children:r.jsx($,{title:"អ្នកប្រើប្រាស់",value:(((D=n==null?void 0:n.users)==null?void 0:D.users)||0)+(((K=n==null?void 0:n.users)==null?void 0:K.roles)||0),prefix:r.jsx(L,{}),valueStyle:{color:"#722ed1"}})})})]}),r.jsx(U,{activeKey:E,onChange:P,items:[{key:"1",label:r.jsxs("span",{children:[r.jsx(f,{style:{marginRight:8}}),"ទិន្នន័យបញ្ចូល"]}),children:r.jsx(h,{spinning:i,children:r.jsx(y,{columns:u,dataSource:d(c("1")),rowKey:e=>`${e.type}-${e.id}`,pagination:{pageSize:10,showSizeChanger:!0,showTotal:e=>`សរុប ${e} ទិន្នន័យ`},locale:{emptyText:"មិនមានទិន្នន័យក្នុងទិន្នន័យ"}})})},{key:"2",label:r.jsxs("span",{children:[r.jsx(f,{style:{marginRight:8}}),"កិច្ចសន្យា"]}),children:r.jsx(h,{spinning:i,children:r.jsx(y,{columns:u,dataSource:d(c("2")),rowKey:e=>`${e.type}-${e.id}`,pagination:{pageSize:10,showSizeChanger:!0,showTotal:e=>`សរុប ${e} ទិន្នន័យ`},locale:{emptyText:"មិនមានទិន្នន័យក្នុងទិន្នន័យ"}})})},{key:"3",label:r.jsxs("span",{children:[r.jsx(B,{style:{marginRight:8}}),"កុំស្យុង"]}),children:r.jsx(h,{spinning:i,children:r.jsx(y,{columns:u,dataSource:d(c("3")),rowKey:e=>`${e.type}-${e.id}`,pagination:{pageSize:10,showSizeChanger:!0,showTotal:e=>`សរុប ${e} ទិន្នន័យ`},locale:{emptyText:"មិនមានទិន្នន័យក្នុងទិន្នន័យ"}})})},{key:"4",label:r.jsxs("span",{children:[r.jsx(L,{style:{marginRight:8}}),"អ្នកប្រើប្រាស់"]}),children:r.jsx(h,{spinning:i,children:r.jsx(y,{columns:u,dataSource:d(c("4")),rowKey:e=>`${e.type}-${e.id}`,pagination:{pageSize:10,showSizeChanger:!0,showTotal:e=>`សរុប ${e} ទិន្នន័យ`},locale:{emptyText:"មិនមានទិន្នន័យក្នុងទិន្នន័យ"}})})},{key:"5",label:r.jsxs("span",{children:[r.jsx(re,{style:{marginRight:8}}),"ទាំងអស់"]}),children:r.jsx(h,{spinning:i,children:r.jsx(y,{columns:u,dataSource:d(c("5")),rowKey:e=>`${e.type}-${e.id}`,pagination:{pageSize:10,showSizeChanger:!0,showTotal:e=>`សរុប ${e} ទិន្នន័យ`},locale:{emptyText:"មិនមានទិន្នន័យក្នុងទិន្នន័យ"}})})}]})]})})]})}export{Ye as default};
