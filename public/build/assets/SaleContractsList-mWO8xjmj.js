import{r as a,d as C,j as r,Q as L,t as c,S as b}from"./app-D0OhDuOP.js";import{A as R}from"./AdminLayout-DfyZC7U7.js";import{C as I,R as T}from"./index-BXZQm44E.js";import{T as k}from"./index-DUD5X347.js";import{S as x}from"./index-CpY42lHj.js";import{I as D}from"./index-DyIYvMCA.js";import{R as $}from"./SearchOutlined-DdbS1Qlk.js";import{B as n,T as m}from"./index-XQ9uBlxv.js";import{F as v}from"./Table-CJMywyvl.js";import{R as A}from"./EyeOutlined-Bk9sN1n5.js";import{R as B}from"./FilePdfOutlined-BmX1d_m5.js";import{P as E}from"./index-BLwNk9Dd.js";import{R as F}from"./DeleteOutlined-C5fTVnAq.js";import{s as h}from"./index-VXrvBi_7.js";import"./UserOutlined-Bw1Yg3TV.js";import"./index-BKPGZTnh.js";import"./EllipsisOutlined-BcUT9_x5.js";import"./PurePanel-BrlMViLC.js";import"./index-BoUcoXbW.js";import"./Skeleton-BB1PfEPR.js";import"./CloseOutlined-CSg-7HVH.js";import"./useVariants-VmmnPvRy.js";import"./EditOutlined-BQAB7wjt.js";import"./getAllowClear-7r21EHJH.js";import"./CheckOutlined-C-W3vkf9.js";import"./Input-DIi4XD1o.js";import"./pickAttrs-BMtZpb9Y.js";import"./addEventListener-Dvq9iQDE.js";import"./index-BXlDNFm_.js";import"./useIcons-De8HtjeC.js";import"./DownOutlined-BKT6hG3e.js";import"./index-CxyNWzZ_.js";import"./useBubbleLock-Dp5g0NxF.js";import"./index-HowiUfuo.js";import"./Pagination-C28t5-1k.js";import"./index-Bjcdw0HM.js";import"./extendsObject-78o_rR5W.js";import"./FileOutlined-CmtzEeI9.js";import"./FolderOutlined-CsvjmU0T.js";import"./ExclamationCircleFilled-BuCwC-hN.js";import"./ActionButton-DPI_9ZHB.js";import"./InfoCircleFilled-Csbq1HVY.js";const{Title:N}=k;function Re({initialDocuments:i}){const[d,p]=a.useState(i||[]),[j,u]=a.useState(!1),[l,y]=a.useState("");a.useEffect(()=>{i||_()},[i]);const _=async()=>{u(!0);try{const e=await C.get("/api/documents?type=sale_contract");p(e.data)}catch(e){console.error("បញ្ហាក្នុងការទាញកិច្ចសន្យាលក់ដី:",e)}finally{u(!1)}},f=e=>e?new Date(e).toLocaleDateString("km-KH",{year:"numeric",month:"long",day:"numeric"}):"",w=e=>{b.delete(route("sale-contracts.destroy",{id:e}),{onSuccess:()=>{h.success("លិខិតទិញ លក់ត្រូវបានលុបដោយជោគជ័យ"),p(d.filter(t=>t.id!==e))},onError:()=>{h.error("មានបញ្ហាក្នុងការលុបឯកសារ")}})},g=d.filter(e=>{if(!l)return!0;const t=l.toLowerCase();return!!(e.document_code&&e.document_code.toLowerCase().includes(t)||e.id.toString().includes(t)||e.created_at&&f(e.created_at).toLowerCase().includes(t)||e.buyers&&e.buyers.some(o=>o.buyer&&o.buyer.name&&o.buyer.name.toLowerCase().includes(t))||e.sellers&&e.sellers.some(o=>o.seller&&o.seller.name&&o.seller.name.toLowerCase().includes(t))||e.lands&&e.lands.some(o=>o.land&&o.land.plot_number&&o.land.plot_number.toLowerCase().includes(t)||o.land&&o.land.location&&o.land.location.toLowerCase().includes(t)))}),S=[{title:"លេខសម្គាល់",dataIndex:"document_code",key:"document_code",render:(e,t)=>e||`#${t.id}`,sorter:(e,t)=>e.document_code&&t.document_code?e.document_code.localeCompare(t.document_code):e.id-t.id},{title:"អ្នកទិញ",key:"buyers",render:(e,t)=>r.jsx("span",{children:t.buyers&&t.buyers.length>0?t.buyers.map(o=>{var s;return(s=o.buyer)==null?void 0:s.name}).filter(Boolean).join(", "):"N/A"})},{title:"អ្នកលក់",key:"sellers",render:(e,t)=>r.jsx("span",{children:t.sellers&&t.sellers.length>0?t.sellers.map(o=>{var s;return(s=o.seller)==null?void 0:s.name}).filter(Boolean).join(", "):"N/A"})},{title:"តម្លៃដីសរុប",dataIndex:"total_land_price",key:"total_land_price",render:e=>`$${parseFloat(e).toLocaleString()}`,sorter:(e,t)=>e.total_land_price-t.total_land_price},{title:"កាលបរិច្ឆេទបង្កើត",dataIndex:"created_at",key:"created_at",render:e=>f(e),sorter:(e,t)=>new Date(e.created_at)-new Date(t.created_at)},{title:"សកម្មភាព",key:"action",render:(e,t)=>r.jsxs(x,{size:"small",children:[r.jsx(m,{title:"មើលលិខិតទិញលក់",children:r.jsx(c,{href:route("sale-contracts.success",{id:t.id}),children:r.jsx(n,{type:"text",icon:r.jsx(A,{})})})}),r.jsx(m,{title:"ទាញយក PDF",children:r.jsx(c,{href:route("sale-contracts.download",{id:t.id}),target:"_blank",children:r.jsx(n,{type:"text",icon:r.jsx(B,{})})})}),r.jsx(E,{title:"តើអ្នកប្រាកដជាចង់លុបឯកសារនេះមែនទេ?",description:"ការលុបនេះមិនអាចត្រឡប់ក្រោយវិញបានទេ",onConfirm:()=>w(t.id),okText:"បាទ/ចាស",cancelText:"ទេ",children:r.jsx(m,{title:"លុបលិខិតទិញលក់",children:r.jsx(n,{type:"text",danger:!0,icon:r.jsx(F,{})})})})]})}];return r.jsxs(R,{children:[r.jsx(L,{title:"លិខិតទិញ លក់"}),r.jsx("div",{className:"container mx-auto py-6",children:r.jsxs(I,{children:[r.jsxs("div",{className:"flex justify-between items-center mb-6",children:[r.jsx(N,{level:3,children:"បញ្ជីលិខិតទិញ លក់"}),r.jsxs(x,{children:[r.jsx(D,{placeholder:"ស្វែងរក...",prefix:r.jsx($,{}),value:l,onChange:e=>y(e.target.value),style:{width:200}}),r.jsx(c,{href:route("sale-contracts.create"),children:r.jsx(n,{type:"primary",icon:r.jsx(T,{}),children:"បង្កើតលិខិតទិញ លក់ថ្មី"})})]})]}),r.jsx(v,{rowKey:"id",columns:S,dataSource:g,loading:j,pagination:{pageSize:10}})]})})]})}export{Re as default};
