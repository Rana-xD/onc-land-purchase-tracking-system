import{j as e,r as Q,Q as J,B as x,a as k,s as j,h as Y}from"./app-BrCXGEhZ.js";import{R as K,A as F}from"./AdminLayout-sV_EEP8n.js";import{F as w}from"./FileUpload-CBHQT7iW.js";import{d as z}from"./dayjs.min-C-nyQOtZ.js";import{C as B}from"./index-DRz4vaHg.js";import{F as a}from"./index-CbHMmbA4.js";import{I as p}from"./index-qaS1-amX.js";import{S as N}from"./index-Ch5jzg5Q.js";import{D}from"./index-BdQTU9pk.js";import{I as M}from"./index-dzd3mRnU.js";import{R as T}from"./FilePdfOutlined-CSnPzqTj.js";import{R as U}from"./FileImageOutlined-CwNrsxME.js";import{T as H}from"./index-Dru69ujH.js";import{B as L}from"./Breadcrumb-DB2HTosv.js";import{S as P}from"./index-Co5CbxV-.js";import{R as q,C}from"./row-stCrAj79.js";import{S as G}from"./index-OVY5O9Wo.js";import{R as Z}from"./UploadOutlined-BhOSg331.js";import{R as X}from"./FormOutlined-D6QWnOja.js";import"./UserOutlined-DgkU0Wia.js";import"./index-DjqfnhJJ.js";import"./index-DXnJKA6M.js";import"./EllipsisOutlined-CxDggLKs.js";import"./PurePanel-BBaic0YS.js";import"./InboxOutlined-Qxvmf9ye.js";import"./index-pzF3Y6wt.js";import"./EyeOutlined-CG_zYn54.js";import"./CheckCircleOutlined-SjtlU7Oe.js";import"./index-CHxkqad8.js";import"./DeleteOutlined-85Q0A1R5.js";import"./index-DwOnJ-kp.js";import"./DownloadOutlined-DCnSfP1E.js";import"./progress-BmWTGRVZ.js";import"./CheckOutlined-BONIWw9W.js";import"./index-DwuA6IHU.js";import"./useVariants-EJywnfb4.js";import"./getAllowClear-CiWMq0gn.js";import"./Input-BbbFc-8M.js";import"./SearchOutlined-BDCl3y_A.js";import"./EditOutlined-tdLcT6_z.js";import"./useIcons-CR98POIW.js";import"./DownOutlined-Bc8ecrXM.js";import"./CalendarOutlined-easnY0-h.js";import"./ClockCircleOutlined-BSLjDnKK.js";import"./addEventListener-I1XHhjus.js";const{Option:y}=N,{Title:He,Text:Le}=H;function W({formData:s,setFormData:g,displayImage:r}){const o=(t,i)=>{g({...s,[t]:i})},l=t=>{if(!t)return!1;if(t.base64&&t.base64.startsWith("data:image/")||t.url&&t.url.startsWith("data:image/"))return!0;const i=t.name||t.fileName||"";if(i&&/\.(jpg|jpeg|png|gif|webp|bmp)$/i.test(i))return!0;const n=["image/jpeg","image/png","image/jpg","image/gif","image/webp","image/bmp"];return!!(t.type&&n.includes(t.type))},u=()=>{var c,d;if(!r)return null;const t=r.name||r.fileName||"",i=l(r)||t&&/\.(jpg|jpeg|png|gif|webp|bmp)$/i.test(t);let n=null;return r.base64?n=r.base64:r.url?n=r.url:(d=(c=r.response)==null?void 0:c.file)!=null&&d.base64?n=r.response.file.base64:r.tempPath?n=`/storage/${r.tempPath}`:t&&(n=`/storage/temp/${t}`),e.jsx(B,{title:"រូបភាពបង្ហាញ",className:"mb-6",styles:{body:{padding:"16px",textAlign:"center"}},children:i&&n?e.jsx("div",{style:{maxWidth:"500px",margin:"0 auto"},children:e.jsx(M,{src:n,alt:r.name||r.fileName||"Image",style:{maxHeight:"350px",objectFit:"contain"},preview:{maskClassName:"preview-mask",mask:e.jsx("div",{children:"Click to view full size"})},fallback:"data:image/png;base64,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"})}):e.jsxs("div",{style:{padding:"20px",textAlign:"center"},children:[e.jsx("div",{style:{marginBottom:"10px",color:"red"},children:i?"No valid URL found":"Not an image file"}),r.type&&r.type.includes("pdf")?e.jsx(T,{style:{fontSize:"48px",color:"#ff4d4f"}}):e.jsx(U,{style:{fontSize:"48px",color:"#1890ff"}}),e.jsx("div",{style:{marginTop:"10px"},children:r.name||r.fileName||"កិច្ចសន្យា"})]})})};return e.jsxs(e.Fragment,{children:[r&&u(),e.jsx(B,{title:"ព័ត៌មានអ្នកទិញ",className:"mb-6",children:e.jsxs(a,{layout:"vertical",children:[e.jsx(a.Item,{label:"ឈ្មោះ",required:!0,rules:[{required:!0,message:"សូមបញ្ចូលឈ្មោះ"}],children:e.jsx(p,{placeholder:"បញ្ចូលឈ្មោះ",value:s.name,onChange:t=>o("name",t.target.value)})}),e.jsx(a.Item,{label:"ភេទ",required:!0,children:e.jsxs(N,{value:s.sex,onChange:t=>o("sex",t),children:[e.jsx(y,{value:"male",children:"ប្រុស"}),e.jsx(y,{value:"female",children:"ស្រី"})]})}),e.jsx(a.Item,{label:"ថ្ងៃខែឆ្នាំកំណើត",required:!0,children:e.jsx(D,{style:{width:"100%"},format:"DD/MM/YYYY",value:s.date_of_birth?z(s.date_of_birth):null,onChange:(t,i)=>o("date_of_birth",t?t.format("YYYY-MM-DD"):null)})}),e.jsx(a.Item,{label:"លេខអត្តសញ្ញាណប័ណ្ណ",required:!0,children:e.jsx(p,{placeholder:"បញ្ចូលលេខអត្តសញ្ញាណប័ណ្ណ",value:s.identity_number,onChange:t=>o("identity_number",t.target.value)})}),e.jsx(a.Item,{label:"អាសយដ្ឋាន",required:!0,children:e.jsx(p.TextArea,{placeholder:"បញ្ចូលអាសយដ្ឋាន",rows:3,value:s.address,onChange:t=>o("address",t.target.value)})}),e.jsx(a.Item,{label:"លេខទូរស័ព្ទ",children:e.jsx(p,{placeholder:"បញ្ចូលលេខទូរស័ព្ទ",value:s.phone_number,onChange:t=>o("phone_number",t.target.value)})})]})})]})}function O(){const[s,g]=Q.useState(0),[r,o]=Q.useState([]),[l,u]=Q.useState({name:"",sex:"male",date_of_birth:"",identity_number:"",address:"",phone_number:""}),[t,i]=Q.useState(!1),n=r.find(A=>A.isDisplay)||r[0]||null,c=()=>{g(s+1)},d=()=>{g(s-1)},I=async()=>{i(!0);try{const A=r.map(m=>{var b,f;const S=m.base64||((f=(b=m.response)==null?void 0:b.file)==null?void 0:f.base64),v=m.name||m.fileName,R=m.type||"image/jpeg";return{base64:S,fileName:v,mimeType:R,isDisplay:m.isDisplay||!1}}),h=await k.post("/api/buyers",{...l,documents:A});h.data.success||h.data.buyer&&h.data.buyer.id?(j.success("ព័ត៌មានអ្នកទិញត្រូវបានរក្សាទុកដោយជោគជ័យ!"),Y.visit(route("data-entry.buyers.index"))):j.error("មានបញ្ហាក្នុងការរក្សាទុកព័ត៌មានអ្នកទិញ។")}catch{j.error("មានបញ្ហាក្នុងការរក្សាទុកព័ត៌មានអ្នកទិញ។")}finally{i(!1)}},E=[{title:"បញ្ចូលកិច្ចសន្យា",icon:e.jsx(Z,{}),content:e.jsx(w,{category:"buyer",fileList:r,onFilesChange:A=>{o(A)},maxFiles:2})},{title:"បញ្ចូលព័ត៌មាន",icon:e.jsx(X,{}),content:e.jsx(e.Fragment,{children:e.jsx(W,{formData:l,setFormData:u,displayImage:n})})}];return e.jsxs(e.Fragment,{children:[e.jsx(J,{title:"បញ្ចូលព័ត៌មានអ្នកទិញថ្មី"}),e.jsx(L,{className:"mb-6",items:[{href:route("dashboard"),title:e.jsx(K,{})},{href:route("data-entry.index"),title:"ទិន្នន័យបញ្ចូល"},{href:route("data-entry.buyers.index"),title:"បញ្ជីអ្នកទិញ"},{title:"បញ្ចូលព័ត៌មានអ្នកទិញថ្មី"}]}),e.jsxs(B,{children:[e.jsx(P,{current:s,items:E.map(A=>({title:A.title,icon:A.icon})),className:"mb-8"}),e.jsx("div",{className:"steps-content mb-8",children:E[s].content}),e.jsx("div",{className:"steps-action",children:e.jsxs(q,{justify:"space-between",children:[e.jsx(C,{children:s>0&&e.jsx(x,{onClick:d,children:"ត្រឡប់ក្រោយ"})}),e.jsx(C,{children:e.jsxs(G,{children:[s<E.length-1&&e.jsx(x,{type:"primary",onClick:c,disabled:s===0&&r.length<2,children:"បន្ទាប់"}),s===E.length-1&&e.jsx(x,{type:"primary",onClick:I,loading:t,disabled:!l.name||!l.identity_number||r.length<2,children:"រក្សាទុក"})]})})]})})]})]})}O.layout=s=>e.jsx(F,{children:s,title:"បញ្ចូលព័ត៌មានអ្នកទិញថ្មី"});export{O as default};
