import{r as _,j as e,Q as B,B as l,s as x,a as S,h as b}from"./app-BrCXGEhZ.js";import{A as Y}from"./AdminLayout-sV_EEP8n.js";import{d as $}from"./dayjs.min-C-nyQOtZ.js";import{F as a}from"./index-CbHMmbA4.js";import{S as I}from"./index-OVY5O9Wo.js";import{R as k}from"./ArrowLeftOutlined-naaOCqhv.js";import{T as w}from"./index-Dru69ujH.js";import{C as R,R as E}from"./index-DRz4vaHg.js";import{R as C,C as h}from"./row-stCrAj79.js";import{I as T}from"./index-qaS1-amX.js";import{T as F}from"./index-BXcdKeug.js";import{D as M}from"./index-yCHV9yH1.js";import{D as v}from"./index-BdQTU9pk.js";import{R as q}from"./MinusCircleOutlined-DSF4OFlb.js";import{R as P}from"./SaveOutlined-CHTBOYln.js";import"./UserOutlined-DgkU0Wia.js";import"./index-DjqfnhJJ.js";import"./index-DXnJKA6M.js";import"./EllipsisOutlined-CxDggLKs.js";import"./PurePanel-BBaic0YS.js";import"./InboxOutlined-Qxvmf9ye.js";import"./EditOutlined-tdLcT6_z.js";import"./getAllowClear-CiWMq0gn.js";import"./useVariants-EJywnfb4.js";import"./CheckOutlined-BONIWw9W.js";import"./Input-BbbFc-8M.js";import"./EyeOutlined-CG_zYn54.js";import"./SearchOutlined-BDCl3y_A.js";import"./DownOutlined-Bc8ecrXM.js";import"./CalendarOutlined-easnY0-h.js";import"./ClockCircleOutlined-BSLjDnKK.js";import"./useIcons-CR98POIW.js";const{Title:L,Text:be}=w,{TextArea:O}=T;function $e({commission:o}){const[p]=a.useForm(),[z,f]=_.useState(!1);_.useEffect(()=>{var t;o&&p.setFieldsValue({recipient_name:o.recipient_name,total_amount:o.total_amount,description:o.description,payment_steps:((t=o.payment_steps)==null?void 0:t.map(i=>({amount:i.amount,due_date:$(i.due_date)})))||[{amount:null,due_date:null}]})},[o,p]);const D=async t=>{var i,d,c,n;f(!0);try{const s=parseFloat(t.total_amount),r=t.payment_steps.reduce((u,A)=>u+parseFloat(A.amount||0),0);if(Math.abs(s-r)>.01){x.error(`ចំនួនសរុបនៃជំហានទូទាត់ ($${r.toFixed(2)}) មិនត្រូវនឹងចំនួនសរុប ($${s.toFixed(2)}) ទេ។ សូមពិនិត្យម្តងទៀត។`),f(!1);return}const m=t.payment_steps.map(u=>({amount:u.amount,due_date:u.due_date.format("YYYY-MM-DD")})),j={...t,payment_steps:m},y=await S.put(`/commissions/api/post-purchase/${o.id}`,j);y.data.success&&(x.success(y.data.message),b.visit("/commissions/post-purchase"))}catch(s){if((d=(i=s.response)==null?void 0:i.data)!=null&&d.errors){const r=s.response.data.errors;Object.keys(r).forEach(m=>{m==="payment_steps"&&Array.isArray(r[m])?r[m].forEach(j=>{x.error(j)}):p.setFields([{name:m,errors:r[m]}])})}else x.error(((n=(c=s.response)==null?void 0:c.data)==null?void 0:n.message)||"មានបញ្ហាក្នុងការរក្សាទុក")}finally{f(!1)}},g=()=>{b.visit("/commissions/post-purchase")};return e.jsxs(Y,{children:[e.jsx(B,{title:"កែប្រែកុំស្យុងក្រោយទិញ"}),e.jsxs("div",{style:{padding:"24px"},children:[e.jsx("div",{style:{marginBottom:"24px"},children:e.jsxs(I,{align:"center",children:[e.jsx(l,{icon:e.jsx(k,{}),onClick:g,type:"text"}),e.jsx(L,{level:2,style:{margin:0,textAlign:"center"},children:"កែប្រែកុំស្យុងក្រោយទិញ"})]})}),e.jsx(R,{children:e.jsxs(a,{form:p,layout:"vertical",onFinish:D,children:[e.jsxs(C,{gutter:24,children:[e.jsx(h,{xs:24,md:12,children:e.jsx(a.Item,{name:"recipient_name",label:"ឈ្មោះអ្នកទទួល",rules:[{required:!0,message:"សូមបញ្ចូលឈ្មោះអ្នកទទួល"}],children:e.jsx(T,{placeholder:"បញ្ចូលឈ្មោះអ្នកទទួល",size:"large"})})}),e.jsx(h,{xs:24,md:12,children:e.jsx(a.Item,{name:"total_amount",label:"ចំនួនសរុប",rules:[{required:!0,message:"សូមបញ្ចូលចំនួនសរុប"},{type:"number",min:.01,message:"ចំនួនទឹកប្រាក់ត្រូវតែធំជាង 0"}],children:e.jsx(F,{placeholder:"បញ្ចូលចំនួនសរុប",style:{width:"100%"},size:"large",formatter:t=>`$ ${t}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:t=>t.replace(/\$\s?|(,*)/g,""),precision:2})})})]}),e.jsx(a.Item,{name:"description",label:"ការពិពណ៌នា",children:e.jsx(O,{placeholder:"បញ្ចូលការពិពណ៌នា (ស្រេចចិត្ត)",rows:4,size:"large"})}),e.jsx(M,{children:"ជំហានទូទាត់"}),e.jsx(a.List,{name:"payment_steps",children:(t,{add:i,remove:d})=>e.jsxs(e.Fragment,{children:[t.map(({key:c,name:n,...s})=>e.jsx(R,{size:"small",style:{marginBottom:"16px",backgroundColor:"#fafafa"},title:`ជំហានទី ${n+1}`,extra:t.length>1&&e.jsx(l,{type:"link",danger:!0,icon:e.jsx(q,{}),onClick:()=>d(n),size:"small",children:"លុប"}),children:e.jsxs(C,{gutter:16,children:[e.jsx(h,{xs:24,md:12,children:e.jsx(a.Item,{...s,name:[n,"amount"],label:"ចំនួនទឹកប្រាក់",rules:[{required:!0,message:"សូមបញ្ចូលចំនួនទឹកប្រាក់"},{type:"number",min:.01,message:"ចំនួនទឹកប្រាក់ត្រូវតែធំជាង 0"}],children:e.jsx(F,{placeholder:"ចំនួនទឹកប្រាក់",style:{width:"100%"},formatter:r=>`$ ${r}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:r=>r.replace(/\$\s?|(,*)/g,""),precision:2})})}),e.jsx(h,{xs:24,md:12,children:e.jsx(a.Item,{...s,name:[n,"due_date"],label:"កាលបរិច្ឆេទ",rules:[{required:!0,message:"សូមជ្រើសរើសកាលបរិច្ឆេទ"}],children:e.jsx(v,{placeholder:"កាលបរិច្ឆេទ",style:{width:"100%"},format:"DD/MM/YYYY",disabledDate:r=>r&&r<$().endOf("day")})})})]})},c)),e.jsx(l,{type:"dashed",onClick:()=>i(),block:!0,icon:e.jsx(E,{}),size:"large",style:{marginBottom:"24px"},children:"បន្ថែមជំហាន"})]})}),e.jsx("div",{style:{textAlign:"right",paddingTop:"16px",borderTop:"1px solid #f0f0f0"},children:e.jsxs(I,{size:"middle",children:[e.jsx(l,{size:"large",onClick:g,children:"បោះបង់"}),e.jsx(l,{type:"primary",htmlType:"submit",loading:z,icon:e.jsx(P,{}),size:"large",children:"រក្សាទុក"})]})})]})})]})]})}export{$e as default};
