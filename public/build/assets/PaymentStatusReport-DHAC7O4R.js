import{j as e,r as m,f as A,s as _,Q as W,B as H,t as $}from"./app-BGhGKeDm.js";import{A as P}from"./AdminLayout-BXXLLj0W.js";import{u as V,R as N}from"./useHTMLToPDF-DkpT73MY.js";import{C as p}from"./index-qpGzGUeV.js";import{R as v,C as n}from"./row-Ec-3Wmhs.js";import{T as O}from"./index-B6xJCuJM.js";import{S as L}from"./index-CU9uPcdA.js";import{A as K}from"./index-BSrOcnWj.js";import{S as y}from"./index-DyBnwjTx.js";import{T as E}from"./index-BlrWONL6.js";import{R as U}from"./FilePdfOutlined-txQDQ4Er.js";import{E as M}from"./index-DcGL0UUQ.js";import{R as G}from"./FolderOutlined-DyKl-WgS.js";import{D as Q}from"./index-euUqC7cP.js";import{R as F}from"./FileOutlined-fgq6oFF6.js";import{R as w}from"./DollarOutlined-D6LURsAa.js";import{L as z}from"./index-EuixFF03.js";import"./UserOutlined-DWxAHtSB.js";import"./index-B1PYG0UW.js";import"./EllipsisOutlined-BvZqw2BO.js";import"./PurePanel-BI8-qUZa.js";import"./useVariants-CfoUH3-7.js";import"./EditOutlined-Cmt36UP2.js";import"./getAllowClear-Um0uvhCc.js";import"./CheckOutlined-CzLtFOuT.js";import"./useIcons-7uZy_G_6.js";import"./DownOutlined-B_G3bdVf.js";import"./SearchOutlined-BcwQGR4p.js";import"./Pagination-eFxiWqog.js";const q=({data:o,exportedBy:c})=>{var u,f,l,j,g,b;const d=r=>new Intl.NumberFormat("km-KH",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(r||0),h=r=>new Date(r).toLocaleDateString("km-KH"),t={container:{fontFamily:'"Noto Sans Khmer", "Khmer OS", sans-serif',fontSize:"14px",lineHeight:"1.6",color:"#333",backgroundColor:"#fff",padding:"40px",maxWidth:"210mm",margin:"0 auto"},header:{textAlign:"center",marginBottom:"40px",borderBottom:"3px solid #333",paddingBottom:"20px"},title:{fontSize:"28px",fontWeight:"bold",marginBottom:"10px",color:"#333"},subtitle:{fontSize:"18px",marginBottom:"10px",color:"#666"},exportInfo:{textAlign:"right",fontSize:"12px",color:"#666",marginBottom:"20px"},section:{marginBottom:"30px",pageBreakInside:"avoid",breakInside:"avoid"},sectionTitle:{fontSize:"20px",fontWeight:"bold",marginBottom:"15px",color:"#333",backgroundColor:"#f8f9fa",padding:"12px",borderLeft:"4px solid #ffc107"},summaryGrid:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"15px",marginBottom:"20px"},summaryItem:{display:"flex",justifyContent:"space-between",padding:"10px",backgroundColor:"#f8f9fa",borderRadius:"4px",border:"1px solid #e9ecef"},summaryLabel:{fontWeight:"bold",color:"#495057"},summaryValue:{color:"#ffc107",fontWeight:"bold"},table:{width:"100%",borderCollapse:"collapse",marginTop:"15px",pageBreakInside:"avoid",breakInside:"avoid"},tableHeader:{backgroundColor:"#ffc107",color:"white"},tableHeaderCell:{padding:"12px",textAlign:"center",fontWeight:"bold",border:"1px solid #dee2e6"},tableCell:{padding:"10px",textAlign:"center",border:"1px solid #dee2e6"},tableRow:{backgroundColor:"#fff"},tableRowAlt:{backgroundColor:"#f8f9fa"},noData:{textAlign:"center",padding:"20px",color:"#6c757d",fontStyle:"italic"},footer:{textAlign:"center",marginTop:"40px",fontSize:"12px",color:"#6c757d",borderTop:"1px solid #dee2e6",paddingTop:"20px"}};return e.jsxs("div",{style:t.container,children:[e.jsxs("div",{style:t.header,children:[e.jsx("h1",{style:t.title,children:"របាយការណ៍ស្ថានភាពការបង់ប្រាក់"}),e.jsx("p",{style:t.subtitle,children:"ព័ត៌មានលម្អិតអំពីការបង់ប្រាក់"})]}),e.jsxs("div",{style:t.exportInfo,children:[e.jsxs("div",{children:["នាំចេញដោយ: ",c]}),e.jsxs("div",{children:["កាលបរិច្ឆេទនាំចេញ: ",h(new Date().toISOString())]})]}),e.jsxs("div",{style:t.section,children:[e.jsx("h2",{style:t.sectionTitle,children:"📊 សង្ខេប"}),e.jsxs("div",{style:t.summaryGrid,children:[e.jsxs("div",{style:t.summaryItem,children:[e.jsx("span",{style:t.summaryLabel,children:"📊 សញ្ញាសរុប:"}),e.jsx("span",{style:t.summaryValue,children:((u=o.summary)==null?void 0:u.contracts_count)||0})]}),e.jsxs("div",{style:t.summaryItem,children:[e.jsx("span",{style:t.summaryLabel,children:"💰 ចំនួនសរុប:"}),e.jsx("span",{style:t.summaryValue,children:d((f=o.summary)==null?void 0:f.total_amount)})]}),e.jsxs("div",{style:t.summaryItem,children:[e.jsx("span",{style:t.summaryLabel,children:"✅ ចំនួនបានទូទាត់:"}),e.jsx("span",{style:t.summaryValue,children:d((l=o.summary)==null?void 0:l.total_paid)})]}),e.jsxs("div",{style:t.summaryItem,children:[e.jsx("span",{style:t.summaryLabel,children:"❌ ចំនួនមិនទានទូទាត់:"}),e.jsx("span",{style:t.summaryValue,children:d((j=o.summary)==null?void 0:j.total_unpaid)})]}),e.jsxs("div",{style:t.summaryItem,children:[e.jsx("span",{style:t.summaryLabel,children:"📋 ចំនួនការបង់:"}),e.jsx("span",{style:t.summaryValue,children:((g=o.summary)==null?void 0:g.payment_count)||0})]}),e.jsxs("div",{style:t.summaryItem,children:[e.jsx("span",{style:t.summaryLabel,children:"🏠 ចំនួនកិច្ចសន្យា:"}),e.jsx("span",{style:t.summaryValue,children:((b=o.summary)==null?void 0:b.contract_count)||0})]})]})]}),e.jsxs("div",{style:t.section,children:[e.jsx("h2",{style:t.sectionTitle,children:"📋 ស្ថានភាពទូទាត់សញ្ញា"}),e.jsxs("table",{style:t.table,children:[e.jsx("thead",{style:t.tableHeader,children:e.jsxs("tr",{children:[e.jsx("th",{style:t.tableHeaderCell,children:"លេខសញ្ញា"}),e.jsx("th",{style:t.tableHeaderCell,children:"លេខដីធ្លី"}),e.jsx("th",{style:t.tableHeaderCell,children:"ចំនួនសរុប"}),e.jsx("th",{style:t.tableHeaderCell,children:"ចំនួនបានទូទាត់"}),e.jsx("th",{style:t.tableHeaderCell,children:"ចំនួនមិនទានទូទាត់"})]})}),e.jsx("tbody",{children:o.contracts&&o.contracts.length>0?o.contracts.map((r,a)=>e.jsxs("tr",{style:a%2===0?t.tableRow:t.tableRowAlt,children:[e.jsx("td",{style:t.tableCell,children:r.contract_id||"N/A"}),e.jsx("td",{style:t.tableCell,children:r.land_plot_number||"N/A"}),e.jsx("td",{style:t.tableCell,children:d(r.total_amount)}),e.jsx("td",{style:{...t.tableCell,color:"#28a745",fontWeight:"bold"},children:d(r.paid_amount)}),e.jsx("td",{style:{...t.tableCell,color:"#dc3545",fontWeight:"bold"},children:d(r.unpaid_amount)})]},a)):e.jsx("tr",{children:e.jsx("td",{colSpan:"5",style:t.noData,children:"មិនមានទិន្នន័យសញ្ញា"})})})]})]}),o.overdue_payments&&o.overdue_payments.length>0&&e.jsxs("div",{style:t.section,children:[e.jsx("h2",{style:t.sectionTitle,children:"⚠️ ការបង់ប្រាក់ហួសកំណត់"}),e.jsxs("table",{style:t.table,children:[e.jsx("thead",{style:t.tableHeader,children:e.jsxs("tr",{children:[e.jsx("th",{style:t.tableHeaderCell,children:"លេខកិច្ចសន្យា"}),e.jsx("th",{style:t.tableHeaderCell,children:"ដំណាក់កាល"}),e.jsx("th",{style:t.tableHeaderCell,children:"ចំនួនទឹកប្រាក់"}),e.jsx("th",{style:t.tableHeaderCell,children:"កាលបរិច្ឆេទកំណត់"}),e.jsx("th",{style:t.tableHeaderCell,children:"ចំនួនថ្ងៃហួសកំណត់"})]})}),e.jsx("tbody",{children:o.overdue_payments.map((r,a)=>e.jsxs("tr",{style:a%2===0?t.tableRow:t.tableRowAlt,children:[e.jsx("td",{style:t.tableCell,children:r.contract_id}),e.jsx("td",{style:t.tableCell,children:r.step_number}),e.jsx("td",{style:t.tableCell,children:d(r.amount)}),e.jsx("td",{style:t.tableCell,children:h(r.due_date)}),e.jsxs("td",{style:{...t.tableCell,color:"#dc3545",fontWeight:"bold"},children:[r.days_overdue," ថ្ងៃ"]})]},a))})]})]}),e.jsx("div",{style:t.footer,children:e.jsx("p",{children:"របាយការណ៍នេះត្រូវបានបង្កើតដោយប្រព័ន្ធតាមដានដីកម្ពុជា"})})]})},{Title:J,Text:i}=O,B={padding:"16px",borderRadius:"2px",boxShadow:"0 1px 2px rgba(0,0,0,0.05)",height:"100%"},R={fontSize:"24px",fontWeight:"bold",marginTop:"8px",display:"block"},k={fontSize:"14px",color:"rgba(0, 0, 0, 0.45)",marginBottom:"4px"},we=({auth:o})=>{const[c,d]=m.useState(!1),[h,t]=m.useState(!1),[u,f]=m.useState(null),[l,j]=m.useState(null),[g,b]=m.useState(null),{generatePDFFromComponent:r}=V(),a=s=>s==null?"$0.00":"$"+new Intl.NumberFormat("en-US").format(s),D=m.useCallback(async()=>{d(!0),b(null),j(null);try{const s=await A.post("/reports/payment-status/data");j(s.data)}catch(s){console.error("Error fetching payment status report data:",s),b(s.response&&s.response.data&&s.response.data.error?s.response.data.error:"Failed to fetch report data"),_.error("Failed to load payment status data. Please refresh the page.")}finally{d(!1)}},[]);m.useEffect(()=>{D()},[D]);const T=m.useCallback(async s=>{if(!l){_.error("សូមទាញយកទិន្នន័យរបាយការណ៍ជាមុនសិន");return}t(!0),f(s);try{if(s==="pdf"){const x=`payment_status_report_${new Date().toISOString().split("T")[0]}.pdf`,C=e.jsx(q,{data:l,exportedBy:o.user.name}),I=await r(C,x);if(!I.success)throw new Error(I.error);_.success("នាំចេញ PDF បានជោគជ័យ")}else if(s==="excel"){const x=await A.post("/reports/payment-status/export",{format:"excel"},{responseType:"blob"}),C=new Blob([x.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),I=window.URL.createObjectURL(C),S=document.createElement("a");S.href=I,S.setAttribute("download",`payment_status_report_${new Date().toISOString().split("T")[0]}.xlsx`),document.body.appendChild(S),S.click(),S.remove(),_.success("នាំចេញ Excel បានជោគជ័យ")}}catch(x){console.error(`Error exporting ${s}:`,x),_.error(`មានបញ្ហាក្នុងការនាំចេញ: ${x.message}`)}finally{t(!1),f(null)}},[l,o.user.name,r]);return e.jsxs(P,{user:o.user,children:[e.jsx(W,{title:"របាយការណ៍ប្រាក់បានបង់/មិនទាន់បង់"}),e.jsxs("div",{style:{padding:"24px"},children:[e.jsx(p,{style:{marginBottom:"24px"},children:e.jsxs(v,{gutter:16,align:"middle",children:[e.jsx(n,{xs:24,sm:12,children:e.jsx(J,{level:4,style:{margin:0},children:"របាយការណ៍ប្រាក់បានបង់/មិនទាន់បង់"})}),e.jsx(n,{xs:24,sm:12,style:{textAlign:"right"},children:c&&e.jsx(L,{})})]})}),g&&e.jsx(K,{message:"Error",description:g,type:"error",showIcon:!0,style:{marginBottom:"24px"}}),!c&&l&&l.contracts&&l.contracts.length>0&&e.jsxs(v,{gutter:16,style:{marginBottom:"24px"},children:[e.jsx(n,{xs:24,sm:8,style:{marginBottom:"16px"},children:e.jsx(p,{style:{...B,backgroundColor:"#e6f7ff"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{style:k,children:"ចំនួនសរុបទាំងអស់"}),e.jsx("span",{style:{...R},children:a(l.summary.total_amount)})]})})}),e.jsx(n,{xs:24,sm:8,style:{marginBottom:"16px"},children:e.jsx(p,{style:{...B,backgroundColor:"#f6ffed"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{style:k,children:"ចំនួនបានបង់"}),e.jsx("span",{style:{...R,color:"#52c41a"},children:a(l.summary.total_paid)})]})})}),e.jsx(n,{xs:24,sm:8,style:{marginBottom:"16px"},children:e.jsx(p,{style:{...B,backgroundColor:"#fff1f0"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{style:k,children:"ចំនួនមិនទាន់បង់"}),e.jsx("span",{style:{...R,color:"#f5222d"},children:a(l.summary.total_unpaid)})]})})})]}),!c&&l&&l.contracts&&l.contracts.length>0&&e.jsx(p,{style:{marginBottom:"24px"},children:e.jsxs(v,{gutter:16,align:"middle",children:[e.jsx(n,{xs:24,sm:12,children:e.jsx(i,{children:"ទិន្នន័យរបាយការណ៍"})}),e.jsx(n,{xs:24,sm:12,style:{textAlign:"right"},children:e.jsxs(y,{children:[e.jsx(E,{title:"នាំចេញរបាយការណ៍ជាឯកសារ PDF",children:e.jsx(H,{type:"primary",danger:!0,icon:e.jsx(U,{}),onClick:()=>T("pdf"),loading:h&&u==="pdf",children:"PDF"})}),e.jsx(E,{title:"នាំចេញរបាយការណ៍ជាឯកសារ Excel",children:e.jsx(H,{type:"primary",style:{backgroundColor:"#52c41a"},icon:e.jsx(N,{}),onClick:()=>T("excel"),loading:h&&u==="excel",children:"Excel"})})]})})]})}),c&&e.jsxs(p,{style:{textAlign:"center",padding:"40px 0"},children:[e.jsx(L,{size:"large"}),e.jsx("p",{style:{marginTop:16},children:"កំពុងបង្កើតរបាយការណ៍..."})]}),!c&&(!l||!l.contracts||l.contracts.length===0)&&e.jsxs(p,{style:{textAlign:"center",padding:"20px 0"},children:[e.jsx(M,{description:e.jsx(i,{style:{fontSize:"16px"},children:"មិនមានទិន្នន័យសម្រាប់ការជ្រើសរើសនេះ"}),image:e.jsx(G,{style:{fontSize:60,color:"#ccc"}})}),e.jsx(Q,{dashed:!0}),e.jsx(i,{type:"secondary",children:"កំពុងផ្ទុកទិន្នន័យ..."})]}),!c&&l&&l.contracts&&l.contracts.length>0&&e.jsxs("div",{style:{backgroundColor:"#fff",marginBottom:"24px"},children:[e.jsxs(v,{gutter:16,style:{backgroundColor:"#fafafa",padding:"12px 16px",borderBottom:"1px solid #f0f0f0",marginBottom:"8px",fontWeight:"bold"},children:[e.jsx(n,{xs:24,sm:6,md:4,style:{display:"flex",alignItems:"center"},children:e.jsxs(y,{children:[e.jsx(F,{}),e.jsx(i,{children:"លេខកុងត្រា"})]})}),e.jsx(n,{xs:24,sm:6,md:4,style:{display:"flex",alignItems:"center"},children:e.jsxs(y,{children:[e.jsx(F,{}),e.jsx(i,{children:"លេខដី"})]})}),e.jsx(n,{xs:24,sm:4,md:4,style:{display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsxs(y,{children:[e.jsx(w,{}),e.jsx(i,{children:"ចំនួនសរុប"})]})}),e.jsx(n,{xs:24,sm:4,md:6,style:{display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsxs(y,{children:[e.jsx(w,{}),e.jsx(i,{children:"ចំនួនបានបង់"})]})}),e.jsx(n,{xs:24,sm:4,md:6,style:{display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsxs(y,{children:[e.jsx(w,{}),e.jsx(i,{children:"ចំនួនមិនទាន់បង់"})]})})]}),e.jsx(z,{itemLayout:"horizontal",dataSource:l.contracts,renderItem:s=>e.jsx(z.Item,{style:{background:"#fff",padding:"16px",marginBottom:"8px",borderBottom:"1px solid #f0f0f0"},children:e.jsxs(v,{gutter:16,style:{width:"100%"},children:[e.jsx(n,{xs:24,sm:6,md:4,style:{display:"flex",alignItems:"center"},children:e.jsx($,{href:`/reports/document?contract_id=${s.contract_id}`,className:"text-blue-600 hover:text-blue-800 font-bold",children:s.contract_id})}),e.jsx(n,{xs:24,sm:6,md:4,style:{display:"flex",alignItems:"center"},children:Array.isArray(s.lands)&&s.lands.length>0?e.jsx(y,{direction:"vertical",size:"small",style:{width:"100%"},children:s.lands.map((x,C)=>e.jsx("span",{children:x.plot_number},C))}):s.land_plot_number?e.jsx("span",{children:s.land_plot_number}):e.jsx("span",{children:"-"})}),e.jsx(n,{xs:24,sm:4,md:4,style:{display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsx(i,{children:a(s.total_amount)})}),e.jsx(n,{xs:24,sm:4,md:6,style:{display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsx(i,{style:{color:"#52c41a"},children:a(s.paid_amount)})}),e.jsx(n,{xs:24,sm:4,md:6,style:{display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsx(i,{style:{color:"#f5222d"},children:a(s.unpaid_amount)})})]})})})]})]})]})};export{we as default};
