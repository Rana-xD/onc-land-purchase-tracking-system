import{r as a,_ as I,d as g,j as t,Q as L}from"./app-D0OhDuOP.js";import{A as U}from"./AdminLayout-DfyZC7U7.js";import B from"./DocumentUploadModal-BdxP2JQw.js";import H from"./DocumentListModal-DvH0j3Fv.js";import{s as c}from"./index-VXrvBi_7.js";import{C as _}from"./index-BXZQm44E.js";import{I as K}from"./index-DyIYvMCA.js";import{R as Q}from"./SearchOutlined-DdbS1Qlk.js";import{I as k,B as m}from"./index-XQ9uBlxv.js";import{S as W}from"./index-Bjcdw0HM.js";import{C as M}from"./Collapse-B282zXVZ.js";import{F as q}from"./Table-CJMywyvl.js";import{S as C}from"./index-CpY42lHj.js";import{R as G}from"./FilePdfOutlined-BmX1d_m5.js";import{R as J}from"./FileExcelOutlined-BY1VKBUv.js";import{R as X}from"./UploadOutlined-qPHS_ZnN.js";import{T as N}from"./index-DxlGwFBo.js";import{R as Y}from"./ClockCircleOutlined-BGruiaAm.js";import{R as w}from"./CheckCircleOutlined-_P5yC29H.js";import{T as Z}from"./index-DUD5X347.js";import{P as tt}from"./index-BLwNk9Dd.js";import"./UserOutlined-Bw1Yg3TV.js";import"./index-BKPGZTnh.js";import"./EllipsisOutlined-BcUT9_x5.js";import"./PurePanel-BrlMViLC.js";import"./index-BoUcoXbW.js";import"./index-01QrSur2.js";import"./row-Cvvd4www.js";import"./index-BNYa27A7.js";import"./CheckOutlined-C-W3vkf9.js";import"./ExclamationCircleFilled-BuCwC-hN.js";import"./CloseOutlined-CSg-7HVH.js";import"./index-DSx0c0nZ.js";import"./InfoCircleFilled-Csbq1HVY.js";import"./ActionButton-DPI_9ZHB.js";import"./pickAttrs-BMtZpb9Y.js";import"./useClosable-rmjEiMr1.js";import"./extendsObject-78o_rR5W.js";import"./Skeleton-BB1PfEPR.js";import"./index-FPFFDuuk.js";import"./DeleteOutlined-C5fTVnAq.js";import"./DownloadOutlined-BFocYQwA.js";import"./EyeOutlined-Bk9sN1n5.js";import"./progress-CZwQN1Wi.js";import"./index-BXlDNFm_.js";import"./getAllowClear-7r21EHJH.js";import"./useVariants-VmmnPvRy.js";import"./useIcons-De8HtjeC.js";import"./DownOutlined-BKT6hG3e.js";import"./FileImageOutlined-6X7nxdKY.js";import"./addEventListener-Dvq9iQDE.js";import"./index-CxyNWzZ_.js";import"./useBubbleLock-Dp5g0NxF.js";import"./index-HowiUfuo.js";import"./Pagination-C28t5-1k.js";import"./FileOutlined-CmtzEeI9.js";import"./FolderOutlined-CsvjmU0T.js";import"./Input-DIi4XD1o.js";import"./EditOutlined-BQAB7wjt.js";var et={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"},rt=function(i,l){return a.createElement(k,I({},i,{ref:l,icon:et}))},st=a.forwardRef(rt),ot={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M342 88H120c-17.7 0-32 14.3-32 32v224c0 8.8 7.2 16 16 16h48c8.8 0 16-7.2 16-16V168h174c8.8 0 16-7.2 16-16v-48c0-8.8-7.2-16-16-16zm578 576h-48c-8.8 0-16 7.2-16 16v176H682c-8.8 0-16 7.2-16 16v48c0 8.8 7.2 16 16 16h222c17.7 0 32-14.3 32-32V680c0-8.8-7.2-16-16-16zM342 856H168V680c0-8.8-7.2-16-16-16h-48c-8.8 0-16 7.2-16 16v224c0 17.7 14.3 32 32 32h222c8.8 0 16-7.2 16-16v-48c0-8.8-7.2-16-16-16zM904 88H682c-8.8 0-16 7.2-16 16v48c0 8.8 7.2 16 16 16h174v176c0 8.8 7.2 16 16 16h48c8.8 0 16-7.2 16-16V120c0-17.7-14.3-32-32-32z"}}]},name:"expand",theme:"outlined"},nt=function(i,l){return a.createElement(k,I({},i,{ref:l,icon:ot}))},at=a.forwardRef(nt);const{Title:he,Text:R}=Z,{Panel:y}=M;function xe({auth:f}){const[i,l]=a.useState(""),[b,d]=a.useState(!1),[r,h]=a.useState(null),[$,x]=a.useState(!1),[F,v]=a.useState(!1),[z,E]=a.useState(null),[u,p]=a.useState(null);a.useEffect(()=>{const s=new URLSearchParams(window.location.search).get("contract_id");s&&(l(s),A(s))},[]);const A=async e=>{var s,o;if(!e.trim()){c.error("សូមបញ្ចូលលេខកិច្ចសន្យា");return}d(!0);try{const n=await g.post("/api/reports/document/search",{contract_id:e.trim()});console.log("Search result:",n.data),h(n.data),n.data&&n.data.contract?(console.log("Found contract in search result:",n.data.contract),p(n.data.contract)):(console.log("No contract found in search result. Structure:",n.data),p(null)),c.success("រកឃើញកិច្ចសន្យា")}catch(n){console.error("បញ្ហាក្នុងការស្វែងរក:",n),c.error(((o=(s=n.response)==null?void 0:s.data)==null?void 0:o.error)||"មិនរកឃើញកិច្ចសន្យា"),h(null)}finally{d(!1)}},j=async()=>{var e,s;if(!i.trim()){c.error("សូមបញ្ចូលលេខកិច្ចសន្យា");return}d(!0);try{const o=await g.post("/api/reports/document/search",{contract_id:i.trim()});console.log("Search result:",o.data),h(o.data),o.data&&o.data.contract?(console.log("Found contract in search result:",o.data.contract),p(o.data.contract)):(console.log("No contract found in search result. Structure:",o.data),p(null)),c.success("រកឃើញកិច្ចសន្យា")}catch(o){console.error("បញ្ហាក្នុងការស្វែងរក:",o),c.error(((s=(e=o.response)==null?void 0:e.data)==null?void 0:s.error)||"មិនរកឃើញកិច្ចសន្យា"),h(null)}finally{d(!1)}},P=async e=>{var s,o;try{d(!0);const n=await g.post(`/api/reports/payment-steps/${e}/mark-as-paid`);c.success("បានកំណត់ថាបានបង់ប្រាក់ហើយ"),j()}catch(n){console.error("បញ្ហាក្នុងការកំណត់ថាបានបង់ប្រាក់:",n),c.error(((o=(s=n.response)==null?void 0:s.data)==null?void 0:o.error)||"មិនអាចកំណត់ថាបានបង់ប្រាក់")}finally{d(!1)}},S=async e=>{if(r)try{window.open(`/api/reports/document/export/${r.contract.contract_id}?format=${e}`,"_blank")}catch(s){console.error("បញ្ហាក្នុងការនាំចេញ:",s),c.error("មិនអាចនាំចេញឯកសារ")}},D=()=>{if(console.log("showUploadModal called, saleContract:",u),console.log("searchResult:",r),!u){if(console.log("No sale contract found, showing error message"),r&&r.contract){console.log("Found contract in searchResult, using it:",r.contract),p(r.contract),x(!0);return}c.error("សូមស្វែងរកកិច្ចសន្យាមុននឹងផ្ទុកឯកសារ");return}console.log("Setting upload modal visible, saleContract ID:",u.id),x(!0)},O=e=>{E(e),v(!0)},T=e=>{switch(e){case"paid":return t.jsxs(N,{color:"green",children:[t.jsx(w,{})," បានបង់ប្រាក់រួចរាល់"]});case"unpaid":default:return t.jsxs(N,{color:"red",children:[t.jsx(Y,{})," មិនទាន់បង់ប្រាក់"]})}},V=[{title:"ដំណាក់កាល",dataIndex:"step_number",key:"step_number",width:120,render:e=>`ទី${e}`},{title:"ចំនួនទឹកប្រាក់",dataIndex:"amount",key:"amount",render:e=>`$${parseFloat(e).toLocaleString("en-US",{minimumFractionDigits:2})}`,width:150},{title:"កាលបរិច្ឆេទត្រូវបង់ប្រាក់",dataIndex:"due_date",key:"due_date",render:(e,s)=>new Date(e)<new Date&&s.status==="unpaid"?t.jsx(R,{strong:!0,style:{color:"red"},children:e}):t.jsx(R,{children:e})},{title:"ស្ថានភាព",dataIndex:"status",key:"status",render:e=>T(e)},{title:"សកម្មភាព",key:"actions",render:(e,s)=>t.jsx(C,{size:"small",children:s.status!=="paid"&&t.jsx(tt,{title:"តើអ្នកប្រាកដថាចង់កំណត់ថាបានបង់ប្រាក់នេះមែនទេ?",description:"ការសកម្មភាពនេះអាចត្រូវបានប្រព្រឹត្តទៅ",icon:t.jsx(st,{style:{color:"#faad14"}}),okText:"បាទ/ចាស",cancelText:"ទេ",okButtonProps:{style:{backgroundColor:"#1890ff",borderColor:"#1890ff"}},onConfirm:()=>P(s.id),children:t.jsx(m,{type:"primary",icon:t.jsx(w,{}),size:"small",style:{backgroundColor:"#52c41a",borderColor:"#52c41a"},disabled:s.status==="paid"})})})}];return t.jsxs(U,{user:f.user,header:t.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"របាយការណ៍ឯកសារ"}),children:[t.jsx(L,{title:"របាយការណ៍ឯកសារ"}),t.jsx("div",{className:"py-12",children:t.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[t.jsx(_,{title:"ស្វែងរកកិច្ចសន្យា",className:"mb-6",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(K,{placeholder:"បញ្ចូលលេខកិច្ចសន្យា",value:i,onChange:e=>l(e.target.value),onPressEnter:j,style:{width:"300px"},prefix:t.jsx(Q,{})}),t.jsx(m,{type:"primary",onClick:j,loading:b,className:"ml-2",children:"ស្វែងរក"})]})}),b&&t.jsx("div",{className:"text-center my-8",children:t.jsx(W,{size:"large"})}),r&&t.jsx(t.Fragment,{children:t.jsxs(_,{title:`កិច្ចសន្យា: ${r.contract.contract_id}`,className:"mb-6",extra:t.jsxs(C,{children:[t.jsx(m,{icon:t.jsx(G,{}),onClick:()=>S("pdf"),children:"នាំចេញជា PDF"}),t.jsx(m,{type:"primary",style:{backgroundColor:"#52c41a"},icon:t.jsx(J,{}),onClick:()=>S("excel"),children:"នាំចេញជា Excel"}),t.jsx(m,{icon:t.jsx(X,{}),onClick:()=>D(),children:"ផ្ទុកឯកសារ"}),t.jsx(m,{icon:t.jsx(at,{}),onClick:()=>O(null),children:"មើលឯកសារទាំងអស់"})]}),children:[t.jsxs(M,{defaultActiveKey:["1","2","3"],children:[t.jsx(y,{header:"ព័ត៌មានអ្នកទិញ",children:r.contract.buyers&&r.contract.buyers.length>0?t.jsx(t.Fragment,{children:r.contract.buyers.map((e,s)=>t.jsxs("div",{className:s>0?"mt-4 pt-4 border-t":"",children:[r.contract.buyers.length>1&&t.jsxs("h4",{className:"font-bold mb-2",children:["អ្នកទិញទី ",s+1]}),t.jsxs("p",{children:[t.jsx("strong",{children:"ឈ្មោះ:"})," ",e.name]}),t.jsxs("p",{children:[t.jsx("strong",{children:"ទូរស័ព្ទ:"})," ",e.phone||"N/A"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"អាសយដ្ឋាន:"})," ",e.address||"N/A"]})]},e.id))}):t.jsxs(t.Fragment,{children:[t.jsxs("p",{children:[t.jsx("strong",{children:"ឈ្មោះ:"})," ",r.contract.buyer_info.name]}),t.jsxs("p",{children:[t.jsx("strong",{children:"ទូរស័ព្ទ:"})," ",r.contract.buyer_info.phone||"N/A"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"អាសយដ្ឋាន:"})," ",r.contract.buyer_info.address||"N/A"]})]})},"1"),t.jsx(y,{header:"ព័ត៌មានអ្នកលក់",children:r.contract.sellers&&r.contract.sellers.length>0?t.jsx(t.Fragment,{children:r.contract.sellers.map((e,s)=>t.jsxs("div",{className:s>0?"mt-4 pt-4 border-t":"",children:[r.contract.sellers.length>1&&t.jsxs("h4",{className:"font-bold mb-2",children:["អ្នកលក់ទី ",s+1]}),t.jsxs("p",{children:[t.jsx("strong",{children:"ឈ្មោះ:"})," ",e.name]}),t.jsxs("p",{children:[t.jsx("strong",{children:"ទូរស័ព្ទ:"})," ",e.phone||"N/A"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"អាសយដ្ឋាន:"})," ",e.address||"N/A"]})]},e.id))}):t.jsxs(t.Fragment,{children:[t.jsxs("p",{children:[t.jsx("strong",{children:"ឈ្មោះ:"})," ",r.contract.seller_info.name]}),t.jsxs("p",{children:[t.jsx("strong",{children:"ទូរស័ព្ទ:"})," ",r.contract.seller_info.phone||"N/A"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"អាសយដ្ឋាន:"})," ",r.contract.seller_info.address||"N/A"]})]})},"2"),t.jsx(y,{header:"ព័ត៌មានដី",children:r.contract.lands&&r.contract.lands.length>0?t.jsx(t.Fragment,{children:r.contract.lands.map((e,s)=>t.jsxs("div",{className:s>0?"mt-4 pt-4 border-t":"",children:[r.contract.lands.length>1&&t.jsxs("h4",{className:"font-bold mb-2",children:["ដីទី ",s+1]}),t.jsxs("p",{children:[t.jsx("strong",{children:"លេខក្បែងដី:"})," ",e.plot_number]}),t.jsxs("p",{children:[t.jsx("strong",{children:"ទំហំ:"})," ",e.size]}),t.jsxs("p",{children:[t.jsx("strong",{children:"ទីតាំង:"})," ",e.location]}),t.jsxs("p",{children:[t.jsx("strong",{children:"តម្លៃក្នុងម៉ែត្រការ៉េ:"})," ",e.price_per_meter]}),t.jsxs("p",{children:[t.jsx("strong",{children:"តម្លៃសរុប:"})," ",e.total_price]})]},e.id))}):t.jsxs(t.Fragment,{children:[t.jsxs("p",{children:[t.jsx("strong",{children:"លេខក្បែងដី:"})," ",r.contract.land_info.plot_number]}),t.jsxs("p",{children:[t.jsx("strong",{children:"ទំហំ:"})," ",r.contract.land_info.size]}),t.jsxs("p",{children:[t.jsx("strong",{children:"ទីតាំង:"})," ",r.contract.land_info.location]})]})},"3")]}),t.jsx("div",{className:"mt-6",children:t.jsx(q,{columns:V,dataSource:r.payment_steps,rowKey:"id",pagination:!1,size:"middle"})})]})})]})}),t.jsx(B,{visible:$,onCancel:()=>x(!1),saleContract:u,onSuccess:()=>{x(!1),j()}}),t.jsx(H,{visible:F,onCancel:()=>v(!1),paymentStep:z})]})}export{xe as default};
